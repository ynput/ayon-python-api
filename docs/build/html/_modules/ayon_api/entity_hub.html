
	

<!DOCTYPE html>
<html class="writer-html5 " lang="en" >
<head>
	<meta charset="utf-8">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
		<title>ayon_api.entity_hub &mdash; ayon-python-api 1.0.9-dev.1 documentation</title>
	
	
	
	<link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

	
	
		<link rel="shortcut icon" href="../../_static/favicon.ico"/>
	
	
	
		<link rel="canonical" href="https://github.com/ynput/ayon-python-api_modules/ayon_api/entity_hub.html"/>
	

	
	<!--[if lt IE 9]>
		<script src="../../_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
		
			<script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
				<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
				<script src="../../_static/jquery.js"></script>
				<script src="../../_static/underscore.js"></script>
				<script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
				<script src="../../_static/doctools.js"></script>
				<script src="../../_static/sphinx_highlight.js"></script>
		
		<script type="text/javascript" src="../../_static/js/theme.js"></script>

		
		<link rel="index" title="Index" href="../../genindex.html" />
		<link rel="search" title="Search" href="../../search.html" /> 
</head>
<body class="wy-body-for-nav">


	 
	<div class="wy-grid-for-nav">
		
		<nav data-toggle="wy-nav-shift" class="wy-nav-side">
			<div class="wy-side-scroll">
				<div class="wy-side-nav-search">
					
						<div class="brand">
							<a href="../../index.html">
							
								<img src="../../_static/AYON_blackG_dot.svg" class="logo" alt="Logo"/>
							
							</a>
						</div>
						
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
					
				</div>
				
				<div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
					
						
						
							
						
						
							<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">ayon_api</a></li>
</ul>

						
					
				</div>
				
			</div>
		</nav>

		<section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

			
			<nav class="wy-nav-top" aria-label="top navigation">
			
				<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
				<a href="../../index.html">
					
						<img src="../../_static/AYON_blackG_dot.svg" class="logo" alt="Logo"/>
					
				</a>
			
			</nav>


			<div class="wy-nav-content">
				
				<div class="rst-content">
				
					<div role="navigation" aria-label="breadcrumbs navigation">

	<ul class="wy-breadcrumbs">
		
			
				<li><a href="../../index.html">ayon-python-api</a> ⁄&nbsp;</li>
				
					<li><a href="../index.html">Module code</a> ⁄&nbsp;</li>
				
				<li><a href="">ayon_api.entity_hub</a></li>
			
		
		
			<li class="wy-breadcrumbs-aside">
			
				<a href="https://github.com/ynput/ayon-python-api" class="fa fa-github-alt"></a>
			
			</li>
		
	</ul>

</div>
					<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
					 <div itemprop="articleBody">
						
  <h1>Source code for ayon_api.entity_hub</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>

<span class="kn">from</span> <span class="nn">._api</span> <span class="kn">import</span> <span class="n">get_server_api_connection</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">create_entity_id</span><span class="p">,</span> <span class="n">convert_entity_id</span><span class="p">,</span> <span class="n">slugify_string</span>


<span class="k">class</span> <span class="nc">_CustomNone</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;CustomNone&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>


<span class="n">UNKNOWN_VALUE</span> <span class="o">=</span> <span class="n">_CustomNone</span><span class="p">(</span><span class="s2">&quot;UNKNOWN_VALUE&quot;</span><span class="p">)</span>
<span class="n">PROJECT_PARENT_ID</span> <span class="o">=</span> <span class="n">_CustomNone</span><span class="p">(</span><span class="s2">&quot;PROJECT_PARENT_ID&quot;</span><span class="p">)</span>
<span class="n">_NOT_SET</span> <span class="o">=</span> <span class="n">_CustomNone</span><span class="p">(</span><span class="s2">&quot;_NOT_SET&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="EntityHub"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub">[docs]</a><span class="k">class</span> <span class="nc">EntityHub</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper to create, update or remove entities in project.</span>

<span class="sd">    The hub is a guide to operation with folder entities and update of project.</span>
<span class="sd">    Project entity must already exist on server (can be only updated).</span>

<span class="sd">    Object is caching entities queried from server. They won&#39;t be required once</span>
<span class="sd">    they were queried, so it is recommended to create new hub or clear cache</span>
<span class="sd">    frequently.</span>

<span class="sd">    Todos:</span>
<span class="sd">        Listen to server events about entity changes to be able update already</span>
<span class="sd">            queried entities.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_name (str): Name of project where changes will happen.</span>
<span class="sd">        connection (ServerAPI): Connection to server with logged user.</span>
<span class="sd">        allow_data_changes (bool): This option gives ability to change &#39;data&#39;</span>
<span class="sd">            key on entities. This is not recommended as &#39;data&#39; may be use for</span>
<span class="sd">            secure information and would also slow down server queries. Content</span>
<span class="sd">            of &#39;data&#39; key can&#39;t be received only GraphQl.</span>
<span class="sd">            </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">connection</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">allow_data_changes</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">connection</span> <span class="o">=</span> <span class="n">get_server_api_connection</span><span class="p">()</span>
        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">server_version_tuple</span>
        <span class="n">path_start_with_slash</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">):</span>
            <span class="n">path_start_with_slash</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">allow_data_changes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">allow_data_changes</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_start_with_slash</span> <span class="o">=</span> <span class="n">path_start_with_slash</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_entity</span> <span class="o">=</span> <span class="n">UNKNOWN_VALUE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_allow_data_changes</span> <span class="o">=</span> <span class="n">allow_data_changes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_path_reset_queue</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">allow_data_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entity hub allows changes of &#39;data&#39; key on entities.</span>

<span class="sd">        Data are private and not all users may have access to them. Also to get</span>
<span class="sd">        &#39;data&#39; for entity is required to use REST api calls, which means to</span>
<span class="sd">        query each entity on-by-one from server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Data changes are allowed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_data_changes</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">path_start_with_slash</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Folder path should start with slash.</span>

<span class="sd">        This changed in 0.6.x server version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Path starts with slash.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_start_with_slash</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">project_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Project name which is maintained by hub.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Name of project.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_name</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">project_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Project entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ProjectEntity: Project entity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_entity</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fill_project_from_server</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_entity</span>

<div class="viewcode-block" id="EntityHub.get_attributes_for_type"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.get_attributes_for_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_attributes_for_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get attributes available for a type.</span>

<span class="sd">        Attributes are based on entity types.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Use attribute schema to validate values on entities.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_type (Literal[&quot;project&quot;, &quot;folder&quot;, &quot;task&quot;]): Entity type</span>
<span class="sd">                for which should be attributes received.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Dict[str, Any]]: Attribute schemas that are available</span>
<span class="sd">                for entered entity type.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_attributes_for_type</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntityHub.get_entity_by_id"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.get_entity_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_entity_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Receive entity by its id without entity type.</span>

<span class="sd">        The entity must be already existing in cached objects.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_id (str): Id of entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[BaseEntity, None]: Entity object or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntityHub.get_folder_by_id"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.get_folder_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">allow_query</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get folder entity by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_id (str): Id of folder entity.</span>
<span class="sd">            allow_query (bool): Try to query entity from server if is not</span>
<span class="sd">                available in cache.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[FolderEntity, None]: Object of folder or &#39;None&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">allow_query</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_or_query_entity_by_id</span><span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;folder&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntityHub.get_task_by_id"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.get_task_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">allow_query</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get task entity by id.</span>

<span class="sd">        Args:</span>
<span class="sd">           entity_id (str): Id of task entity.</span>
<span class="sd">           allow_query (bool): Try to query entity from server if is not</span>
<span class="sd">               available in cache.</span>

<span class="sd">        Returns:</span>
<span class="sd">           Union[TaskEntity, None]: Object of folder or &#39;None&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">allow_query</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_or_query_entity_by_id</span><span class="p">(</span><span class="n">entity_id</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;task&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntityHub.get_or_query_entity_by_id"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.get_or_query_entity_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_or_query_entity_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">entity_types</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or query entity based on it&#39;s id and possible entity types.</span>

<span class="sd">        This is a helper function when entity id is known but entity type may</span>
<span class="sd">        have multiple possible options.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_id (str): Entity id.</span>
<span class="sd">            entity_types (Iterable[str]): Possible entity types that can the id</span>
<span class="sd">                represent. e.g. &#39;[&quot;folder&quot;, &quot;project&quot;]&#39;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">existing_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">existing_entity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">existing_entity</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_types</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">entity_type</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">entity_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="n">entity_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;folder&quot;</span><span class="p">:</span>
                <span class="n">entity_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_folder_by_id</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
                    <span class="n">entity_id</span><span class="p">,</span>
                    <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_folder_fields</span><span class="p">(),</span>
                    <span class="n">own_attributes</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">:</span>
                <span class="n">entity_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_task_by_id</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
                    <span class="n">entity_id</span><span class="p">,</span>
                    <span class="n">fields</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_task_fields</span><span class="p">(),</span>
                    <span class="n">own_attributes</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Unknonwn entity type </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">entity_data</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_data</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;folder&quot;</span><span class="p">:</span>
            <span class="n">folder_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="n">entity_data</span><span class="p">)</span>
            <span class="n">folder_entity</span><span class="o">.</span><span class="n">has_published_content</span> <span class="o">=</span> <span class="n">entity_data</span><span class="p">[</span><span class="s2">&quot;hasProducts&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">folder_entity</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">entity_data</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterator over available entities.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterator[BaseEntity]: All queried/created entities cached in hub.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">entity</span>

<div class="viewcode-block" id="EntityHub.add_new_folder"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.add_new_folder">[docs]</a>    <span class="k">def</span> <span class="nf">add_new_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create folder object and add it to entity hub.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder_type (str): Type of folder. Folder type must be available in</span>
<span class="sd">                config of project folder types.</span>
<span class="sd">            entity_id (Union[str, None]): Id of the entity. New id is created if</span>
<span class="sd">                not passed.</span>
<span class="sd">            parent_id (Union[str, None]): Id of parent entity.</span>
<span class="sd">            name (str): Name of entity.</span>
<span class="sd">            label (Optional[str]): Folder label.</span>
<span class="sd">            path (Optional[str]): Folder path. Path consist of all parent names</span>
<span class="sd">                with slash(&#39;/&#39;) used as separator.</span>
<span class="sd">            attribs (Dict[str, Any]): Attribute values.</span>
<span class="sd">            data (Dict[str, Any]): Entity data (custom data).</span>
<span class="sd">            thumbnail_id (Union[str, None]): Id of entity&#39;s thumbnail.</span>
<span class="sd">            active (bool): Is entity active.</span>
<span class="sd">            created (Optional[bool]): Entity is new. When &#39;None&#39; is passed the</span>
<span class="sd">                value is defined based on value of &#39;entity_id&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            FolderEntity: Added folder entity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder_entity</span> <span class="o">=</span> <span class="n">FolderEntity</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">entity_hub</span><span class="o">=</span><span class="bp">self</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="n">folder_entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">folder_entity</span></div>

<div class="viewcode-block" id="EntityHub.add_new_task"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.add_new_task">[docs]</a>    <span class="k">def</span> <span class="nf">add_new_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create folder object and add it to entity hub.</span>

<span class="sd">        Args:</span>
<span class="sd">            task_type (str): Type of task. Task type must be available in</span>
<span class="sd">                config of project folder types.</span>
<span class="sd">            entity_id (Union[str, None]): Id of the entity. New id is created if</span>
<span class="sd">                not passed.</span>
<span class="sd">            parent_id (Union[str, None]): Id of parent entity.</span>
<span class="sd">            name (str): Name of entity.</span>
<span class="sd">            label (Optional[str]): Folder label.</span>
<span class="sd">            attribs (Dict[str, Any]): Attribute values.</span>
<span class="sd">            data (Dict[str, Any]): Entity data (custom data).</span>
<span class="sd">            thumbnail_id (Union[str, None]): Id of entity&#39;s thumbnail.</span>
<span class="sd">            active (bool): Is entity active.</span>
<span class="sd">            created (Optional[bool]): Entity is new. When &#39;None&#39; is passed the</span>
<span class="sd">                value is defined based on value of &#39;entity_id&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TaskEntity: Added task entity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">task_entity</span> <span class="o">=</span> <span class="n">TaskEntity</span><span class="p">(</span>
            <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span> <span class="n">created</span><span class="o">=</span><span class="n">created</span><span class="p">,</span> <span class="n">entity_hub</span><span class="o">=</span><span class="bp">self</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="n">task_entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task_entity</span></div>

<div class="viewcode-block" id="EntityHub.add_folder"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.add_folder">[docs]</a>    <span class="k">def</span> <span class="nf">add_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create folder object and add it to entity hub.</span>

<span class="sd">        Args:</span>
<span class="sd">            folder (Dict[str, Any]): Folder entity data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            FolderEntity: Added folder entity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder_entity</span> <span class="o">=</span> <span class="n">FolderEntity</span><span class="o">.</span><span class="n">from_entity_data</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span> <span class="n">entity_hub</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="n">folder_entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">folder_entity</span></div>

<div class="viewcode-block" id="EntityHub.add_task"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.add_task">[docs]</a>    <span class="k">def</span> <span class="nf">add_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create task object and add it to entity hub.</span>

<span class="sd">        Args:</span>
<span class="sd">            task (Dict[str, Any]): Task entity data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            TaskEntity: Added task entity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">task_entity</span> <span class="o">=</span> <span class="n">TaskEntity</span><span class="o">.</span><span class="n">from_entity_data</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">entity_hub</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="n">task_entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">task_entity</span></div>

<div class="viewcode-block" id="EntityHub.add_entity"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.add_entity">[docs]</a>    <span class="k">def</span> <span class="nf">add_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add entity to hub cache.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity (BaseEntity): Entity that should be added to hub&#39;s cache.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity</span>
        <span class="n">parent_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parent_children</span><span class="p">:</span>
            <span class="n">parent_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span> <span class="ow">is</span> <span class="n">PROJECT_PARENT_ID</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntityHub.folder_path_reseted"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.folder_path_reseted">[docs]</a>    <span class="k">def</span> <span class="nf">folder_path_reseted</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method called from &#39;FolderEntity&#39; on path reset.</span>

<span class="sd">        This should reset cache of folder paths on all children entities.</span>

<span class="sd">        The path cache is always propagated from top to bottom so if an entity</span>
<span class="sd">        has not cached path it means that any children can&#39;t have it cached.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_reset_queue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path_reset_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_id</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_path_reset_queue</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path_reset_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_id</span><span class="p">)</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path_reset_queue</span><span class="p">:</span>
            <span class="n">children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">folder_id</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="c1"># Get child path but don&#39;t trigger cache</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">get_path</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="c1"># Reset it&#39;s path cache if is set</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">reset_path</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_path_reset_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_path_reset_queue</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="EntityHub.unset_entity_parent"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.unset_entity_parent">[docs]</a>    <span class="k">def</span> <span class="nf">unset_entity_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">):</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span>
        <span class="n">children_ids</span> <span class="o">=</span> <span class="n">UNKNOWN_VALUE</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">children_ids</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">get_children_ids</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">has_set_parent</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">has_set_parent</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">==</span> <span class="n">parent_id</span>

        <span class="n">new_parent_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">has_set_parent</span><span class="p">:</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">new_parent_id</span>

        <span class="k">if</span> <span class="n">children_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span> <span class="ow">and</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="n">children_ids</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove_child</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entity</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_set_parent</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">orig_parent_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">orig_parent_children</span><span class="p">:</span>
            <span class="n">orig_parent_children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="n">new_parent_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">new_parent_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">new_parent_children</span><span class="p">:</span>
            <span class="n">new_parent_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntityHub.set_entity_parent"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.set_entity_parent">[docs]</a>    <span class="k">def</span> <span class="nf">set_entity_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="n">orig_parent_id</span><span class="o">=</span><span class="n">_NOT_SET</span><span class="p">):</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span>
        <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">children_ids</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">get_children_ids</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">children_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span>
                    <span class="ow">and</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="n">children_ids</span>
                <span class="p">):</span>
                    <span class="n">parent</span><span class="o">.</span><span class="n">remove_child</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">orig_parent_id</span> <span class="ow">is</span> <span class="n">_NOT_SET</span><span class="p">:</span>
            <span class="n">orig_parent_id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span>
            <span class="k">if</span> <span class="n">orig_parent_id</span> <span class="o">==</span> <span class="n">parent_id</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="n">orig_parent_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">orig_parent_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">orig_parent_children</span><span class="p">:</span>
            <span class="n">orig_parent_children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="n">orig_parent_id</span><span class="p">)</span>

        <span class="n">orig_parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">orig_parent_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orig_parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">orig_parent</span><span class="o">.</span><span class="n">remove_child</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>

        <span class="n">parent_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">entity</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">parent_children</span><span class="p">:</span>
            <span class="n">parent_children</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">=</span> <span class="n">parent_id</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">parent</span><span class="o">.</span><span class="n">get_children_ids</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">parent</span><span class="o">.</span><span class="n">add_child</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_query_entity_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="n">folder_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_folder_fields</span><span class="p">()</span>
        <span class="n">task_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_task_fields</span><span class="p">()</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">folders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;project&quot;</span><span class="p">:</span>
            <span class="n">folders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_folders</span><span class="p">(</span>
                <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="n">parent_ids</span><span class="o">=</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
                <span class="n">fields</span><span class="o">=</span><span class="n">folder_fields</span><span class="p">,</span>
                <span class="n">own_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">))</span>

        <span class="k">elif</span> <span class="n">entity</span><span class="o">.</span><span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;folder&quot;</span><span class="p">:</span>
            <span class="n">folders</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_folders</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_entity</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="n">parent_ids</span><span class="o">=</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
                <span class="n">fields</span><span class="o">=</span><span class="n">folder_fields</span><span class="p">,</span>
                <span class="n">own_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">))</span>

            <span class="n">tasks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_tasks</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_entity</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
                <span class="n">folder_ids</span><span class="o">=</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">],</span>
                <span class="n">fields</span><span class="o">=</span><span class="n">task_fields</span><span class="p">,</span>
                <span class="n">own_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">))</span>

        <span class="n">children_ids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">child</span><span class="o">.</span><span class="n">id</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
            <span class="n">folder_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">folder_entity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">folder_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
                <span class="n">children_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">folder_entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">folder_entity</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">==</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="n">children_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">folder_entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">folder_entity</span><span class="o">.</span><span class="n">has_published_content</span> <span class="o">=</span> <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;hasProducts&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">task_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">task_entity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">task_entity</span><span class="o">.</span><span class="n">parent_id</span> <span class="o">==</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                    <span class="n">children_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">task_entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">task_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
            <span class="n">children_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">task_entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="n">entity</span><span class="o">.</span><span class="n">fill_children_ids</span><span class="p">(</span><span class="n">children_ids</span><span class="p">)</span>

<div class="viewcode-block" id="EntityHub.get_entity_children"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.get_entity_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_entity_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">allow_query</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">children_ids</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">get_children_ids</span><span class="p">(</span><span class="n">allow_query</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">children_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">entity</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">children_ids</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">allow_query</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">UNKNOWN_VALUE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_query_entity_children</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">entity</span><span class="o">.</span><span class="n">get_children</span><span class="p">()</span></div>

<div class="viewcode-block" id="EntityHub.delete_entity"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.delete_entity">[docs]</a>    <span class="k">def</span> <span class="nf">delete_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span>
        <span class="k">if</span> <span class="n">parent_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span><span class="o">.</span><span class="n">remove_child</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntityHub.reset_immutable_for_hierarchy_cache"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.reset_immutable_for_hierarchy_cache">[docs]</a>    <span class="k">def</span> <span class="nf">reset_immutable_for_hierarchy_cache</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">bottom_to_top</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">bottom_to_top</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">entity_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">reset_queue</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">()</span>
        <span class="n">reset_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">bottom_to_top</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">reset_queue</span><span class="p">:</span>
                <span class="n">entity_id</span> <span class="o">=</span> <span class="n">reset_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity_by_id</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">entity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">entity</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">reset_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">reset_queue</span><span class="p">:</span>
                <span class="n">entity_id</span> <span class="o">=</span> <span class="n">reset_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
                <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entity_by_id</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">entity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">entity</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">]:</span>
                    <span class="n">reset_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="EntityHub.fill_project_from_server"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.fill_project_from_server">[docs]</a>    <span class="k">def</span> <span class="nf">fill_project_from_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query project data from server and create project entity.</span>

<span class="sd">        This method will invalidate previous object of Project entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ProjectEntity: Entity that was updated with server data.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When project was not found on server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span>
        <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_project</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Project </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> was not found.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_project_entity</span> <span class="o">=</span> <span class="n">ProjectEntity</span><span class="o">.</span><span class="n">from_entity_data</span><span class="p">(</span>
            <span class="n">project</span><span class="p">,</span> <span class="bp">self</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_entity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_project_entity</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_entity</span></div>

    <span class="k">def</span> <span class="nf">_get_folder_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">folder_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;folder&quot;</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">folder_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;hasProducts&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_data_changes</span><span class="p">:</span>
            <span class="n">folder_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">folder_fields</span>

    <span class="k">def</span> <span class="nf">_get_task_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">)</span>
        <span class="p">)</span>

<div class="viewcode-block" id="EntityHub.query_entities_from_server"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.query_entities_from_server">[docs]</a>    <span class="k">def</span> <span class="nf">query_entities_from_server</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query whole project at once.&quot;&quot;&quot;</span>
        <span class="n">project_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_project_from_server</span><span class="p">()</span>

        <span class="n">folder_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_folder_fields</span><span class="p">()</span>
        <span class="n">task_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_task_fields</span><span class="p">()</span>

        <span class="n">folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_folders</span><span class="p">(</span>
            <span class="n">project_entity</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">folder_fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">get_tasks</span><span class="p">(</span>
            <span class="n">project_entity</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">task_fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">folders_by_parent_id</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;parentId&quot;</span><span class="p">]</span>
            <span class="n">folders_by_parent_id</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="n">tasks_by_parent_id</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;folderId&quot;</span><span class="p">]</span>
            <span class="n">tasks_by_parent_id</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

        <span class="n">lock_queue</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">()</span>
        <span class="n">hierarchy_queue</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">()</span>
        <span class="n">hierarchy_queue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="n">project_entity</span><span class="p">))</span>
        <span class="k">while</span> <span class="n">hierarchy_queue</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="n">hierarchy_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">parent_id</span><span class="p">,</span> <span class="n">parent_entity</span> <span class="o">=</span> <span class="n">item</span>

            <span class="n">lock_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_entity</span><span class="p">)</span>

            <span class="n">children_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders_by_parent_id</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]:</span>
                <span class="n">folder_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
                <span class="n">children_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">folder_entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">folder_entity</span><span class="o">.</span><span class="n">has_published_content</span> <span class="o">=</span> <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;hasProducts&quot;</span><span class="p">]</span>
                <span class="n">hierarchy_queue</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">folder_entity</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">folder_entity</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">tasks_by_parent_id</span><span class="p">[</span><span class="n">parent_id</span><span class="p">]:</span>
                <span class="n">task_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_task</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
                <span class="n">lock_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_entity</span><span class="p">)</span>
                <span class="n">children_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">task_entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">parent_entity</span><span class="o">.</span><span class="n">fill_children_ids</span><span class="p">(</span><span class="n">children_ids</span><span class="p">)</span>

        <span class="c1"># Lock entities when all are added to hub</span>
        <span class="c1"># - lock only entities added in this method</span>
        <span class="k">while</span> <span class="n">lock_queue</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">lock_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span></div>

<div class="viewcode-block" id="EntityHub.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_entity</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">entity</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_get_top_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">all_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">entity</span>
            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">all_ids</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_split_entities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">top_entities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_top_entities</span><span class="p">()</span>
        <span class="n">entities_queue</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">(</span><span class="n">top_entities</span><span class="p">)</span>
        <span class="n">removed_entity_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">created_entity_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">other_entity_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">entities_queue</span><span class="p">:</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="n">entities_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">removed</span>
            <span class="k">if</span> <span class="n">removed</span><span class="p">:</span>
                <span class="n">removed_entity_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">entity</span><span class="o">.</span><span class="n">created</span><span class="p">:</span>
                <span class="n">created_entity_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">other_entity_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">removed</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unset_entity_parent</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">entities_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">created_entity_ids</span><span class="p">,</span> <span class="n">other_entity_ids</span><span class="p">,</span> <span class="n">removed_entity_ids</span>

    <span class="k">def</span> <span class="nf">_get_update_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">,</span> <span class="n">changes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">changes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">changes</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">changes</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">changes</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;update&quot;</span><span class="p">,</span>
            <span class="s2">&quot;entityType&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;entityId&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">changes</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_get_create_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;create&quot;</span><span class="p">,</span>
            <span class="s2">&quot;entityType&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;entityId&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">to_create_body_data</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_get_delete_body</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;delete&quot;</span><span class="p">,</span>
            <span class="s2">&quot;entityType&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">entity_type</span><span class="p">,</span>
            <span class="s2">&quot;entityId&quot;</span><span class="p">:</span> <span class="n">entity</span><span class="o">.</span><span class="n">id</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_pre_commit_types_changes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_changes</span><span class="p">,</span> <span class="n">orig_types</span><span class="p">,</span> <span class="n">changes_key</span><span class="p">,</span> <span class="n">post_changes</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Compare changes of types on a project.</span>

<span class="sd">        Compare old and new types. Change project changes content if some old</span>
<span class="sd">        types were removed. In that case the  final change of types will</span>
<span class="sd">        happen when all other entities have changed.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_changes (dict[str, Any]): Project changes.</span>
<span class="sd">            orig_types (list[dict[str, Any]]): Original types.</span>
<span class="sd">            changes_key (Literal[folderTypes, taskTypes]): Key of type changes</span>
<span class="sd">                in project changes.</span>
<span class="sd">            post_changes (dict[str, Any]): An object where post changes will</span>
<span class="sd">                be stored.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">changes_key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">project_changes</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">new_types</span> <span class="o">=</span> <span class="n">project_changes</span><span class="p">[</span><span class="n">changes_key</span><span class="p">]</span>

        <span class="n">orig_types_by_name</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">type_info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">type_info</span>
            <span class="k">for</span> <span class="n">type_info</span> <span class="ow">in</span> <span class="n">orig_types</span>
        <span class="p">}</span>
        <span class="n">new_names</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">type_info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">type_info</span> <span class="ow">in</span> <span class="n">new_types</span>
        <span class="p">}</span>
        <span class="n">diff_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">orig_types_by_name</span><span class="p">)</span> <span class="o">-</span> <span class="n">new_names</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">diff_names</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Create copy of folder type changes to post changes</span>
        <span class="c1">#   - post changes will be commited at the end</span>
        <span class="n">post_changes</span><span class="p">[</span><span class="n">changes_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">new_types</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">type_name</span> <span class="ow">in</span> <span class="n">diff_names</span><span class="p">:</span>
            <span class="n">new_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">orig_types_by_name</span><span class="p">[</span><span class="n">type_name</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_pre_commit_project</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Some project changes cannot be committed before hierarchy changes.</span>

<span class="sd">        It is not possible to change folder types or task types if there are</span>
<span class="sd">        existing hierarchy items using the removed types. For that purposes</span>
<span class="sd">        is first committed union of all old and new types and post changes</span>
<span class="sd">        are prepared when all existing entities are changed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Changes that will be committed after hierarchy</span>
<span class="sd">                changes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_entity</span><span class="o">.</span><span class="n">changes</span>

        <span class="n">post_changes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_changes</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">post_changes</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_commit_types_changes</span><span class="p">(</span>
            <span class="n">project_changes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_entity</span><span class="o">.</span><span class="n">get_orig_folder_types</span><span class="p">(),</span>
            <span class="s2">&quot;folderType&quot;</span><span class="p">,</span>
            <span class="n">post_changes</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_pre_commit_types_changes</span><span class="p">(</span>
            <span class="n">project_changes</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_entity</span><span class="o">.</span><span class="n">get_orig_task_types</span><span class="p">(),</span>
            <span class="s2">&quot;taskType&quot;</span><span class="p">,</span>
            <span class="n">post_changes</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">update_project</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="o">**</span><span class="n">project_changes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">post_changes</span>

<div class="viewcode-block" id="EntityHub.commit_changes"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityHub.commit_changes">[docs]</a>    <span class="k">def</span> <span class="nf">commit_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Commit any changes that happened on entities.</span>

<span class="sd">        Todo:</span>
<span class="sd">            Use Operations Session instead of known operations body.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post_project_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pre_commit_project</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_entity</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>

        <span class="n">project_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_entity</span><span class="o">.</span><span class="n">changes</span>
        <span class="k">if</span> <span class="n">project_changes</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
                <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">),</span>
                <span class="o">**</span><span class="n">project_changes</span>
            <span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">project_entity</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>

        <span class="n">operations_body</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">created_entity_ids</span><span class="p">,</span> <span class="n">other_entity_ids</span><span class="p">,</span> <span class="n">removed_entity_ids</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_split_entities</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">processed_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="n">other_entity_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="n">processed_ids</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="p">[</span><span class="n">entity_id</span><span class="p">]</span>
            <span class="n">changes</span> <span class="o">=</span> <span class="n">entity</span><span class="o">.</span><span class="n">changes</span>
            <span class="n">processed_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">changes</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">bodies</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_update_body</span><span class="p">(</span><span class="n">entity</span><span class="p">,</span> <span class="n">changes</span><span class="p">)]</span>
            <span class="c1"># Parent was created and was not yet added to operations body</span>
            <span class="n">parent_queue</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">deque</span><span class="p">()</span>
            <span class="n">parent_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">parent_queue</span><span class="p">:</span>
                <span class="c1"># Make sure entity&#39;s parents are created</span>
                <span class="n">parent_id</span> <span class="o">=</span> <span class="n">parent_queue</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
                <span class="k">if</span> <span class="p">(</span>
                    <span class="n">parent_id</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span>
                    <span class="ow">or</span> <span class="n">parent_id</span> <span class="ow">in</span> <span class="n">processed_ids</span>
                    <span class="ow">or</span> <span class="n">parent_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">created_entity_ids</span>
                <span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent_id</span><span class="p">)</span>
                <span class="n">processed_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
                <span class="n">bodies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_create_body</span><span class="p">(</span><span class="n">parent</span><span class="p">))</span>
                <span class="n">parent_queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

            <span class="n">operations_body</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">bodies</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="n">created_entity_ids</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="n">processed_ids</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="p">[</span><span class="n">entity_id</span><span class="p">]</span>
            <span class="n">processed_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
            <span class="n">operations_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_create_body</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">removed_entity_ids</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">entity_id</span> <span class="ow">in</span> <span class="n">processed_ids</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_id</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
            <span class="n">parent_children</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entities_by_parent_id</span><span class="p">[</span><span class="n">entity</span><span class="o">.</span><span class="n">parent_id</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">parent_children</span><span class="p">:</span>
                <span class="n">parent_children</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">entity</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span><span class="o">.</span><span class="n">created</span><span class="p">:</span>
                <span class="n">operations_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_delete_body</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">send_batch_operations</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="n">operations_body</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">post_project_changes</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connection</span><span class="o">.</span><span class="n">update_project</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span> <span class="o">**</span><span class="n">post_project_changes</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span></div></div>


<div class="viewcode-block" id="AttributeValue"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.AttributeValue">[docs]</a><span class="k">class</span> <span class="nc">AttributeValue</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origin_value</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<div class="viewcode-block" id="AttributeValue.get_value"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.AttributeValue.get_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span></div>

<div class="viewcode-block" id="AttributeValue.set_value"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.AttributeValue.set_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="n">value</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_value</span><span class="p">,</span> <span class="n">set_value</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_origin_value</span>

<div class="viewcode-block" id="AttributeValue.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.AttributeValue.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_origin_value</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_value</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Attributes"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes">[docs]</a><span class="k">class</span> <span class="nc">Attributes</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Object representing attribs of entity.</span>

<span class="sd">    Todos:</span>
<span class="sd">        This could be enhanced to know attribute schema and validate values</span>
<span class="sd">        based on the schema.</span>

<span class="sd">    Args:</span>
<span class="sd">        attrib_keys (Iterable[str]): Keys that are available in attribs of the</span>
<span class="sd">            entity.</span>
<span class="sd">        values (Union[None, Dict[str, Any]]): Values of attributes.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attrib_keys</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span> <span class="ow">in</span> <span class="p">(</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">AttributeValue</span><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">attrib_keys</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">set_value</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">key</span>

<div class="viewcode-block" id="Attributes.keys"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="Attributes.values"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes.values">[docs]</a>    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">attribute</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Attributes.items"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes.items">[docs]</a>    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">yield</span> <span class="n">key</span><span class="p">,</span> <span class="n">attribute</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Attributes.get"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get value of attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): Attribute name.</span>
<span class="sd">            default (Any): Default value to return when attribute was not</span>
<span class="sd">                found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attribute</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attribute</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">return</span> <span class="n">attribute</span><span class="o">.</span><span class="n">value</span></div>

<div class="viewcode-block" id="Attributes.set"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes.set">[docs]</a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change value of attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): Attribute name.</span>
<span class="sd">            value (Any): New value of the attribute.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Attributes.get_attribute"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes.get_attribute">[docs]</a>    <span class="k">def</span> <span class="nf">get_attribute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access to attribute object.</span>

<span class="sd">        Args:</span>
<span class="sd">            key (str): Name of attribute.</span>

<span class="sd">        Returns:</span>
<span class="sd">            AttributeValue: Object of attribute value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: When attribute is not available.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>

<div class="viewcode-block" id="Attributes.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">attribute</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attribute value changes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Key mapping with new values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">attr_key</span><span class="p">:</span> <span class="n">attribute</span><span class="o">.</span><span class="n">value</span>
            <span class="k">for</span> <span class="n">attr_key</span><span class="p">,</span> <span class="n">attribute</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">attribute</span><span class="o">.</span><span class="n">changed</span>
        <span class="p">}</span>

<div class="viewcode-block" id="Attributes.to_dict"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.Attributes.to_dict">[docs]</a>    <span class="k">def</span> <span class="nf">to_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_none</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">value</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">ignore_none</span> <span class="ow">and</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="k">continue</span>

            <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">return</span> <span class="n">output</span></div></div>


<div class="viewcode-block" id="EntityData"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityData">[docs]</a><span class="k">class</span> <span class="nc">EntityData</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for &#39;data&#39; key on entity.</span>

<span class="sd">    Data on entity are arbitrary data that are not stored in any deterministic</span>
<span class="sd">    model. It is possible to store any data that can be parsed to json.</span>

<span class="sd">    It is not possible to store &#39;None&#39; to root key. In that case the key is</span>
<span class="sd">    not stored, and removed if existed on entity.</span>
<span class="sd">    To be able to store &#39;None&#39; value use nested data structure:</span>

<span class="sd">    .. highlight:: text</span>
<span class="sd">    .. code-block:: text</span>

<span class="sd">        {</span>
<span class="sd">            &quot;sceneInfo&quot;: {</span>
<span class="sd">                &quot;description&quot;: None,</span>
<span class="sd">                &quot;camera&quot;: &quot;camera1&quot;</span>
<span class="sd">            }</span>
<span class="sd">        }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="EntityData.get_changes"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityData.get_changes">[docs]</a>    <span class="k">def</span> <span class="nf">get_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Changes in entity data.</span>

<span class="sd">        Removed keys have value set to &#39;None&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Key mapping with changed values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1"># Key was removed</span>
                <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_data</span><span class="p">:</span>
                <span class="c1"># New value was set</span>
                <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_data</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                <span class="c1"># Value was changed</span>
                <span class="n">output</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="EntityData.get_new_entity_value"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityData.get_new_entity_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_new_entity_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Value of data for new entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Data without None values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="c1"># Ignore &#39;None&#39; values</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="EntityData.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.EntityData.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lock changes of entity data.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="BaseEntity"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity">[docs]</a><span class="k">class</span> <span class="nc">BaseEntity</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Object representation of entity from server which is capturing changes.</span>

<span class="sd">    All data on created object are expected as &quot;current data&quot; on server entity</span>
<span class="sd">    unless the entity has set &#39;created&#39; to &#39;True&#39;. So if new data should be</span>
<span class="sd">    stored to server entity then fill entity with server data first and</span>
<span class="sd">    then change them.</span>

<span class="sd">    Calling &#39;lock&#39; method will mark entity as &quot;saved&quot; and all changes made on</span>
<span class="sd">    entity are set as &quot;current data&quot; on server.</span>

<span class="sd">    Args:</span>
<span class="sd">        entity_id (Union[str, None]): Id of the entity. New id is created if</span>
<span class="sd">            not passed.</span>
<span class="sd">        parent_id (Union[str, None]): Id of parent entity.</span>
<span class="sd">        name (str): Name of entity.</span>
<span class="sd">        attribs (Dict[str, Any]): Attribute values.</span>
<span class="sd">        data (Dict[str, Any]): Entity data (custom data).</span>
<span class="sd">        thumbnail_id (Union[str, None]): Id of entity&#39;s thumbnail.</span>
<span class="sd">        active (bool): Is entity active.</span>
<span class="sd">        entity_hub (EntityHub): Object of entity hub which created object of</span>
<span class="sd">            the entity.</span>
<span class="sd">        created (Optional[bool]): Entity is new. When &#39;None&#39; is passed the</span>
<span class="sd">            value is defined based on value of &#39;entity_id&#39;.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">entity_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_id</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span>
        <span class="n">attribs</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span>
        <span class="n">thumbnail_id</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span>
        <span class="n">entity_hub</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">created</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">entity_hub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Missing required kwarg &#39;entity_hub&#39;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span> <span class="o">=</span> <span class="n">entity_hub</span>

        <span class="k">if</span> <span class="n">created</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">created</span> <span class="o">=</span> <span class="n">entity_id</span> <span class="ow">is</span> <span class="kc">None</span>

        <span class="n">entity_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_entity_id</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EntityData</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">EntityData</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">children_ids</span> <span class="o">=</span> <span class="n">UNKNOWN_VALUE</span>
        <span class="k">if</span> <span class="n">created</span><span class="p">:</span>
            <span class="n">children_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">created</span> <span class="ow">and</span> <span class="n">parent_id</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Existing entity is missing parent id.&quot;</span><span class="p">)</span>

        <span class="c1"># These are public without any validation at this moment</span>
        <span class="c1">#   may change in future (e.g. name will have regex validation)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_id</span> <span class="o">=</span> <span class="n">entity_id</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span> <span class="o">=</span> <span class="n">parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="o">=</span> <span class="n">active</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created</span> <span class="o">=</span> <span class="n">created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thumbnail_id</span> <span class="o">=</span> <span class="n">thumbnail_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attribs</span> <span class="o">=</span> <span class="n">Attributes</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_attributes_for_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">entity_type</span><span class="p">),</span>
            <span class="n">attribs</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span> <span class="o">=</span> <span class="n">children_ids</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_parent_id</span> <span class="o">=</span> <span class="n">parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_thumbnail_id</span> <span class="o">=</span> <span class="n">thumbnail_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_active</span> <span class="o">=</span> <span class="n">active</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_entity_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
        <span class="n">entity_id</span> <span class="o">=</span> <span class="n">convert_entity_id</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">entity_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entity_id</span> <span class="o">=</span> <span class="n">create_entity_id</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">entity_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access to entity id under which is entity available on server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Entity id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">removed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span> <span class="ow">is</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orig_parent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_parent_id</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">attribs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entity attributes based on server configuration.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Attributes: Attributes object handling changes and values of</span>
<span class="sd">                attributes on entity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attribs</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entity custom data that are not stored by any deterministic model.</span>

<span class="sd">        Be aware that &#39;data&#39; can&#39;t be queried using GraphQl and cannot be</span>
<span class="sd">            updated partially.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EntityData: Custom data on entity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">project_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Quick access to project from entity hub.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Name of project under which entity lives.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">project_name</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">entity_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entity type coresponding to server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Literal[project, folder, task]: Entity type.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">parent_entity_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entity type coresponding to server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Iterable[str]: Possible entity types of parent.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Receive entity changes.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[Dict[str, Any], None]: All values that have changed on</span>
<span class="sd">                entity. New entity must return None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

<div class="viewcode-block" id="BaseEntity.from_entity_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.from_entity_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">from_entity_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">entity_data</span><span class="p">,</span> <span class="n">entity_hub</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create entity based on queried data from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_data (Dict[str, Any]): Entity data from server.</span>
<span class="sd">            entity_hub (EntityHub): Hub which handle the entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BaseEntity: Object of the class.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="BaseEntity.to_create_body_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.to_create_body_data">[docs]</a>    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">to_create_body_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert object of entity to data for server on creation.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Entity data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">immutable_for_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entity is immutable for hierarchy changes.</span>

<span class="sd">        Hierarchy changes can be considered as change of name or parents.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Entity is immutable for hierarchy changes.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span>

        <span class="n">immutable_for_hierarchy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy</span>
        <span class="k">if</span> <span class="n">immutable_for_hierarchy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span> <span class="o">=</span> <span class="n">immutable_for_hierarchy</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span>

        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">get_entity_children</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">child</span><span class="o">.</span><span class="n">immutable_for_hierarchy</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_immutable_for_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Override this method to define if entity object is immutable.</span>

<span class="sd">        This property was added to define immutable state of Folder entities</span>
<span class="sd">        which is used in property &#39;immutable_for_hierarchy&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[bool, None]: Bool to explicitly telling if is immutable or</span>
<span class="sd">                not otherwise None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_cached_immutable_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>

<div class="viewcode-block" id="BaseEntity.reset_immutable_for_hierarchy_cache"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.reset_immutable_for_hierarchy_cache">[docs]</a>    <span class="k">def</span> <span class="nf">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bottom_to_top</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Clear cache of immutable hierarchy property.</span>

<span class="sd">        This is used when entity changed parent or a child was added.</span>

<span class="sd">        Args:</span>
<span class="sd">            bottom_to_top (bool): Reset cache from top hierarchy to bottom or</span>
<span class="sd">                from bottom hierarchy to top.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">bottom_to_top</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_default_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Collect changes of common data on entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Any]: Changes on entity. Key and it&#39;s new value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">allow_data_changes</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span>
        <span class="p">):</span>
            <span class="n">data_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get_changes</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">data_changes</span><span class="p">:</span>
                <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_changes</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_thumbnail_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thumbnail_id</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thumbnail_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_active</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span>

        <span class="n">attrib_changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">changes</span>
        <span class="k">if</span> <span class="n">attrib_changes</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;attrib&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrib_changes</span>
        <span class="k">return</span> <span class="n">changes</span>

    <span class="k">def</span> <span class="nf">_get_attributes_for_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">get_attributes_for_type</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>

<div class="viewcode-block" id="BaseEntity.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lock entity as &#39;saved&#39; so all changes are discarded.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_parent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_thumbnail_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_id</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">EntityData</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attribs</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_immutable_for_hierarchy_cache</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_created</span> <span class="o">=</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">_get_entity_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">get_entity_by_id</span><span class="p">(</span><span class="n">entity_id</span><span class="p">)</span>

<div class="viewcode-block" id="BaseEntity.get_name"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span></div>

<div class="viewcode-block" id="BaseEntity.set_name"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span></div>

    <span class="n">name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_name</span><span class="p">,</span> <span class="n">set_name</span><span class="p">)</span>

<div class="viewcode-block" id="BaseEntity.get_parent_id"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.get_parent_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_parent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parent entity id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Id of parent entity or none if is not set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span></div>

<div class="viewcode-block" id="BaseEntity.set_parent_id"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.set_parent_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_parent_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change parent by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent_id (Union[str, None]): Id of new parent for entity.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If parent was not found by id.</span>
<span class="sd">            TypeError: If validation of parent does not pass.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">parent_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span><span class="p">:</span>
            <span class="n">orig_parent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span> <span class="o">=</span> <span class="n">parent_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">set_entity_parent</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">,</span> <span class="n">orig_parent_id</span>
            <span class="p">)</span></div>

    <span class="n">parent_id</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_parent_id</span><span class="p">,</span> <span class="n">set_parent_id</span><span class="p">)</span>

<div class="viewcode-block" id="BaseEntity.get_parent"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.get_parent">[docs]</a>    <span class="k">def</span> <span class="nf">get_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_query</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parent entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[BaseEntity, None]: Parent object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">get_entity_by_id</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">parent</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_query</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">get_or_query_entity_by_id</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_entity_types</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="BaseEntity.set_parent"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.set_parent">[docs]</a>    <span class="k">def</span> <span class="nf">set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change parent object.</span>

<span class="sd">        Args:</span>
<span class="sd">            parent (BaseEntity): New parent for entity.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: If validation of parent does not pass.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">set_entity_parent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">)</span></div>

    <span class="n">parent</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_parent</span><span class="p">,</span> <span class="n">set_parent</span><span class="p">)</span>

<div class="viewcode-block" id="BaseEntity.get_children_ids"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.get_children_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_children_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_query</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access to children objects.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Children should be maybe handled by EntityHub instead of entities</span>
<span class="sd">                themselves. That would simplify &#39;set_entity_parent&#39;,</span>
<span class="sd">                &#39;unset_entity_parent&#39; and other logic related to changing</span>
<span class="sd">                hierarchy.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[List[str], Type[UNKNOWN_VALUE]]: Children iterator.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_query</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">get_entity_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span><span class="p">)</span></div>

    <span class="n">children_ids</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_children_ids</span><span class="p">)</span>

<div class="viewcode-block" id="BaseEntity.get_children"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.get_children">[docs]</a>    <span class="k">def</span> <span class="nf">get_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_query</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access to children objects.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[List[BaseEntity], Type[UNKNOWN_VALUE]]: Children iterator.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow_query</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">get_entity_children</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">get_entity_by_id</span><span class="p">(</span><span class="n">children_id</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">children_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span>
        <span class="p">]</span></div>

    <span class="n">children</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_children</span><span class="p">)</span>

<div class="viewcode-block" id="BaseEntity.add_child"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.add_child">[docs]</a>    <span class="k">def</span> <span class="nf">add_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add child entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            child (BaseEntity): Child object to add.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: When child object has invalid type to be children.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child_id</span> <span class="o">=</span> <span class="n">child</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="n">BaseEntity</span><span class="p">):</span>
            <span class="n">child_id</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">set_entity_parent</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseEntity.remove_child"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.remove_child">[docs]</a>    <span class="k">def</span> <span class="nf">remove_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove child entity.</span>

<span class="sd">        Is ignored if child is not in children.</span>

<span class="sd">        Args:</span>
<span class="sd">            child (Union[str, BaseEntity]): Child object or child id to remove.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">child_id</span> <span class="o">=</span> <span class="n">child</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="n">BaseEntity</span><span class="p">):</span>
            <span class="n">child_id</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="n">child_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">unset_entity_parent</span><span class="p">(</span><span class="n">child_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

<div class="viewcode-block" id="BaseEntity.get_thumbnail_id"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.get_thumbnail_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_thumbnail_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Thumbnail id of entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Id of parent entity or none if is not set.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_thumbnail_id</span></div>

<div class="viewcode-block" id="BaseEntity.set_thumbnail_id"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.set_thumbnail_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_thumbnail_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change thumbnail id.</span>

<span class="sd">        Args:</span>
<span class="sd">            thumbnail_id (Union[str, None]): Id of thumbnail for entity.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_thumbnail_id</span> <span class="o">=</span> <span class="n">thumbnail_id</span></div>

    <span class="n">thumbnail_id</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_thumbnail_id</span><span class="p">,</span> <span class="n">set_thumbnail_id</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">created</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Entity is new.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Entity is newly created.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_created</span>

<div class="viewcode-block" id="BaseEntity.fill_children_ids"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.BaseEntity.fill_children_ids">[docs]</a>    <span class="k">def</span> <span class="nf">fill_children_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">children_ids</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fill children ids on entity.</span>

<span class="sd">        Warning:</span>
<span class="sd">            This is not an api call but is called from entity hub.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">children_ids</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ProjectStatus"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus">[docs]</a><span class="k">class</span> <span class="nc">ProjectStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Project status class.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): Name of the status. e.g. &#39;In progress&#39;</span>
<span class="sd">        short_name (Optional[str]): Short name of the status. e.g. &#39;IP&#39;</span>
<span class="sd">        state (Optional[Literal[not_started, in_progress, done, blocked]]): A</span>
<span class="sd">            state of the status.</span>
<span class="sd">        icon (Optional[str]): Icon of the status. e.g. &#39;play_arrow&#39;.</span>
<span class="sd">        color (Optional[str]): Color of the status. e.g. &#39;#eeeeee&#39;.</span>
<span class="sd">        index (Optional[int]): Index of the status.</span>
<span class="sd">        project_statuses (Optional[_ProjectStatuses]): Project statuses</span>
<span class="sd">            wrapper.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">valid_states</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;not_started&quot;</span><span class="p">,</span> <span class="s2">&quot;in_progress&quot;</span><span class="p">,</span> <span class="s2">&quot;done&quot;</span><span class="p">,</span> <span class="s2">&quot;blocked&quot;</span><span class="p">)</span>
    <span class="n">color_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;#([a-f0-9]</span><span class="si">{6}</span><span class="s2">)$&quot;</span><span class="p">)</span>
    <span class="n">default_state</span> <span class="o">=</span> <span class="s2">&quot;in_progress&quot;</span>
    <span class="n">default_color</span> <span class="o">=</span> <span class="s2">&quot;#eeeeee&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">short_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">project_statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_new</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="n">short_name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">icon</span> <span class="o">=</span> <span class="n">icon</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">state</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_state</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_short_name</span> <span class="o">=</span> <span class="n">short_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">icon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slugified_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">color</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_original_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_short_name</span> <span class="o">=</span> <span class="n">short_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_icon</span> <span class="o">=</span> <span class="n">icon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_index</span> <span class="o">=</span> <span class="n">index</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span> <span class="o">=</span> <span class="n">project_statuses</span>
        <span class="k">if</span> <span class="n">is_new</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">is_new</span> <span class="o">=</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">project_statuses</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_new</span> <span class="o">=</span> <span class="n">is_new</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="p">:</span>
            <span class="n">short_name</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2"> </span><span class="si">{}{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">short_name</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">,</span> <span class="s2">&quot;icon&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">,</span> <span class="s2">&quot;slugified_name&quot;</span>
        <span class="p">}:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">,</span> <span class="s2">&quot;icon&quot;</span><span class="p">,</span> <span class="s2">&quot;state&quot;</span><span class="p">,</span> <span class="s2">&quot;color&quot;</span><span class="p">}:</span>
            <span class="k">return</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="ProjectStatus.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lock status.</span>

<span class="sd">        Changes were commited and current values are now the original values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_is_new</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_short_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_icon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">icon</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span></div>

<div class="viewcode-block" id="ProjectStatus.slugify_name"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.slugify_name">[docs]</a>    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">slugify_name</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Slugify status name for name comparison.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Slugified name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">slugify_string</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span></div>

<div class="viewcode-block" id="ProjectStatus.get_project_statuses"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.get_project_statuses">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal logic method.</span>

<span class="sd">        Returns:</span>
<span class="sd">            _ProjectStatuses: Project statuses object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span></div>

<div class="viewcode-block" id="ProjectStatus.set_project_statuses"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.set_project_statuses">[docs]</a>    <span class="k">def</span> <span class="nf">set_project_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_statuses</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal logic method to change parent object.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_statuses (_ProjectStatuses): Project statuses object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span> <span class="o">=</span> <span class="n">project_statuses</span></div>

<div class="viewcode-block" id="ProjectStatus.unset_project_statuses"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.unset_project_statuses">[docs]</a>    <span class="k">def</span> <span class="nf">unset_project_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_statuses</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Internal logic method to unset parent object.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_statuses (_ProjectStatuses): Project statuses object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span> <span class="ow">is</span> <span class="n">project_statuses</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="kc">None</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Status has changed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Status has changed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_is_new</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_short_name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_name</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_index</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_state</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_icon</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icon</span>
            <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_color</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_color</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ProjectStatus.delete"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove status from project statuses object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectStatus.get_index"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.get_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get index of status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[int, None]: Index of status or None if status is not under</span>
<span class="sd">                project.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span></div>

<div class="viewcode-block" id="ProjectStatus.set_index"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.set_index">[docs]</a>    <span class="k">def</span> <span class="nf">set_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change status index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[int, None]: Index of status or None if status is not under</span>
<span class="sd">                project.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;from_parent&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span><span class="o">.</span><span class="n">set_status_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectStatus.get_name"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.get_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Status name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Status name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span></div>

<div class="viewcode-block" id="ProjectStatus.set_name"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.set_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change status name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): New status name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Name must be a string.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_slugified_name</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ProjectStatus.get_short_name"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.get_short_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Status short name 3 letters tops.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Status short name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_short_name</span></div>

<div class="viewcode-block" id="ProjectStatus.set_short_name"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.set_short_name">[docs]</a>    <span class="k">def</span> <span class="nf">set_short_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">short_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change status short name.</span>

<span class="sd">        Args:</span>
<span class="sd">            short_name (str): New status short name. 3 letters tops.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">short_name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Short name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_short_name</span> <span class="o">=</span> <span class="n">short_name</span></div>

<div class="viewcode-block" id="ProjectStatus.get_icon"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.get_icon">[docs]</a>    <span class="k">def</span> <span class="nf">get_icon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of icon to use for status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Name of the icon.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_icon</span></div>

<div class="viewcode-block" id="ProjectStatus.set_icon"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.set_icon">[docs]</a>    <span class="k">def</span> <span class="nf">set_icon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">icon</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change status icon name.</span>

<span class="sd">        Args:</span>
<span class="sd">            icon (str): Name of the icon.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">icon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Icon name must be a string.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_icon</span> <span class="o">=</span> <span class="n">icon</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">slugified_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Slugified and lowere status name.</span>

<span class="sd">        Can be used for comparison of existing statuses. e.g. &#39;In Progress&#39;</span>
<span class="sd">            vs. &#39;in-progress&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Slugified and lower status name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slugified_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_slugified_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slugify_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_slugified_name</span>

<div class="viewcode-block" id="ProjectStatus.get_state"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.get_state">[docs]</a>    <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get state of project status.</span>

<span class="sd">        Return:</span>
<span class="sd">            Literal[not_started, in_progress, done, blocked]: General</span>
<span class="sd">                state of status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span></div>

<div class="viewcode-block" id="ProjectStatus.set_state"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.set_state">[docs]</a>    <span class="k">def</span> <span class="nf">set_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set color of project status.</span>

<span class="sd">        Args:</span>
<span class="sd">            state (Literal[not_started, in_progress, done, blocked]): General</span>
<span class="sd">                state of status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_states</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid state &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">state</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_state</span> <span class="o">=</span> <span class="n">state</span></div>

<div class="viewcode-block" id="ProjectStatus.get_color"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.get_color">[docs]</a>    <span class="k">def</span> <span class="nf">get_color</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get color of project status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Status color.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_color</span></div>

<div class="viewcode-block" id="ProjectStatus.set_color"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.set_color">[docs]</a>    <span class="k">def</span> <span class="nf">set_color</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">color</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set color of project status.</span>

<span class="sd">        Args:</span>
<span class="sd">            color (str): Color in hex format. Example: &#39;#ff0000&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Color must be string got &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">color</span><span class="p">)))</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">color</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color_regex</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">color</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid color value &#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">color</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_color</span> <span class="o">=</span> <span class="n">color</span></div>

    <span class="n">name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_name</span><span class="p">,</span> <span class="n">set_name</span><span class="p">)</span>
    <span class="n">short_name</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_short_name</span><span class="p">,</span> <span class="n">set_short_name</span><span class="p">)</span>
    <span class="n">project_statuses</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_project_statuses</span><span class="p">,</span> <span class="n">set_project_statuses</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_index</span><span class="p">,</span> <span class="n">set_index</span><span class="p">)</span>
    <span class="n">state</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_state</span><span class="p">,</span> <span class="n">set_state</span><span class="p">)</span>
    <span class="n">color</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_color</span><span class="p">,</span> <span class="n">set_color</span><span class="p">)</span>
    <span class="n">icon</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_icon</span><span class="p">,</span> <span class="n">set_icon</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_other_p_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate if other status can be used for move.</span>

<span class="sd">        To be able to work with other status, and position them in relation,</span>
<span class="sd">        they must belong to same existing object of &#39;_ProjectStatuses&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (ProjectStatus): Other status to validate.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">o_project_statuses</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">project_statuses</span>
        <span class="n">m_project_statuses</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_statuses</span>
        <span class="k">if</span> <span class="n">o_project_statuses</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">m_project_statuses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Both statuses are not assigned to a project.&quot;</span><span class="p">)</span>

        <span class="n">missing_status</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">o_project_statuses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">missing_status</span> <span class="o">=</span> <span class="n">other</span>
        <span class="k">elif</span> <span class="n">m_project_statuses</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">missing_status</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">missing_status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Status &#39;</span><span class="si">{}</span><span class="s2">&#39; is not assigned to a project.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">missing_status</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">m_project_statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">o_project_statuses</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Statuse are assigned to different projects.&quot;</span>
                <span class="s2">&quot; Cannot execute move.&quot;</span>
            <span class="p">)</span>

<div class="viewcode-block" id="ProjectStatus.move_before"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.move_before">[docs]</a>    <span class="k">def</span> <span class="nf">move_before</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move status before other status.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (ProjectStatus): Status to move before.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_other_p_statuses</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span><span class="o">.</span><span class="n">set_status_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectStatus.move_after"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.move_after">[docs]</a>    <span class="k">def</span> <span class="nf">move_after</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Move status after other status.</span>

<span class="sd">        Args:</span>
<span class="sd">            other (ProjectStatus): Status to move after.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_other_p_statuses</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_project_statuses</span><span class="o">.</span><span class="n">set_status_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectStatus.to_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.to_data">[docs]</a>    <span class="k">def</span> <span class="nf">to_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert status to data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Status data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;shortName&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">short_name</span><span class="p">,</span>
            <span class="s2">&quot;state&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="p">,</span>
            <span class="s2">&quot;icon&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">icon</span><span class="p">,</span>
            <span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_new</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_name</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_name</span>
        <span class="p">):</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;original_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_name</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="ProjectStatus.from_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectStatus.from_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">project_statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create project status from data.</span>

<span class="sd">        Args:</span>
<span class="sd">            data (dict[str, str]): Status data.</span>
<span class="sd">            index (Optional[int]): Status index.</span>
<span class="sd">            project_statuses (Optional[ProjectStatuses]): Project statuses</span>
<span class="sd">                object which wraps the status for a project.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;shortName&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;short_name&quot;</span><span class="p">)),</span>
            <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;state&quot;</span><span class="p">),</span>
            <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;icon&quot;</span><span class="p">),</span>
            <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;color&quot;</span><span class="p">),</span>
            <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span>
            <span class="n">project_statuses</span><span class="o">=</span><span class="n">project_statuses</span>
        <span class="p">)</span></div></div>


<span class="k">class</span> <span class="nc">_ProjectStatuses</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Wrapper for project statuses.</span>

<span class="sd">    Supports basic methods to add, change or remove statuses from a project.</span>

<span class="sd">    To add new statuses use &#39;create&#39; or &#39;add_status&#39; methods. To change</span>
<span class="sd">        statuses receive them by one of the getter methods and change their</span>
<span class="sd">        values.</span>

<span class="sd">    Todo:</span>
<span class="sd">        Validate if statuses are duplicated.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statuses</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ProjectStatus</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_called</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Iterate over statuses.</span>

<span class="sd">        Yields:</span>
<span class="sd">            ProjectStatus: Project status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">short_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create project status.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of the status. e.g. &#39;In progress&#39;</span>
<span class="sd">            short_name (Optional[str]): Short name of the status. e.g. &#39;IP&#39;</span>
<span class="sd">            state (Optional[Literal[not_started, in_progress, done, blocked]]): A</span>
<span class="sd">                state of the status.</span>
<span class="sd">            icon (Optional[str]): Icon of the status. e.g. &#39;play_arrow&#39;.</span>
<span class="sd">            color (Optional[str]): Color of the status. e.g. &#39;#eeeeee&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ProjectStatus: Created project status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">ProjectStatus</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">short_name</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">icon</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">is_new</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Lock statuses.</span>

<span class="sd">        Changes were commited and current values are now the original values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status_length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_called</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">:</span>
            <span class="n">status</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">to_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert to project statuses data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="n">status</span><span class="o">.</span><span class="n">to_data</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statuses</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Explicitly override statuses.</span>

<span class="sd">        This method does not handle if statuses changed or not.</span>

<span class="sd">        Args:</span>
<span class="sd">            statuses (list[dict[str, str]]): List of statuses data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_set_called</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ProjectStatus</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
        <span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">changed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Statuses have changed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if statuses changed, False otherwise.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_called</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1"># Check if status length changed</span>
        <span class="c1">#   - when all statuses are removed it is a changed</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status_length</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="c1"># Go through all statuses and check if any of them changed</span>
        <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">changed</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get status by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Status name.</span>
<span class="sd">            default (Any): Default value of status is not found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[ProjectStatus, Any]: Status or default value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">status</span>
                <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span>
                <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">name</span>
            <span class="p">),</span>
            <span class="n">default</span>
        <span class="p">)</span>

    <span class="n">get_status_by_name</span> <span class="o">=</span> <span class="n">get</span>

    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get status index.</span>

<span class="sd">        Args:</span>
<span class="sd">            status (ProjectStatus): Status to get index of.</span>
<span class="sd">            default (Optional[Any]): Default value if status is not found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[int, Any]: Status index.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If status is not found and default value is not</span>
<span class="sd">                defined.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">idx</span>
                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">st</span> <span class="ow">is</span> <span class="n">status</span>
            <span class="p">),</span>
            <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">output</span>

        <span class="k">if</span> <span class="s2">&quot;default&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;default&quot;</span><span class="p">]</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Status &#39;</span><span class="si">{}</span><span class="s2">&#39; not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">get_status_by_slugified_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get status by slugified name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Status name. Is slugified before search.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[ProjectStatus, None]: Status or None if not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">slugified_name</span> <span class="o">=</span> <span class="n">ProjectStatus</span><span class="o">.</span><span class="n">slugify_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="n">status</span>
                <span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span>
                <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">slugified_name</span> <span class="o">==</span> <span class="n">slugified_name</span>
            <span class="p">),</span>
            <span class="kc">None</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove status by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Status name.</span>
<span class="sd">            ignore_missing (Optional[bool]): If True, no error is raised if</span>
<span class="sd">                status is not found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ProjectStatus: Removed status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">matching_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matching_status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_missing</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Status &#39;</span><span class="si">{}</span><span class="s2">&#39; not found in project&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">matching_status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">ignore_missing</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove status.</span>

<span class="sd">        Args:</span>
<span class="sd">            status (ProjectStatus): Status to remove.</span>
<span class="sd">            ignore_missing (Optional[bool]): If True, no error is raised if</span>
<span class="sd">                status is not found.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[ProjectStatus, None]: Removed status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_missing</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Status &#39;</span><span class="si">{}</span><span class="s2">&#39; not in project&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove status by index.</span>

<span class="sd">        Args:</span>
<span class="sd">            index (int): Status index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ProjectStatus: Removed status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">status</span><span class="o">.</span><span class="n">unset_project_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">[</span><span class="n">index</span><span class="p">:]:</span>
            <span class="n">st</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">st</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">from_parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Insert status at index.</span>

<span class="sd">        Args:</span>
<span class="sd">            index (int): Status index.</span>
<span class="sd">            status (Union[ProjectStatus, dict[str, str]]): Status to insert.</span>
<span class="sd">                Can be either status object or status data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ProjectStatus: Inserted status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">ProjectStatus</span><span class="p">):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">ProjectStatus</span><span class="o">.</span><span class="n">from_data</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

        <span class="n">start_index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="n">end_index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">matching_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">matching_index</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">matching_index</span> <span class="o">==</span> <span class="n">index</span><span class="p">:</span>
                <span class="n">status</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">from_parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">matching_index</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">matching_index</span> <span class="o">&lt;</span> <span class="n">index</span><span class="p">:</span>
                <span class="n">start_index</span> <span class="o">=</span> <span class="n">matching_index</span>
                <span class="n">end_index</span> <span class="o">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">end_index</span> <span class="o">-=</span> <span class="mi">1</span>

        <span class="n">status</span><span class="o">.</span><span class="n">set_project_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">[</span><span class="n">start_index</span><span class="p">:</span><span class="n">end_index</span><span class="p">]):</span>
            <span class="n">st</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">start_index</span> <span class="o">+</span> <span class="n">idx</span><span class="p">,</span> <span class="n">from_parent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">status</span>

    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add new status to the end of the list.</span>

<span class="sd">        Args:</span>
<span class="sd">            status (Union[ProjectStatus, dict[str, str]]): Status to insert.</span>
<span class="sd">                Can be either status object or status data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ProjectStatus: Inserted status.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_statuses</span><span class="p">),</span> <span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_status_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set status index.</span>

<span class="sd">        Args:</span>
<span class="sd">            status (ProjectStatus): Status to set index.</span>
<span class="sd">            index (int): New status index.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>


<div class="viewcode-block" id="ProjectEntity"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity">[docs]</a><span class="k">class</span> <span class="nc">ProjectEntity</span><span class="p">(</span><span class="n">BaseEntity</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entity representing project on AYON server.</span>

<span class="sd">    Args:</span>
<span class="sd">        project_code (str): Project code.</span>
<span class="sd">        library (bool): Is project library project.</span>
<span class="sd">        folder_types (list[dict[str, Any]]): Folder types definition.</span>
<span class="sd">        task_types (list[dict[str, Any]]): Task types definition.</span>
<span class="sd">        entity_id (Optional[str]): Id of the entity. New id is created if</span>
<span class="sd">            not passed.</span>
<span class="sd">        parent_id (Union[str, None]): Id of parent entity.</span>
<span class="sd">        name (str): Name of entity.</span>
<span class="sd">        attribs (Dict[str, Any]): Attribute values.</span>
<span class="sd">        data (Dict[str, Any]): Entity data (custom data).</span>
<span class="sd">        thumbnail_id (Union[str, None]): Id of entity&#39;s thumbnail.</span>
<span class="sd">        active (bool): Is entity active.</span>
<span class="sd">        entity_hub (EntityHub): Object of entity hub which created object of</span>
<span class="sd">            the entity.</span>
<span class="sd">        created (Optional[bool]): Entity is new. When &#39;None&#39; is passed the</span>
<span class="sd">            value is defined based on value of &#39;entity_id&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">entity_type</span> <span class="o">=</span> <span class="s2">&quot;project&quot;</span>
    <span class="n">parent_entity_types</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># TODO These are hardcoded but maybe should be used from server???</span>
    <span class="n">default_folder_type_icon</span> <span class="o">=</span> <span class="s2">&quot;folder&quot;</span>
    <span class="n">default_task_type_icon</span> <span class="o">=</span> <span class="s2">&quot;task_alt&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_code</span><span class="p">,</span>
        <span class="n">library</span><span class="p">,</span>
        <span class="n">folder_types</span><span class="p">,</span>
        <span class="n">task_types</span><span class="p">,</span>
        <span class="n">statuses</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ProjectEntity</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_project_code</span> <span class="o">=</span> <span class="n">project_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_library_project</span> <span class="o">=</span> <span class="n">library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_folder_types</span> <span class="o">=</span> <span class="n">folder_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task_types</span> <span class="o">=</span> <span class="n">task_types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statuses_obj</span> <span class="o">=</span> <span class="n">_ProjectStatuses</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_project_code</span> <span class="o">=</span> <span class="n">project_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_library_project</span> <span class="o">=</span> <span class="n">library</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_folder_types</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">folder_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_task_types</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">task_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_statuses</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_prepare_entity_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">entity_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Unexpected entity id value </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">. Expected </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">entity_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">entity_id</span>

<div class="viewcode-block" id="ProjectEntity.get_parent"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.get_parent">[docs]</a>    <span class="k">def</span> <span class="nf">get_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ProjectEntity.set_parent"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.set_parent">[docs]</a>    <span class="k">def</span> <span class="nf">set_parent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Parent of project cannot be set to </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="p">)</span></div>

    <span class="n">parent</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_parent</span><span class="p">,</span> <span class="n">set_parent</span><span class="p">)</span>

<div class="viewcode-block" id="ProjectEntity.get_orig_folder_types"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.get_orig_folder_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_orig_folder_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_folder_types</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectEntity.get_folder_types"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.get_folder_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_folder_types</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectEntity.set_folder_types"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.set_folder_types">[docs]</a>    <span class="k">def</span> <span class="nf">set_folder_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_types</span><span class="p">):</span>
        <span class="n">new_folder_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">folder_type</span> <span class="ow">in</span> <span class="n">folder_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;icon&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">folder_type</span><span class="p">:</span>
                <span class="n">folder_type</span><span class="p">[</span><span class="s2">&quot;icon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_folder_type_icon</span>
            <span class="n">new_folder_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">folder_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_folder_types</span> <span class="o">=</span> <span class="n">new_folder_types</span></div>

<div class="viewcode-block" id="ProjectEntity.get_orig_task_types"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.get_orig_task_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_orig_task_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_task_types</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectEntity.get_task_types"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.get_task_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_types</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_types</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectEntity.set_task_types"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.set_task_types">[docs]</a>    <span class="k">def</span> <span class="nf">set_task_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_types</span><span class="p">):</span>
        <span class="n">new_task_types</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">task_type</span> <span class="ow">in</span> <span class="n">task_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;icon&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">task_type</span><span class="p">:</span>
                <span class="n">task_type</span><span class="p">[</span><span class="s2">&quot;icon&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_task_type_icon</span>
            <span class="n">new_task_types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_type</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task_types</span> <span class="o">=</span> <span class="n">new_task_types</span></div>

<div class="viewcode-block" id="ProjectEntity.get_orig_statuses"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.get_orig_statuses">[docs]</a>    <span class="k">def</span> <span class="nf">get_orig_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_orig_statuses</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectEntity.get_statuses"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.get_statuses">[docs]</a>    <span class="k">def</span> <span class="nf">get_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses_obj</span></div>

<div class="viewcode-block" id="ProjectEntity.set_statuses"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.set_statuses">[docs]</a>    <span class="k">def</span> <span class="nf">set_statuses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">statuses</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statuses_obj</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span></div>

    <span class="n">folder_types</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_folder_types</span><span class="p">,</span> <span class="n">set_folder_types</span><span class="p">)</span>
    <span class="n">task_types</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_task_types</span><span class="p">,</span> <span class="n">set_task_types</span><span class="p">)</span>
    <span class="n">statuses</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_statuses</span><span class="p">,</span> <span class="n">set_statuses</span><span class="p">)</span>

<div class="viewcode-block" id="ProjectEntity.get_status_by_slugified_name"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.get_status_by_slugified_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_status_by_slugified_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find status by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Status name.</span>


<span class="sd">        Returns:</span>
<span class="sd">            Union[ProjectStatus, None]: Status object or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses_obj</span><span class="o">.</span><span class="n">get_status_by_slugified_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProjectEntity.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">ProjectEntity</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_folder_types</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_folder_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_task_types</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_task_types</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_statuses_obj</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_changes</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_folder_types</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_folder_types</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;folderTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folder_types</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_task_types</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_types</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;taskTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_task_types</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses_obj</span><span class="o">.</span><span class="n">changed</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;statuses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_statuses_obj</span><span class="o">.</span><span class="n">to_data</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">changes</span>

<div class="viewcode-block" id="ProjectEntity.from_entity_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.from_entity_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_entity_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">project</span><span class="p">,</span> <span class="n">entity_hub</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">project</span><span class="p">[</span><span class="s2">&quot;code&quot;</span><span class="p">],</span>
            <span class="n">parent_id</span><span class="o">=</span><span class="n">PROJECT_PARENT_ID</span><span class="p">,</span>
            <span class="n">entity_id</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">library</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">],</span>
            <span class="n">folder_types</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;folderTypes&quot;</span><span class="p">],</span>
            <span class="n">task_types</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;taskTypes&quot;</span><span class="p">],</span>
            <span class="n">statuses</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;statuses&quot;</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">attribs</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">],</span>
            <span class="n">entity_hub</span><span class="o">=</span><span class="n">entity_hub</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ProjectEntity.to_create_body_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.ProjectEntity.to_create_body_data">[docs]</a>    <span class="k">def</span> <span class="nf">to_create_body_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;ProjectEntity does not support conversion to entity data&quot;</span>
        <span class="p">)</span></div></div>


<div class="viewcode-block" id="FolderEntity"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity">[docs]</a><span class="k">class</span> <span class="nc">FolderEntity</span><span class="p">(</span><span class="n">BaseEntity</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entity representing a folder on AYON server.</span>

<span class="sd">    Args:</span>
<span class="sd">        folder_type (str): Type of folder. Folder type must be available in</span>
<span class="sd">            config of project folder types.</span>
<span class="sd">        entity_id (Union[str, None]): Id of the entity. New id is created if</span>
<span class="sd">            not passed.</span>
<span class="sd">        parent_id (Union[str, None]): Id of parent entity.</span>
<span class="sd">        name (str): Name of entity.</span>
<span class="sd">        attribs (Dict[str, Any]): Attribute values.</span>
<span class="sd">        data (Dict[str, Any]): Entity data (custom data).</span>
<span class="sd">        thumbnail_id (Union[str, None]): Id of entity&#39;s thumbnail.</span>
<span class="sd">        active (bool): Is entity active.</span>
<span class="sd">        label (Optional[str]): Folder label.</span>
<span class="sd">        path (Optional[str]): Folder path. Path consist of all parent names</span>
<span class="sd">            with slash(&#39;/&#39;) used as separator.</span>
<span class="sd">        entity_hub (EntityHub): Object of entity hub which created object of</span>
<span class="sd">            the entity.</span>
<span class="sd">        created (Optional[bool]): Entity is new. When &#39;None&#39; is passed the</span>
<span class="sd">            value is defined based on value of &#39;entity_id&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">entity_type</span> <span class="o">=</span> <span class="s2">&quot;folder&quot;</span>
    <span class="n">parent_entity_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;folder&quot;</span><span class="p">,</span> <span class="s2">&quot;project&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">folder_type</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FolderEntity</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># Autofill project as parent of folder if is not yet set</span>
        <span class="c1"># - this can be guessed only if folder was just created</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_folder_type</span> <span class="o">=</span> <span class="n">folder_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_folder_type</span> <span class="o">=</span> <span class="n">folder_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_tags</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="c1"># Know if folder has any products</span>
        <span class="c1"># - is used to know if folder allows hierarchy changes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_has_published_content</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>

<div class="viewcode-block" id="FolderEntity.get_folder_type"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.get_folder_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_folder_type</span></div>

<div class="viewcode-block" id="FolderEntity.set_folder_type"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.set_folder_type">[docs]</a>    <span class="k">def</span> <span class="nf">set_folder_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">folder_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_folder_type</span> <span class="o">=</span> <span class="n">folder_type</span></div>

    <span class="n">folder_type</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_folder_type</span><span class="p">,</span> <span class="n">set_folder_type</span><span class="p">)</span>

<div class="viewcode-block" id="FolderEntity.get_label"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.get_label">[docs]</a>    <span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span></div>

<div class="viewcode-block" id="FolderEntity.set_label"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.set_label">[docs]</a>    <span class="k">def</span> <span class="nf">set_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span></div>

    <span class="n">label</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_label</span><span class="p">,</span> <span class="n">set_label</span><span class="p">)</span>

<div class="viewcode-block" id="FolderEntity.get_status"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Folder status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, UNKNOWN_VALUE]: Folder status or &#39;UNKNOWN_VALUE&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span></div>

<div class="viewcode-block" id="FolderEntity.set_status"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.set_status">[docs]</a>    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set folder status.</span>

<span class="sd">        Args:</span>
<span class="sd">            status_name (str): Status name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">project_entity</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">project_entity</span><span class="o">.</span><span class="n">get_status_by_slugified_name</span><span class="p">(</span><span class="n">status_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Status </span><span class="si">{</span><span class="n">status_name</span><span class="si">}</span><span class="s2"> is not available on project.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status_name</span></div>

    <span class="n">status</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_status</span><span class="p">,</span> <span class="n">set_status</span><span class="p">)</span>

<div class="viewcode-block" id="FolderEntity.get_tags"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.get_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Folder tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: Folder tags.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span></div>

<div class="viewcode-block" id="FolderEntity.set_tags"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.set_tags">[docs]</a>    <span class="k">def</span> <span class="nf">set_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            tags (Iterable[str]): Tags.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span></div>

    <span class="n">tags</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_tags</span><span class="p">,</span> <span class="n">set_tags</span><span class="p">)</span>

<div class="viewcode-block" id="FolderEntity.get_path"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.get_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dynamic_value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">dynamic_value</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span>
            <span class="k">if</span> <span class="n">parent</span><span class="o">.</span><span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;folder&quot;</span><span class="p">:</span>
                <span class="n">parent_path</span> <span class="o">=</span> <span class="n">parent</span><span class="o">.</span><span class="n">path</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">parent_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">path_start_with_slash</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_path</span></div>

<div class="viewcode-block" id="FolderEntity.reset_path"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.reset_path">[docs]</a>    <span class="k">def</span> <span class="nf">reset_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">folder_path_reseted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

    <span class="n">path</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_path</span><span class="p">)</span>

<div class="viewcode-block" id="FolderEntity.get_has_published_content"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.get_has_published_content">[docs]</a>    <span class="k">def</span> <span class="nf">get_has_published_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_published_content</span></div>

<div class="viewcode-block" id="FolderEntity.set_has_published_content"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.set_has_published_content">[docs]</a>    <span class="k">def</span> <span class="nf">set_has_published_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">has_published_content</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_has_published_content</span> <span class="ow">is</span> <span class="n">has_published_content</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_has_published_content</span> <span class="o">=</span> <span class="n">has_published_content</span>
        <span class="c1"># Reset immutable cache of parents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">reset_immutable_for_hierarchy_cache</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)</span></div>

    <span class="n">has_published_content</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">get_has_published_content</span><span class="p">,</span> <span class="n">set_has_published_content</span>
    <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_immutable_for_hierarchy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_published_content</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="FolderEntity.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">FolderEntity</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_label_value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_folder_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_folder_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_tags</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_changes</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_parent_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span><span class="p">:</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span>
            <span class="k">if</span> <span class="n">parent_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">:</span>
                <span class="n">parent_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;parentId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_folder_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_folder_type</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;folderType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_folder_type</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_tags</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span>

        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_label_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_label</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>

        <span class="k">return</span> <span class="n">changes</span>

<div class="viewcode-block" id="FolderEntity.from_entity_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.from_entity_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_entity_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">entity_hub</span><span class="p">):</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;parentId&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">parent_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="n">entity_hub</span><span class="o">.</span><span class="n">project_entity</span><span class="o">.</span><span class="n">id</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;folderType&quot;</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
            <span class="n">path</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span>
            <span class="n">status</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
            <span class="n">tags</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">],</span>
            <span class="n">entity_id</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">parent_id</span><span class="o">=</span><span class="n">parent_id</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">folder</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">),</span>
            <span class="n">attribs</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">],</span>
            <span class="n">thumbnail_id</span><span class="o">=</span><span class="n">folder</span><span class="p">[</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">],</span>
            <span class="n">created</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">entity_hub</span><span class="o">=</span><span class="n">entity_hub</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="FolderEntity.to_create_body_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.FolderEntity.to_create_body_data">[docs]</a>    <span class="k">def</span> <span class="nf">to_create_body_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">parent_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span>
        <span class="k">if</span> <span class="n">parent_id</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Folder does not have set &#39;parent_id&#39;&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">:</span>
            <span class="n">parent_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Folder does not have set &#39;name&#39;&quot;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;folderType&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">folder_type</span><span class="p">,</span>
            <span class="s2">&quot;parentId&quot;</span><span class="p">:</span> <span class="n">parent_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_label_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>

        <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">attrib</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;attrib&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrib</span>

        <span class="c1"># Add tags only if are available</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thumbnail_id</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">allow_data_changes</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span>
        <span class="p">):</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get_new_entity_value</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output</span></div>

    <span class="k">def</span> <span class="nf">_get_label_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get label value that will be used for operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Label value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">label</span></div>


<div class="viewcode-block" id="TaskEntity"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity">[docs]</a><span class="k">class</span> <span class="nc">TaskEntity</span><span class="p">(</span><span class="n">BaseEntity</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Entity representing a task on AYON server.</span>

<span class="sd">    Args:</span>
<span class="sd">        task_type (str): Type of task. Task type must be available in config</span>
<span class="sd">            of project task types.</span>
<span class="sd">        entity_id (Union[str, None]): Id of the entity. New id is created if</span>
<span class="sd">            not passed.</span>
<span class="sd">        parent_id (Union[str, None]): Id of parent entity.</span>
<span class="sd">        name (str): Name of entity.</span>
<span class="sd">        label (Optional[str]): Task label.</span>
<span class="sd">        attribs (Dict[str, Any]): Attribute values.</span>
<span class="sd">        data (Dict[str, Any]): Entity data (custom data).</span>
<span class="sd">        thumbnail_id (Union[str, None]): Id of entity&#39;s thumbnail.</span>
<span class="sd">        active (bool): Is entity active.</span>
<span class="sd">        entity_hub (EntityHub): Object of entity hub which created object of</span>
<span class="sd">            the entity.</span>
<span class="sd">        created (Optional[bool]): Entity is new. When &#39;None&#39; is passed the</span>
<span class="sd">            value is defined based on value of &#39;entity_id&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">entity_type</span> <span class="o">=</span> <span class="s2">&quot;task&quot;</span>
    <span class="n">parent_entity_types</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;folder&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task_type</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assignees</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="n">UNKNOWN_VALUE</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TaskEntity</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">assignees</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assignees</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">assignees</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">assignees</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_task_type</span> <span class="o">=</span> <span class="n">task_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="n">tags</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assignees</span> <span class="o">=</span> <span class="n">assignees</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_task_type</span> <span class="o">=</span> <span class="n">task_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_label</span> <span class="o">=</span> <span class="n">label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_tags</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_assignees</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">assignees</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_children_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

<div class="viewcode-block" id="TaskEntity.lock"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.lock">[docs]</a>    <span class="k">def</span> <span class="nf">lock</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TaskEntity</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_label_value</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_task_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_tags</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orig_assignees</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_assignees</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaskEntity.get_task_type"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.get_task_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_type</span></div>

<div class="viewcode-block" id="TaskEntity.set_task_type"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.set_task_type">[docs]</a>    <span class="k">def</span> <span class="nf">set_task_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_type</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_task_type</span> <span class="o">=</span> <span class="n">task_type</span></div>

    <span class="n">task_type</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_task_type</span><span class="p">,</span> <span class="n">set_task_type</span><span class="p">)</span>

<div class="viewcode-block" id="TaskEntity.get_label"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.get_label">[docs]</a>    <span class="k">def</span> <span class="nf">get_label</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span></div>

<div class="viewcode-block" id="TaskEntity.set_label"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.set_label">[docs]</a>    <span class="k">def</span> <span class="nf">set_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">label</span></div>

    <span class="n">label</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_label</span><span class="p">,</span> <span class="n">set_label</span><span class="p">)</span>

<div class="viewcode-block" id="TaskEntity.get_status"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Task status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, UNKNOWN_VALUE]: Task status or &#39;UNKNOWN_VALUE&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span></div>

<div class="viewcode-block" id="TaskEntity.set_status"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.set_status">[docs]</a>    <span class="k">def</span> <span class="nf">set_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set Task status.</span>

<span class="sd">        Args:</span>
<span class="sd">            status_name (str): Status name.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">project_entity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">project_entity</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">project_entity</span><span class="o">.</span><span class="n">get_status_by_slugified_name</span><span class="p">(</span><span class="n">status_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Status </span><span class="si">{</span><span class="n">status_name</span><span class="si">}</span><span class="s2"> is not available on project.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_status</span> <span class="o">=</span> <span class="n">status_name</span></div>

    <span class="n">status</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_status</span><span class="p">,</span> <span class="n">set_status</span><span class="p">)</span>

<div class="viewcode-block" id="TaskEntity.get_tags"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.get_tags">[docs]</a>    <span class="k">def</span> <span class="nf">get_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Task tags.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: Task tags.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span></div>

<div class="viewcode-block" id="TaskEntity.set_tags"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.set_tags">[docs]</a>    <span class="k">def</span> <span class="nf">set_tags</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tags</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change tags.</span>

<span class="sd">        Args:</span>
<span class="sd">            tags (Iterable[str]): Tags.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span></div>

    <span class="n">tags</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_tags</span><span class="p">,</span> <span class="n">set_tags</span><span class="p">)</span>

<div class="viewcode-block" id="TaskEntity.get_assignees"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.get_assignees">[docs]</a>    <span class="k">def</span> <span class="nf">get_assignees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Task assignees.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: Task assignees.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assignees</span></div>

<div class="viewcode-block" id="TaskEntity.set_assignees"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.set_assignees">[docs]</a>    <span class="k">def</span> <span class="nf">set_assignees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">assignees</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change assignees.</span>

<span class="sd">        Args:</span>
<span class="sd">            assignees (Iterable[str]): assignees.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assignees</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">assignees</span><span class="p">)</span></div>

    <span class="n">assignees</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_assignees</span><span class="p">,</span> <span class="n">set_assignees</span><span class="p">)</span>

<div class="viewcode-block" id="TaskEntity.add_child"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.add_child">[docs]</a>    <span class="k">def</span> <span class="nf">add_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">child</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Task does not support to add children&quot;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">changes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_changes</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_parent_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;folderId&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parent_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_task_type</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_type</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;taskType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_task_type</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_status</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_status</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_tags</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tags</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_assignees</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assignees</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;assignees&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assignees</span>

        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_label_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orig_label</span><span class="p">:</span>
            <span class="n">changes</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>

        <span class="k">return</span> <span class="n">changes</span>

<div class="viewcode-block" id="TaskEntity.from_entity_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.from_entity_data">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_entity_data</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">entity_hub</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">task</span><span class="p">[</span><span class="s2">&quot;taskType&quot;</span><span class="p">],</span>
            <span class="n">entity_id</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">],</span>
            <span class="n">status</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">],</span>
            <span class="n">tags</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">],</span>
            <span class="n">assignees</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;assignees&quot;</span><span class="p">],</span>
            <span class="n">parent_id</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;folderId&quot;</span><span class="p">],</span>
            <span class="n">name</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
            <span class="n">data</span><span class="o">=</span><span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">),</span>
            <span class="n">attribs</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="n">task</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">],</span>
            <span class="n">created</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">entity_hub</span><span class="o">=</span><span class="n">entity_hub</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="TaskEntity.to_create_body_data"><a class="viewcode-back" href="../../ayon_api.entity_hub.html#ayon_api.entity_hub.TaskEntity.to_create_body_data">[docs]</a>    <span class="k">def</span> <span class="nf">to_create_body_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span> <span class="ow">is</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Task does not have set &#39;parent_id&#39;&quot;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;taskType&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">task_type</span><span class="p">,</span>
            <span class="s2">&quot;folderId&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent_id</span><span class="p">,</span>
            <span class="s2">&quot;attrib&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_label_value</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">label</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">label</span>

        <span class="n">attrib</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">attribs</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">attrib</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;attrib&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">attrib</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">active</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;tags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tags</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignees</span><span class="p">:</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;assignees&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignees</span>

        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_hub</span><span class="o">.</span><span class="n">allow_data_changes</span>
            <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">UNKNOWN_VALUE</span>
        <span class="p">):</span>
            <span class="n">output</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get_new_entity_value</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">output</span></div>

    <span class="k">def</span> <span class="nf">_get_label_value</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get label value that will be used for operations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Label value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_label</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">label</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_name</span> <span class="o">==</span> <span class="n">label</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">label</span></div>
</pre></div>

					 </div>
					 
					</div>
					<footer>
  

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2024, ynput.io <info@ynput.io>
	  <br>
      
      
      
      Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
      
      <a href="https://github.com/revitron/revitron-sphinx-theme">theme</a>
      
      provided by <a href="https://github.com/revitron">Revitron</a>.

    </p>
  </div> 

</footer>

				</div>
			</div>

		</section>

	</div>
	

	<script type="text/javascript">
			jQuery(function () {
					SphinxRtdTheme.Navigation.enable(true);
			});
	</script>

	
	
		
	 

 
</body>	
</html>