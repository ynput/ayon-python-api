
	

<!DOCTYPE html>
<html class="writer-html5 " lang="en" >
<head>
	<meta charset="utf-8">
	
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
		<title>ayon_api.server_api &mdash; ayon-python-api 1.0.9-dev.1 documentation</title>
	
	
	
	<link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
	<link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />

	
	
	
	
		<link rel="canonical" href="https://github.com/ynput/ayon-python-api_modules/ayon_api/server_api.html"/>
	

	
	<!--[if lt IE 9]>
		<script src="../../_static/js/html5shiv.min.js"></script>
	<![endif]-->
	
		
			<script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
				<script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
				<script src="../../_static/jquery.js"></script>
				<script src="../../_static/underscore.js"></script>
				<script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
				<script src="../../_static/doctools.js"></script>
				<script src="../../_static/sphinx_highlight.js"></script>
		
		<script type="text/javascript" src="../../_static/js/theme.js"></script>

		
		<link rel="index" title="Index" href="../../genindex.html" />
		<link rel="search" title="Search" href="../../search.html" /> 
</head>
<body class="wy-body-for-nav">


	 
	<div class="wy-grid-for-nav">
		
		<nav data-toggle="wy-nav-shift" class="wy-nav-side">
			<div class="wy-side-scroll">
				<div class="wy-side-nav-search">
					
						<div class="brand">
							<a href="../../index.html">
							
								<img src="../../_static/AYON_blackG_dot.svg" class="logo" alt="Logo"/>
							
							</a>
						</div>
						
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
					
				</div>
				
				<div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
					
						
						
							
						
						
							<!-- Local TOC -->
							<div class="local-toc"></div>
						
					
				</div>
				
			</div>
		</nav>

		<section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

			
			<nav class="wy-nav-top" aria-label="top navigation">
			
				<i data-toggle="wy-nav-top" class="fa fa-bars"></i>
				<a href="../../index.html">
					
						<img src="../../_static/AYON_blackG_dot.svg" class="logo" alt="Logo"/>
					
				</a>
			
			</nav>


			<div class="wy-nav-content">
				
				<div class="rst-content">
				
					<div role="navigation" aria-label="breadcrumbs navigation">

	<ul class="wy-breadcrumbs">
		
			
				<li><a href="../../index.html">ayon-python-api</a> ⁄&nbsp;</li>
				
					<li><a href="../index.html">Module code</a> ⁄&nbsp;</li>
				
				<li><a href="">ayon_api.server_api</a></li>
			
		
		
			<li class="wy-breadcrumbs-aside">
			
				<a href="https://github.com/ynput/ayon-python-api" class="fa fa-github-alt"></a>
			
			</li>
		
	</ul>

</div>
					<div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
					 <div itemprop="articleBody">
						
  <h1>Source code for ayon_api.server_api</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;Server API.</span>

<span class="sd">Provides access to server API.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">uuid</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">contextlib</span> <span class="kn">import</span> <span class="n">contextmanager</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">http</span> <span class="kn">import</span> <span class="n">HTTPStatus</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">HTTPStatus</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># This should be used if &#39;requests&#39; have it available</span>
    <span class="kn">from</span> <span class="nn">requests.exceptions</span> <span class="kn">import</span> <span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">RequestsJSONDecodeError</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="c1"># Older versions of &#39;requests&#39; don&#39;t have custom exception for json</span>
    <span class="c1">#   decode error</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">simplejson</span> <span class="kn">import</span> <span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">RequestsJSONDecodeError</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">RequestsJSONDecodeError</span>

<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">SERVER_RETRIES_ENV_KEY</span><span class="p">,</span>
    <span class="n">DEFAULT_FOLDER_TYPE_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_TASK_TYPE_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_PRODUCT_TYPE_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_PROJECT_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_FOLDER_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_TASK_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_PRODUCT_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_VERSION_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_REPRESENTATION_FIELDS</span><span class="p">,</span>
    <span class="n">REPRESENTATION_FILES_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_WORKFILE_INFO_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_EVENT_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_USER_FIELDS</span><span class="p">,</span>
    <span class="n">DEFAULT_LINK_FIELDS</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.graphql</span> <span class="kn">import</span> <span class="n">GraphQlQuery</span><span class="p">,</span> <span class="n">INTROSPECTION_QUERY</span>
<span class="kn">from</span> <span class="nn">.graphql_queries</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">project_graphql_query</span><span class="p">,</span>
    <span class="n">projects_graphql_query</span><span class="p">,</span>
    <span class="n">project_product_types_query</span><span class="p">,</span>
    <span class="n">product_types_query</span><span class="p">,</span>
    <span class="n">folders_graphql_query</span><span class="p">,</span>
    <span class="n">tasks_graphql_query</span><span class="p">,</span>
    <span class="n">tasks_by_folder_paths_graphql_query</span><span class="p">,</span>
    <span class="n">products_graphql_query</span><span class="p">,</span>
    <span class="n">versions_graphql_query</span><span class="p">,</span>
    <span class="n">representations_graphql_query</span><span class="p">,</span>
    <span class="n">representations_hierarchy_qraphql_query</span><span class="p">,</span>
    <span class="n">workfiles_info_graphql_query</span><span class="p">,</span>
    <span class="n">events_graphql_query</span><span class="p">,</span>
    <span class="n">users_graphql_query</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.exceptions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FailedOperations</span><span class="p">,</span>
    <span class="n">UnauthorizedError</span><span class="p">,</span>
    <span class="n">AuthenticationError</span><span class="p">,</span>
    <span class="n">ServerNotReached</span><span class="p">,</span>
    <span class="n">ServerError</span><span class="p">,</span>
    <span class="n">HTTPRequestError</span><span class="p">,</span>
    <span class="n">UnsupportedServerVersion</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">RepresentationParents</span><span class="p">,</span>
    <span class="n">RepresentationHierarchy</span><span class="p">,</span>
    <span class="n">prepare_query_string</span><span class="p">,</span>
    <span class="n">logout_from_server</span><span class="p">,</span>
    <span class="n">create_entity_id</span><span class="p">,</span>
    <span class="n">entity_data_json_default</span><span class="p">,</span>
    <span class="n">failed_json_default</span><span class="p">,</span>
    <span class="n">TransferProgress</span><span class="p">,</span>
    <span class="n">ThumbnailContent</span><span class="p">,</span>
    <span class="n">get_default_timeout</span><span class="p">,</span>
    <span class="n">get_default_settings_variant</span><span class="p">,</span>
    <span class="n">get_default_site_id</span><span class="p">,</span>
    <span class="n">NOT_SET</span><span class="p">,</span>
    <span class="n">get_media_mime_type</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">PatternType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
<span class="n">JSONDecodeError</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">json</span><span class="p">,</span> <span class="s2">&quot;JSONDecodeError&quot;</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">)</span>
<span class="c1"># This should be collected from server schema</span>
<span class="n">PROJECT_NAME_ALLOWED_SYMBOLS</span> <span class="o">=</span> <span class="s2">&quot;a-zA-Z0-9_&quot;</span>
<span class="n">PROJECT_NAME_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="s2">&quot;^[</span><span class="si">{}</span><span class="s2">]+$&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PROJECT_NAME_ALLOWED_SYMBOLS</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">_PLACEHOLDER</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>

<span class="n">VERSION_REGEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s2">&quot;(?P&lt;major&gt;0|[1-9]\d*)&quot;</span>
    <span class="sa">r</span><span class="s2">&quot;\.(?P&lt;minor&gt;0|[1-9]\d*)&quot;</span>
    <span class="sa">r</span><span class="s2">&quot;\.(?P&lt;patch&gt;0|[1-9]\d*)&quot;</span>
    <span class="sa">r</span><span class="s2">&quot;(?:-(?P&lt;prerelease&gt;[a-zA-Z\d\-.]*))?&quot;</span>
    <span class="sa">r</span><span class="s2">&quot;(?:\+(?P&lt;buildmetadata&gt;[a-zA-Z\d\-.]*))?&quot;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">_get_description</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">HTTPStatus</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">orig_response</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HTTPStatus</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">description</span>


<div class="viewcode-block" id="RequestType"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.RequestType">[docs]</a><span class="k">class</span> <span class="nc">RequestType</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="fm">__hash__</span><span class="p">()</span></div>


<div class="viewcode-block" id="RequestTypes"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.RequestTypes">[docs]</a><span class="k">class</span> <span class="nc">RequestTypes</span><span class="p">:</span>
    <span class="n">get</span> <span class="o">=</span> <span class="n">RequestType</span><span class="p">(</span><span class="s2">&quot;GET&quot;</span><span class="p">)</span>
    <span class="n">post</span> <span class="o">=</span> <span class="n">RequestType</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">)</span>
    <span class="n">put</span> <span class="o">=</span> <span class="n">RequestType</span><span class="p">(</span><span class="s2">&quot;PUT&quot;</span><span class="p">)</span>
    <span class="n">patch</span> <span class="o">=</span> <span class="n">RequestType</span><span class="p">(</span><span class="s2">&quot;PATCH&quot;</span><span class="p">)</span>
    <span class="n">delete</span> <span class="o">=</span> <span class="n">RequestType</span><span class="p">(</span><span class="s2">&quot;DELETE&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="RestApiResponse"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.RestApiResponse">[docs]</a><span class="k">class</span> <span class="nc">RestApiResponse</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;API Response.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">status_code</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">status_code</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_response</span> <span class="o">=</span> <span class="n">response</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status_code</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">text</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">detail</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span><span class="o">.</span><span class="n">text</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orig_response</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span><span class="o">.</span><span class="n">headers</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orig_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">RequestsJSONDecodeError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span><span class="o">.</span><span class="n">content</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">content_type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">detail</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detail&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">detail</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">detail</span>
        <span class="k">return</span> <span class="n">_get_description</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">status_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span>

<div class="viewcode-block" id="RestApiResponse.raise_for_status"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.RestApiResponse.raise_for_status">[docs]</a>    <span class="k">def</span> <span class="nf">raise_for_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detail&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">ServerError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="s2">&quot;detail&quot;</span><span class="p">])</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Response is not available.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">401</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">UnauthorizedError</span><span class="p">(</span><span class="s2">&quot;Missing or invalid authentication token&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">message</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">HTTPRequestError</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">exc</span><span class="o">.</span><span class="n">response</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_response</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2"> [</span><span class="si">{}</span><span class="s2">]&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="mi">200</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">200</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">&lt;</span> <span class="mi">400</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

<div class="viewcode-block" id="RestApiResponse.get"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.RestApiResponse.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">default</span></div></div>


<div class="viewcode-block" id="GraphQlResponse"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.GraphQlResponse">[docs]</a><span class="k">class</span> <span class="nc">GraphQlResponse</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;GraphQl response.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">errors</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;errors&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2"> errors=</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">errors</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;message&#39;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;&lt;</span><span class="si">{}</span><span class="s2">&gt;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span></div>


<div class="viewcode-block" id="fill_own_attribs"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.fill_own_attribs">[docs]</a><span class="k">def</span> <span class="nf">fill_own_attribs</span><span class="p">(</span><span class="n">entity</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">entity</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">):</span>
        <span class="k">return</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">])</span>

    <span class="n">own_attrib</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">own_attrib</span>

    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;attrib&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">:</span>
            <span class="n">own_attrib</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">own_attrib</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">_AsUserStack</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle stack of users used over server api connection in service mode.</span>

<span class="sd">    ServerAPI can behave as other users if it is using special API key.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; stack = _AsUserStack()</span>
<span class="sd">        &gt;&gt;&gt; stack.set_default_username(&quot;DefaultName&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(stack.username)</span>
<span class="sd">        DefaultName</span>
<span class="sd">        &gt;&gt;&gt; with stack.as_user(&quot;Other1&quot;):</span>
<span class="sd">        ...     print(stack.username)</span>
<span class="sd">        ...     with stack.as_user(&quot;Other2&quot;):</span>
<span class="sd">        ...         print(stack.username)</span>
<span class="sd">        ...     print(stack.username)</span>
<span class="sd">        ...     stack.clear()</span>
<span class="sd">        ...     print(stack.username)</span>
<span class="sd">        Other1</span>
<span class="sd">        Other2</span>
<span class="sd">        Other1</span>
<span class="sd">        None</span>
<span class="sd">        &gt;&gt;&gt; print(stack.username)</span>
<span class="sd">        None</span>
<span class="sd">        &gt;&gt;&gt; stack.set_default_username(&quot;DefaultName&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(stack.username)</span>
<span class="sd">        DefaultName</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_users_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_user</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_user</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_users_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_user</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_user</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Use &#39;_user_ids&#39; for boolean check to have ability &quot;unset&quot;</span>
        <span class="c1">#   default user</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_user</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_user</span>

    <span class="k">def</span> <span class="nf">get_default_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_user</span>

    <span class="k">def</span> <span class="nf">set_default_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_user</span> <span class="o">=</span> <span class="n">username</span>

    <span class="n">default_username</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_default_username</span><span class="p">,</span> <span class="n">set_default_username</span><span class="p">)</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">as_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_user</span> <span class="o">=</span> <span class="n">username</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_users_by_id</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_users_by_id</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># First check if is the user id the last one</span>
            <span class="n">was_last</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">user_id</span>
            <span class="c1"># Remove id from variables</span>
            <span class="k">if</span> <span class="n">user_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">was_last</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="n">new_last_user</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span><span class="p">:</span>
                <span class="n">new_last_user</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_users_by_id</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_user_ids</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_user</span> <span class="o">=</span> <span class="n">new_last_user</span>


<div class="viewcode-block" id="ServerAPI"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI">[docs]</a><span class="k">class</span> <span class="nc">ServerAPI</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Base handler of connection to server.</span>

<span class="sd">    Requires url to server which is used as base for api and graphql calls.</span>

<span class="sd">    Login cause that a session is used</span>

<span class="sd">    Args:</span>
<span class="sd">        base_url (str): Example: http://localhost:5000</span>
<span class="sd">        token (Optional[str]): Access token (api key) to server.</span>
<span class="sd">        site_id (Optional[str]): Unique name of site. Should be the same when</span>
<span class="sd">            connection is created from the same machine under same user.</span>
<span class="sd">        client_version (Optional[str]): Version of client application (used in</span>
<span class="sd">            desktop client application).</span>
<span class="sd">        default_settings_variant (Optional[Literal[&quot;production&quot;, &quot;staging&quot;]]):</span>
<span class="sd">            Settings variant used by default if a method for settings won&#39;t</span>
<span class="sd">            get any (by default is &#39;production&#39;).</span>
<span class="sd">        sender (Optional[str]): Sender of requests. Used in server logs and</span>
<span class="sd">            propagated into events.</span>
<span class="sd">        ssl_verify (Union[bool, str, None]): Verify SSL certificate</span>
<span class="sd">            Looks for env variable value ``AYON_CA_FILE`` by default. If not</span>
<span class="sd">            available then &#39;True&#39; is used.</span>
<span class="sd">        cert (Optional[str]): Path to certificate file. Looks for env</span>
<span class="sd">            variable value ``AYON_CERT_FILE`` by default.</span>
<span class="sd">        create_session (Optional[bool]): Create session for connection if</span>
<span class="sd">            token is available. Default is True.</span>
<span class="sd">        timeout (Optional[float]): Timeout for requests.</span>
<span class="sd">        max_retries (Optional[int]): Number of retries for requests.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_default_max_retries</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="c1"># 1 MB chunk by default</span>
    <span class="c1"># TODO find out if these are reasonable default value</span>
    <span class="n">default_download_chunk_size</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
    <span class="n">default_upload_chunk_size</span> <span class="o">=</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">base_url</span><span class="p">,</span>
        <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">site_id</span><span class="o">=</span><span class="n">NOT_SET</span><span class="p">,</span>
        <span class="n">client_version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">default_settings_variant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ssl_verify</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">cert</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">create_session</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">timeout</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">base_url</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid server URL </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">base_url</span><span class="p">)))</span>

        <span class="n">base_url</span> <span class="o">=</span> <span class="n">base_url</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span> <span class="o">=</span> <span class="n">base_url</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/api&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_graphql_url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/graphql&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">base_url</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="c1"># Allow to have &#39;site_id&#39; to &#39;None&#39;</span>
        <span class="k">if</span> <span class="n">site_id</span> <span class="ow">is</span> <span class="n">NOT_SET</span><span class="p">:</span>
            <span class="n">site_id</span> <span class="o">=</span> <span class="n">get_default_site_id</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_site_id</span> <span class="o">=</span> <span class="n">site_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_client_version</span> <span class="o">=</span> <span class="n">client_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_settings_variant</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">default_settings_variant</span>
            <span class="ow">or</span> <span class="n">get_default_settings_variant</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sender</span> <span class="o">=</span> <span class="n">sender</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set timeout and max retries based on passed values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_timeout</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_max_retries</span><span class="p">(</span><span class="n">max_retries</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ssl_verify</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Custom AYON env variable for CA file or &#39;True&#39;</span>
            <span class="c1"># - that should cover most default behaviors in &#39;requests&#39;</span>
            <span class="c1">#   with &#39;certifi&#39;</span>
            <span class="n">ssl_verify</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AYON_CA_FILE&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">cert</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cert</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;AYON_CERT_FILE&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_verify</span> <span class="o">=</span> <span class="n">ssl_verify</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cert</span> <span class="o">=</span> <span class="n">cert</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_is_valid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_validation_started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_available</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_server_version_tuple</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_graphql_allows_data_in_query</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_base_functions_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">get</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">post</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">put</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">put</span><span class="p">,</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">patch</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">delete</span><span class="p">:</span> <span class="n">requests</span><span class="o">.</span><span class="n">delete</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_functions_mapping</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Attributes cache</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_schema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type_attributes_cache</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span> <span class="o">=</span> <span class="n">_AsUserStack</span><span class="p">()</span>

        <span class="c1"># Create session</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="ow">and</span> <span class="n">create_session</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_server_availability</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_session</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log</span>

<div class="viewcode-block" id="ServerAPI.get_base_url"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_base_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_base_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_url"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span></div>

    <span class="n">base_url</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_base_url</span><span class="p">)</span>
    <span class="n">rest_url</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_rest_url</span><span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_ssl_verify"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_ssl_verify">[docs]</a>    <span class="k">def</span> <span class="nf">get_ssl_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable ssl verification.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Current state of ssl verification.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_verify</span></div>

<div class="viewcode-block" id="ServerAPI.set_ssl_verify"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_ssl_verify">[docs]</a>    <span class="k">def</span> <span class="nf">set_ssl_verify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ssl_verify</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change ssl verification state.</span>

<span class="sd">        Args:</span>
<span class="sd">            ssl_verify (Union[bool, str, None]): Enabled/disable</span>
<span class="sd">                ssl verification, can be a path to file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_verify</span> <span class="o">==</span> <span class="n">ssl_verify</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_verify</span> <span class="o">=</span> <span class="n">ssl_verify</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="n">ssl_verify</span></div>

<div class="viewcode-block" id="ServerAPI.get_cert"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_cert">[docs]</a>    <span class="k">def</span> <span class="nf">get_cert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Current cert file used for connection to server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Path to cert file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cert</span></div>

<div class="viewcode-block" id="ServerAPI.set_cert"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_cert">[docs]</a>    <span class="k">def</span> <span class="nf">set_cert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cert</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change cert file used for connection to server.</span>

<span class="sd">        Args:</span>
<span class="sd">            cert (Union[str, None]): Path to cert file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cert</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cert</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cert</span> <span class="o">=</span> <span class="n">cert</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">cert</span> <span class="o">=</span> <span class="n">cert</span></div>

    <span class="n">ssl_verify</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_ssl_verify</span><span class="p">,</span> <span class="n">set_ssl_verify</span><span class="p">)</span>
    <span class="n">cert</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_cert</span><span class="p">,</span> <span class="n">set_cert</span><span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_default_timeout"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_default_timeout">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default_timeout</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default value for requests timeout.</span>

<span class="sd">        Utils function &#39;get_default_timeout&#39; is used by default.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Timeout value in seconds.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">get_default_timeout</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.get_default_max_retries"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_default_max_retries">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_default_max_retries</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default value for requests max retries.</span>

<span class="sd">        First looks for environment variable SERVER_RETRIES_ENV_KEY, which</span>
<span class="sd">        can affect max retries value. If not available then use class</span>
<span class="sd">        attribute &#39;_default_max_retries&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Max retries value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">SERVER_RETRIES_ENV_KEY</span><span class="p">))</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_default_max_retries</span></div>

<div class="viewcode-block" id="ServerAPI.get_timeout"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">get_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Current value for requests timeout.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: Timeout value in seconds.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span></div>

<div class="viewcode-block" id="ServerAPI.set_timeout"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_timeout">[docs]</a>    <span class="k">def</span> <span class="nf">set_timeout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change timeout value for requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            timeout (Union[float, None]): Timeout value in seconds.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">timeout</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_timeout</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timeout</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_max_retries"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_max_retries">[docs]</a>    <span class="k">def</span> <span class="nf">get_max_retries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Current value for requests max retries.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: Max retries value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span></div>

<div class="viewcode-block" id="ServerAPI.set_max_retries"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_max_retries">[docs]</a>    <span class="k">def</span> <span class="nf">set_max_retries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_retries</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change max retries value for requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            max_retries (Union[int, None]): Max retries value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">max_retries</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">max_retries</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_max_retries</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_retries</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">max_retries</span><span class="p">)</span></div>

    <span class="n">timeout</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_timeout</span><span class="p">,</span> <span class="n">set_timeout</span><span class="p">)</span>
    <span class="n">max_retries</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_max_retries</span><span class="p">,</span> <span class="n">set_max_retries</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">access_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access token used for authorization to server.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Token string or None if not authorized yet.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span>

<div class="viewcode-block" id="ServerAPI.is_service_user"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.is_service_user">[docs]</a>    <span class="k">def</span> <span class="nf">is_service_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if connection is using service API key.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Used api key belongs to service user.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User is not logged in.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_site_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_site_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_site_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Site id used for connection.</span>

<span class="sd">        Site id tells server from which machine/site is connection created and</span>
<span class="sd">        is used for default site overrides when settings are received.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Site id value or None if not filled.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site_id</span></div>

<div class="viewcode-block" id="ServerAPI.set_site_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_site_id">[docs]</a>    <span class="k">def</span> <span class="nf">set_site_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">site_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change site id of connection.</span>

<span class="sd">        Behave as specific site for server. It affects default behavior of</span>
<span class="sd">        settings getter methods.</span>

<span class="sd">        Args:</span>
<span class="sd">            site_id (Union[str, None]): Site id value, or &#39;None&#39; to unset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site_id</span> <span class="o">==</span> <span class="n">site_id</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_site_id</span> <span class="o">=</span> <span class="n">site_id</span>
        <span class="c1"># Recreate session on machine id change</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_session_headers</span><span class="p">()</span></div>

    <span class="n">site_id</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_site_id</span><span class="p">,</span> <span class="n">set_site_id</span><span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_client_version"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_client_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_client_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Version of client used to connect to server.</span>

<span class="sd">        Client version is AYON client build desktop application.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Client version string used in connection.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client_version</span></div>

<div class="viewcode-block" id="ServerAPI.set_client_version"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_client_version">[docs]</a>    <span class="k">def</span> <span class="nf">set_client_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set version of client used to connect to server.</span>

<span class="sd">        Client version is AYON client build desktop application.</span>

<span class="sd">        Args:</span>
<span class="sd">            client_version (Union[str, None]): Client version string.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client_version</span> <span class="o">==</span> <span class="n">client_version</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_client_version</span> <span class="o">=</span> <span class="n">client_version</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_session_headers</span><span class="p">()</span></div>

    <span class="n">client_version</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_client_version</span><span class="p">,</span> <span class="n">set_client_version</span><span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_default_settings_variant"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_default_settings_variant">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_settings_variant</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default variant used for settings.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: name of variant or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_settings_variant</span></div>

<div class="viewcode-block" id="ServerAPI.set_default_settings_variant"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_default_settings_variant">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_settings_variant</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">variant</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change default variant for addon settings.</span>

<span class="sd">        Note:</span>
<span class="sd">            It is recommended to set only &#39;production&#39; or &#39;staging&#39; variants</span>
<span class="sd">                as default variant.</span>

<span class="sd">        Args:</span>
<span class="sd">            variant (str): Settings variant name. It is possible to use</span>
<span class="sd">                &#39;production&#39;, &#39;staging&#39; or name of dev bundle.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_default_settings_variant</span> <span class="o">=</span> <span class="n">variant</span></div>

    <span class="n">default_settings_variant</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span>
        <span class="n">get_default_settings_variant</span><span class="p">,</span>
        <span class="n">set_default_settings_variant</span>
    <span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_sender"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_sender">[docs]</a>    <span class="k">def</span> <span class="nf">get_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sender used to send requests.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Sender name or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sender</span></div>

<div class="viewcode-block" id="ServerAPI.set_sender"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_sender">[docs]</a>    <span class="k">def</span> <span class="nf">set_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sender</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change sender used for requests.</span>

<span class="sd">        Args:</span>
<span class="sd">            sender (Union[str, None]): Sender name or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">sender</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sender</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sender</span> <span class="o">=</span> <span class="n">sender</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_session_headers</span><span class="p">()</span></div>

    <span class="n">sender</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_sender</span><span class="p">,</span> <span class="n">set_sender</span><span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_default_service_username"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_default_service_username">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_service_username</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default username used for callbacks when used with service API key.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Username if any was filled.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span><span class="o">.</span><span class="n">get_default_username</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.set_default_service_username"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_default_service_username">[docs]</a>    <span class="k">def</span> <span class="nf">set_default_service_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Service API will work as other user.</span>

<span class="sd">        Service API keys can work as other user. It can be temporary using</span>
<span class="sd">        context manager &#39;as_user&#39; or it is possible to set default username if</span>
<span class="sd">        &#39;as_user&#39; context manager is not entered.</span>

<span class="sd">        Args:</span>
<span class="sd">            username (Optional[str]): Username to work as when service.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When connection is not yet authenticated or api key</span>
<span class="sd">                is not service token.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span><span class="o">.</span><span class="n">get_default_username</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">current_username</span> <span class="o">==</span> <span class="n">username</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Authentication of connection did not happen yet.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t set service username. API key is not a service token.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span><span class="o">.</span><span class="n">set_default_username</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span><span class="o">.</span><span class="n">username</span> <span class="o">==</span> <span class="n">username</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_session_headers</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.as_username"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.as_username">[docs]</a>    <span class="nd">@contextmanager</span>
    <span class="k">def</span> <span class="nf">as_username</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Service API will temporarily work as other user.</span>

<span class="sd">        This method can be used only if service API key is logged in.</span>

<span class="sd">        Args:</span>
<span class="sd">            username (Union[str, None]): Username to work as when service.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When connection is not yet authenticated or api key</span>
<span class="sd">                is not service token.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Authentication of connection did not happen yet.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Can&#39;t set service username. API key is not a service token.&quot;</span>
            <span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span><span class="o">.</span><span class="n">as_user</span><span class="p">(</span><span class="n">username</span><span class="p">)</span> <span class="k">as</span> <span class="n">o</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_update_session_headers</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">o</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_update_session_headers</span><span class="p">()</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">is_server_available</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_available</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span><span class="p">,</span>
                <span class="n">cert</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_cert</span><span class="p">,</span>
                <span class="n">verify</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_ssl_verify</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_server_available</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_available</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">has_valid_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_is_valid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_token</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_is_valid</span>

<div class="viewcode-block" id="ServerAPI.validate_server_availability"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.validate_server_availability">[docs]</a>    <span class="k">def</span> <span class="nf">validate_server_availability</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_server_available</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ServerNotReached</span><span class="p">(</span><span class="s2">&quot;Server </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> can&#39;t be reached&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span>
            <span class="p">))</span></div>

<div class="viewcode-block" id="ServerAPI.validate_token"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.validate_token">[docs]</a>    <span class="k">def</span> <span class="nf">validate_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_token_validation_started</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="c1"># TODO add other possible validations</span>
            <span class="c1"># - existence of &#39;user&#39; key in info</span>
            <span class="c1"># - validate that &#39;site_id&#39; is in &#39;sites&#39; in info</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_info</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_token_is_valid</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="n">UnauthorizedError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_token_is_valid</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_token_validation_started</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_is_valid</span></div>

<div class="viewcode-block" id="ServerAPI.set_token"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_token">[docs]</a>    <span class="k">def</span> <span class="nf">set_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_token</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="n">token</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.reset_token"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.reset_token">[docs]</a>    <span class="k">def</span> <span class="nf">reset_token</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token_is_valid</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.create_session"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_session">[docs]</a>    <span class="k">def</span> <span class="nf">create_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ignore_existing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a connection session.</span>

<span class="sd">        Session helps to keep connection with server without</span>
<span class="sd">        need to reconnect on each call.</span>

<span class="sd">        Args:</span>
<span class="sd">            ignore_existing (bool): If session already exists,</span>
<span class="sd">                ignore creation.</span>
<span class="sd">            force (bool): If session already exists, close it and</span>
<span class="sd">                create new.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">force</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ignore_existing</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Session is already created.&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="c1"># Validate token before session creation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validate_token</span><span class="p">()</span>

        <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
        <span class="n">session</span><span class="o">.</span><span class="n">cert</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cert</span>
        <span class="n">session</span><span class="o">.</span><span class="n">verify</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ssl_verify</span>
        <span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_headers</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_session_functions_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">get</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">post</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">put</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">put</span><span class="p">,</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">patch</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">delete</span><span class="p">:</span> <span class="n">session</span><span class="o">.</span><span class="n">delete</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="n">session</span></div>

<div class="viewcode-block" id="ServerAPI.close_session"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.close_session">[docs]</a>    <span class="k">def</span> <span class="nf">close_session</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_session_functions_mapping</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">session</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_update_session_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Header keys that may change over time</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;X-as-user&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span><span class="o">.</span><span class="n">username</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;x-ayon-version&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client_version</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;x-ayon-site-id&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;x-sender&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sender</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_info"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about current used api key.</span>

<span class="sd">        By default, the &#39;info&#39; contains only &#39;uptime&#39; and &#39;version&#39;. With</span>
<span class="sd">        logged user info also contains information about user and machines on</span>
<span class="sd">        which was logged in.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Use this method for validation of token instead of &#39;get_user&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Information from server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_server_version"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_server_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get server version.</span>

<span class="sd">        Version should match semantic version (https://semver.org/).</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Server version.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_version</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_server_version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_info</span><span class="p">()[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_version</span></div>

<div class="viewcode-block" id="ServerAPI.get_server_version_tuple"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_server_version_tuple">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_version_tuple</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get server version as tuple.</span>

<span class="sd">        Version should match semantic version (https://semver.org/).</span>

<span class="sd">        This function only returns first three numbers of version.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[int, int, int, Union[str, None], Union[str, None]]: Server</span>
<span class="sd">                version.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_version_tuple</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">re_match</span> <span class="o">=</span> <span class="n">VERSION_REGEX</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_server_version</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_server_version_tuple</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">re_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;major&quot;</span><span class="p">)),</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">re_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;minor&quot;</span><span class="p">)),</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">re_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;patch&quot;</span><span class="p">)),</span>
                <span class="n">re_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;prerelease&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">re_match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="s2">&quot;buildmetadata&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_server_version_tuple</span></div>

    <span class="n">server_version</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_server_version</span><span class="p">)</span>
    <span class="n">server_version_tuple</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_server_version_tuple</span><span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">graphql_allows_data_in_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;GraphQl query can support &#39;data&#39; field.</span>

<span class="sd">        This applies only to project hierarchy entities &#39;project&#39;, &#39;folder&#39;,</span>
<span class="sd">        &#39;task&#39;, &#39;product&#39;, &#39;version&#39; and &#39;representation&#39;. Others like &#39;user&#39;</span>
<span class="sd">        still require to use rest api to access &#39;data&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if server supports &#39;data&#39; field in GraphQl query.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphql_allows_data_in_query</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_tuple</span>
            <span class="n">graphql_allows_data_in_query</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
                <span class="n">graphql_allows_data_in_query</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graphql_allows_data_in_query</span> <span class="o">=</span> <span class="n">graphql_allows_data_in_query</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_graphql_allows_data_in_query</span>

    <span class="k">def</span> <span class="nf">_get_user_info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;users/me&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;users/me&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;users/me&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="ServerAPI.get_users"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_users">[docs]</a>    <span class="k">def</span> <span class="nf">get_users</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">usernames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get Users.</span>

<span class="sd">        Only administrators and managers can fetch all users. For other users</span>
<span class="sd">            it is required to pass in &#39;project_name&#39; filter.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (Optional[str]): Project name.</span>
<span class="sd">            usernames (Optional[Iterable[str]]): Filter by usernames.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried</span>
<span class="sd">                for users.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Queried users.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">usernames</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">usernames</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">usernames</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">usernames</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;userNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">usernames</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">project_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;projectName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project_name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;user&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">users_graphql_query</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;users&quot;</span><span class="p">]:</span>
                <span class="n">user</span><span class="p">[</span><span class="s2">&quot;accessGroups&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                    <span class="n">user</span><span class="p">[</span><span class="s2">&quot;accessGroups&quot;</span><span class="p">])</span>
                <span class="k">yield</span> <span class="n">user</span></div>

<div class="viewcode-block" id="ServerAPI.get_user_by_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_user_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_user_by_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get user by name using GraphQl.</span>

<span class="sd">        Only administrators and managers can fetch all users. For other users</span>
<span class="sd">            it is required to pass in &#39;project_name&#39; filter.</span>

<span class="sd">        Args:</span>
<span class="sd">            username (str): Username.</span>
<span class="sd">            project_name (Optional[str]): Define scope of project.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried</span>
<span class="sd">                for users.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: User info or None if user is not</span>
<span class="sd">                found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">username</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_users</span><span class="p">(</span>
            <span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span>
            <span class="n">usernames</span><span class="o">=</span><span class="p">{</span><span class="n">username</span><span class="p">},</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">user</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_user"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_user">[docs]</a>    <span class="k">def</span> <span class="nf">get_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get user info using REST endpoit.</span>

<span class="sd">        Args:</span>
<span class="sd">            username (Optional[str]): Username.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: User info or None if user is not</span>
<span class="sd">                found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_user_info</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">output</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnauthorizedError</span><span class="p">(</span><span class="s2">&quot;User is not authorized.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">output</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;users/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">username</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_headers"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_headers">[docs]</a>    <span class="k">def</span> <span class="nf">get_headers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">content_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="s2">&quot;application/json&quot;</span>

        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="n">content_type</span><span class="p">,</span>
            <span class="s2">&quot;x-ayon-platform&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
            <span class="s2">&quot;x-ayon-hostname&quot;</span><span class="p">:</span> <span class="n">platform</span><span class="o">.</span><span class="n">node</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;x-ayon-site-id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_site_id</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;x-ayon-version&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_client_version</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sender</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;x-sender&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sender</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token_is_service</span><span class="p">:</span>
                <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-Api-Key&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span>
                <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_as_user_stack</span><span class="o">.</span><span class="n">username</span>
                <span class="k">if</span> <span class="n">username</span><span class="p">:</span>
                    <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-as-user&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Bearer </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">headers</span></div>

<div class="viewcode-block" id="ServerAPI.login"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.login">[docs]</a>    <span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">create_session</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Login to server.</span>

<span class="sd">        Args:</span>
<span class="sd">            username (str): Username.</span>
<span class="sd">            password (str): Password.</span>
<span class="sd">            create_session (Optional[bool]): Create session after login.</span>
<span class="sd">                Default: True.</span>

<span class="sd">        Raises:</span>
<span class="sd">            AuthenticationError: Login failed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_token</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">user_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_user</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">UnauthorizedError</span><span class="p">:</span>
                <span class="n">user_info</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">current_username</span> <span class="o">=</span> <span class="n">user_info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">current_username</span> <span class="o">==</span> <span class="n">username</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close_session</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">create_session</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">create_session</span><span class="p">()</span>
                <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_token</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_server_availability</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_token_validation_started</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
                <span class="s2">&quot;auth/login&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">username</span><span class="p">,</span>
                <span class="n">password</span><span class="o">=</span><span class="n">password</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">_detail</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detail&quot;</span><span class="p">)</span>
                <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">if</span> <span class="n">_detail</span><span class="p">:</span>
                    <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">_detail</span><span class="p">)</span>

                <span class="k">raise</span> <span class="n">AuthenticationError</span><span class="p">(</span><span class="s2">&quot;Login failed </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">details</span><span class="p">))</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_token_validation_started</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="s2">&quot;token&quot;</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_valid_token</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">AuthenticationError</span><span class="p">(</span><span class="s2">&quot;Invalid credentials&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">create_session</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">create_session</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.logout"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.logout">[docs]</a>    <span class="k">def</span> <span class="nf">logout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">soft</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">soft</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_logout</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_token</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_logout</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">logout_from_server</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_access_token</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_do_rest_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;timeout&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
        <span class="n">max_retries</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;max_retries&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_retries</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">max_retries</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">max_retries</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Validate token if was not yet validated</span>
            <span class="c1">#    - ignore validation if we&#39;re in middle of</span>
            <span class="c1">#       validation</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_token_is_valid</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token_validation_started</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_token</span><span class="p">()</span>

            <span class="k">if</span> <span class="s2">&quot;headers&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;headers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_headers</span><span class="p">()</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">RequestType</span><span class="p">):</span>
                <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_functions_mapping</span><span class="p">[</span><span class="n">function</span><span class="p">]</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">RequestType</span><span class="p">):</span>
            <span class="n">function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_functions_mapping</span><span class="p">[</span><span class="n">function</span><span class="p">]</span>

        <span class="n">response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">new_response</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">retry_idx</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">except</span> <span class="ne">ConnectionRefusedError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">retry_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Connection error happened.&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>

                <span class="c1"># Server may be restarting</span>
                <span class="n">new_response</span> <span class="o">=</span> <span class="n">RestApiResponse</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to connect the server. Connection refused&quot;</span><span class="p">}</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">Timeout</span><span class="p">:</span>
                <span class="c1"># Connection timed out</span>
                <span class="n">new_response</span> <span class="o">=</span> <span class="n">RestApiResponse</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;Connection timed out.&quot;</span><span class="p">}</span>
                <span class="p">)</span>

            <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">ConnectionError</span><span class="p">:</span>
                <span class="c1"># Log warning only on last attempt</span>
                <span class="k">if</span> <span class="n">retry_idx</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Connection error happened.&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>

                <span class="n">new_response</span> <span class="o">=</span> <span class="n">RestApiResponse</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="p">{</span><span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;Unable to connect the server. Connection error&quot;</span><span class="p">}</span>
                <span class="p">)</span>

            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">new_response</span>

        <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">content_type</span> <span class="o">==</span> <span class="s2">&quot;application/json&quot;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">new_response</span> <span class="o">=</span> <span class="n">RestApiResponse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">JSONDecodeError</span><span class="p">:</span>
                <span class="n">new_response</span> <span class="o">=</span> <span class="n">RestApiResponse</span><span class="p">(</span>
                    <span class="kc">None</span><span class="p">,</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;detail&quot;</span><span class="p">:</span> <span class="s2">&quot;The response is not a JSON: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_response</span> <span class="o">=</span> <span class="n">RestApiResponse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Response </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">new_response</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">new_response</span>

<div class="viewcode-block" id="ServerAPI.raw_post"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.raw_post">[docs]</a>    <span class="k">def</span> <span class="nf">raw_post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing [POST] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">))</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_rest_request</span><span class="p">(</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.raw_put"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.raw_put">[docs]</a>    <span class="k">def</span> <span class="nf">raw_put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing [PUT] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">))</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_rest_request</span><span class="p">(</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">put</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.raw_patch"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.raw_patch">[docs]</a>    <span class="k">def</span> <span class="nf">raw_patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing [PATCH] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">))</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_rest_request</span><span class="p">(</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">patch</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.raw_get"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.raw_get">[docs]</a>    <span class="k">def</span> <span class="nf">raw_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing [GET] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">))</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_rest_request</span><span class="p">(</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.raw_delete"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.raw_delete">[docs]</a>    <span class="k">def</span> <span class="nf">raw_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">entrypoint</span> <span class="o">=</span> <span class="n">entrypoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Executing [DELETE] </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">))</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_rest_request</span><span class="p">(</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">delete</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.post"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.post">[docs]</a>    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_post</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.put"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_put</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.patch"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.patch">[docs]</a>    <span class="k">def</span> <span class="nf">patch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_patch</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_get</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.delete"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete">[docs]</a>    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entrypoint</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_delete</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_event"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_event">[docs]</a>    <span class="k">def</span> <span class="nf">get_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query full event data by id.</span>

<span class="sd">        Events received using event server do not contain full information. To</span>
<span class="sd">        get the full event information is required to receive it explicitly.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_id (str): Event id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Full event data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;events/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event_id</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_events"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_events">[docs]</a>    <span class="k">def</span> <span class="nf">get_events</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topics</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">project_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">users</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">include_logs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">has_children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">newer_than</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">older_than</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get events from server with filtering options.</span>

<span class="sd">        Notes:</span>
<span class="sd">            Not all event happen on a project.</span>

<span class="sd">        Args:</span>
<span class="sd">            topics (Optional[Iterable[str]]): Name of topics.</span>
<span class="sd">            project_names (Optional[Iterable[str]]): Project on which</span>
<span class="sd">                event happened.</span>
<span class="sd">            states (Optional[Iterable[str]]): Filtering by states.</span>
<span class="sd">            users (Optional[Iterable[str]]): Filtering by users</span>
<span class="sd">                who created/triggered an event.</span>
<span class="sd">            include_logs (Optional[bool]): Query also log events.</span>
<span class="sd">            has_children (Optional[bool]): Event is with/without children</span>
<span class="sd">                events. If &#39;None&#39; then all events are returned, default.</span>
<span class="sd">            newer_than (Optional[str]): Return only events newer than given</span>
<span class="sd">                iso datetime string.</span>
<span class="sd">            older_than (Optional[str]): Return only events older than given</span>
<span class="sd">                iso datetime string.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be received</span>
<span class="sd">                for each event.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Available events matching filters.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">topics</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">topics</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">topics</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;eventTopics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">topics</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">project_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">project_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_names</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">project_names</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;projectNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">project_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">states</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">states</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">states</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;eventStates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">states</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">users</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">users</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">users</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;eventUsers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">users</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">include_logs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">include_logs</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;includeLogsFilter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">include_logs</span>

        <span class="k">if</span> <span class="n">has_children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;hasChildrenFilter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_children</span>

        <span class="k">if</span> <span class="n">newer_than</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;newerThanFilter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">newer_than</span>

        <span class="k">if</span> <span class="n">older_than</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;olderThanFilter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">older_than</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;event&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">events_graphql_query</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;events&quot;</span><span class="p">]:</span>
                <span class="k">yield</span> <span class="n">event</span></div>

<div class="viewcode-block" id="ServerAPI.update_event"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_event">[docs]</a>    <span class="k">def</span> <span class="nf">update_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event_id</span><span class="p">,</span>
        <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">summary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">retries</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;sender&quot;</span><span class="p">,</span> <span class="n">sender</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="n">project_name</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;description&quot;</span><span class="p">,</span> <span class="n">description</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;summary&quot;</span><span class="p">,</span> <span class="n">summary</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;payload&quot;</span><span class="p">,</span> <span class="n">payload</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;progress&quot;</span><span class="p">,</span> <span class="n">progress</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;retries&quot;</span><span class="p">,</span> <span class="n">retries</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">}</span>
        <span class="c1"># &#39;progress&#39; and &#39;retries&#39; are available since 0.5.x server version</span>
        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_tuple</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;progress&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;retries&quot;</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">args</span><span class="p">)</span>
            <span class="n">ending</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span>
                 <span class="s2">&quot;Your server version &#39;</span><span class="si">{}</span><span class="s2">&#39; does not support update&quot;</span>
                 <span class="s2">&quot; of </span><span class="si">{}</span><span class="s2"> field</span><span class="si">{}</span><span class="s2"> on event. The fields are supported since&quot;</span>
                 <span class="s2">&quot; server version &#39;0.5&#39;.&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_server_version</span><span class="p">(),</span> <span class="n">fields</span><span class="p">,</span> <span class="n">ending</span><span class="p">))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;events/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">event_id</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.dispatch_event"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.dispatch_event">[docs]</a>    <span class="k">def</span> <span class="nf">dispatch_event</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topic</span><span class="p">,</span>
        <span class="n">sender</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">event_hash</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">username</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">dependencies</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">summary</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">payload</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">finished</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">store</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dispatch event to server.</span>

<span class="sd">        Args:</span>
<span class="sd">            topic (str): Event topic used for filtering of listeners.</span>
<span class="sd">            sender (Optional[str]): Sender of event.</span>
<span class="sd">            event_hash (Optional[str]): Event hash.</span>
<span class="sd">            project_name (Optional[str]): Project name.</span>
<span class="sd">            username (Optional[str]): Username which triggered event.</span>
<span class="sd">            dependencies (Optional[list[str]]): List of event id dependencies.</span>
<span class="sd">            description (Optional[str]): Description of event.</span>
<span class="sd">            summary (Optional[dict[str, Any]]): Summary of event that can be used</span>
<span class="sd">                for simple filtering on listeners.</span>
<span class="sd">            payload (Optional[dict[str, Any]]): Full payload of event data with</span>
<span class="sd">                all details.</span>
<span class="sd">            finished (Optional[bool]): Mark event as finished on dispatch.</span>
<span class="sd">            store (Optional[bool]): Store event in event queue for possible</span>
<span class="sd">                future processing otherwise is event send only</span>
<span class="sd">                to active listeners.</span>

<span class="sd">        Returns:</span>
<span class="sd">            RestApiResponse: Response from server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">summary</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">payload</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">payload</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">event_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;topic&quot;</span><span class="p">:</span> <span class="n">topic</span><span class="p">,</span>
            <span class="s2">&quot;sender&quot;</span><span class="p">:</span> <span class="n">sender</span><span class="p">,</span>
            <span class="s2">&quot;hash&quot;</span><span class="p">:</span> <span class="n">event_hash</span><span class="p">,</span>
            <span class="s2">&quot;project&quot;</span><span class="p">:</span> <span class="n">project_name</span><span class="p">,</span>
            <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s2">&quot;dependencies&quot;</span><span class="p">:</span> <span class="n">dependencies</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">description</span><span class="p">,</span>
            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="n">summary</span><span class="p">,</span>
            <span class="s2">&quot;payload&quot;</span><span class="p">:</span> <span class="n">payload</span><span class="p">,</span>
            <span class="s2">&quot;finished&quot;</span><span class="p">:</span> <span class="n">finished</span><span class="p">,</span>
            <span class="s2">&quot;store&quot;</span><span class="p">:</span> <span class="n">store</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;events&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">event_data</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span></div>

<div class="viewcode-block" id="ServerAPI.enroll_event_job"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.enroll_event_job">[docs]</a>    <span class="k">def</span> <span class="nf">enroll_event_job</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">source_topic</span><span class="p">,</span>
        <span class="n">target_topic</span><span class="p">,</span>
        <span class="n">sender</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">sequential</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">events_filter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">max_retries</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enroll job based on events.</span>

<span class="sd">        Enroll will find first unprocessed event with &#39;source_topic&#39; and will</span>
<span class="sd">        create new event with &#39;target_topic&#39; for it and return the new event</span>
<span class="sd">        data.</span>

<span class="sd">        Use &#39;sequential&#39; to control that only single target event is created</span>
<span class="sd">        at same time. Creation of new target events is blocked while there is</span>
<span class="sd">        at least one unfinished event with target topic, when set to &#39;True&#39;.</span>
<span class="sd">        This helps when order of events matter and more than one process using</span>
<span class="sd">        the same target is running at the same time.</span>
<span class="sd">        </span>
<span class="sd">        Make sure the new event has updated status to &#39;&quot;finished&quot;&#39; status</span>
<span class="sd">        when you&#39;re done with logic</span>

<span class="sd">        Target topic should not clash with other processes/services.</span>

<span class="sd">        Created target event have &#39;dependsOn&#39; key where is id of source topic.</span>

<span class="sd">        Use-case:</span>
<span class="sd">            - Service 1 is creating events with topic &#39;my.leech&#39;</span>
<span class="sd">            - Service 2 process &#39;my.leech&#39; and uses target topic &#39;my.process&#39;</span>
<span class="sd">                - this service can run on 1-n machines</span>
<span class="sd">                - all events must be processed in a sequence by their creation</span>
<span class="sd">                    time and only one event can be processed at a time</span>
<span class="sd">                - in this case &#39;sequential&#39; should be set to &#39;True&#39; so only</span>
<span class="sd">                    one machine is actually processing events, but if one goes</span>
<span class="sd">                    down there are other that can take place</span>
<span class="sd">            - Service 3 process &#39;my.leech&#39; and uses target topic &#39;my.discover&#39;</span>
<span class="sd">                - this service can run on 1-n machines</span>
<span class="sd">                - order of events is not important</span>
<span class="sd">                - &#39;sequential&#39; should be &#39;False&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            source_topic (str): Source topic to enroll.</span>
<span class="sd">            target_topic (str): Topic of dependent event.</span>
<span class="sd">            sender (str): Identifier of sender (e.g. service name or username).</span>
<span class="sd">            description (Optional[str]): Human readable text shown</span>
<span class="sd">                in target event.</span>
<span class="sd">            sequential (Optional[bool]): The source topic must be processed</span>
<span class="sd">                in sequence.</span>
<span class="sd">            events_filter (Optional[dict[str, Any]]): Filtering conditions</span>
<span class="sd">                to filter the source event. For more technical specifications</span>
<span class="sd">                look to server backed &#39;ayon_server.sqlfilter.Filter&#39;.</span>
<span class="sd">                TODO: Add example of filters.</span>
<span class="sd">            max_retries (Optional[int]): How many times can be event retried.</span>
<span class="sd">                Default value is based on server (3 at the time of this PR).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[None, dict[str, Any]]: None if there is no event matching</span>
<span class="sd">                filters. Created event with &#39;target_topic&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;sourceTopic&quot;</span><span class="p">:</span> <span class="n">source_topic</span><span class="p">,</span>
            <span class="s2">&quot;targetTopic&quot;</span><span class="p">:</span> <span class="n">target_topic</span><span class="p">,</span>
            <span class="s2">&quot;sender&quot;</span><span class="p">:</span> <span class="n">sender</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">max_retries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;maxRetries&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_retries</span>
        <span class="k">if</span> <span class="n">sequential</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;sequential&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sequential</span>
        <span class="k">if</span> <span class="n">description</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">description</span>
        <span class="k">if</span> <span class="n">events_filter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;filter&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">events_filter</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;enroll&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">204</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">503</span><span class="p">:</span>
            <span class="c1"># Server is busy</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Server is busy. Can&#39;t enroll event now.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

    <span class="k">def</span> <span class="nf">_download_file_to_stream</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">progress</span><span class="p">):</span>
        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;headers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_headers</span><span class="p">()</span>
            <span class="n">get_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_functions_mapping</span><span class="p">[</span><span class="n">RequestTypes</span><span class="o">.</span><span class="n">get</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">get_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_functions_mapping</span><span class="p">[</span><span class="n">RequestTypes</span><span class="o">.</span><span class="n">get</span><span class="p">]</span>

        <span class="k">with</span> <span class="n">get_func</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">as</span> <span class="n">response</span><span class="p">:</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">set_content_size</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Content-length&quot;</span><span class="p">])</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">):</span>
                <span class="n">stream</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">progress</span><span class="o">.</span><span class="n">add_transferred_chunk</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>

<div class="viewcode-block" id="ServerAPI.download_file_to_stream"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.download_file_to_stream">[docs]</a>    <span class="k">def</span> <span class="nf">download_file_to_stream</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download file from AYON server to IOStream.</span>

<span class="sd">        Endpoint can be full url (must start with &#39;base_url&#39; of api object).</span>

<span class="sd">        Progress object can be used to track download. Can be used when</span>
<span class="sd">        download happens in thread and other thread want to catch changes over</span>
<span class="sd">        time.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Use retries and timeout.</span>
<span class="sd">            Return RestApiResponse.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (str): Endpoint or URL to file that should be downloaded.</span>
<span class="sd">            stream (Union[io.BytesIO, BinaryIO]): Stream where output will be stored.</span>
<span class="sd">            chunk_size (Optional[int]): Size of chunks that are received</span>
<span class="sd">                in single loop.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object that gives ability</span>
<span class="sd">                to track download progress.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk_size</span><span class="p">:</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_download_chunk_size</span>

        <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">TransferProgress</span><span class="p">()</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">set_source_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">set_started</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_download_file_to_stream</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">progress</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">set_failed</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
            <span class="k">raise</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">set_transfer_done</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">progress</span></div>

<div class="viewcode-block" id="ServerAPI.download_file"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.download_file">[docs]</a>    <span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download file from AYON server.</span>

<span class="sd">        Endpoint can be full url (must start with &#39;base_url&#39; of api object).</span>

<span class="sd">        Progress object can be used to track download. Can be used when</span>
<span class="sd">        download happens in thread and other thread want to catch changes over</span>
<span class="sd">        time.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Use retries and timeout.</span>
<span class="sd">            Return RestApiResponse.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (str): Endpoint or URL to file that should be downloaded.</span>
<span class="sd">            filepath (str): Path where file will be downloaded.</span>
<span class="sd">            chunk_size (Optional[int]): Size of chunks that are received</span>
<span class="sd">                in single loop.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object that gives ability</span>
<span class="sd">                to track download progress.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Create dummy object so the function does not have to check</span>
        <span class="c1">#   &#39;progress&#39; variable everywhere</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">TransferProgress</span><span class="p">()</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">set_destination_url</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="n">dst_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst_directory</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">download_file_to_stream</span><span class="p">(</span>
                    <span class="n">endpoint</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">,</span> <span class="n">progress</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">set_failed</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
            <span class="k">raise</span>

        <span class="k">return</span> <span class="n">progress</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_upload_chunks_iter</span><span class="p">(</span><span class="n">file_stream</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generator that yields chunks of file.</span>

<span class="sd">        Args:</span>
<span class="sd">            file_stream (Union[io.BytesIO, BinaryIO]): Byte stream.</span>
<span class="sd">            progress (TransferProgress): Object to track upload progress.</span>
<span class="sd">            chunk_size (int): Size of chunks that are uploaded at once.</span>

<span class="sd">        Yields:</span>
<span class="sd">            bytes: Chunk of file.</span>
<span class="sd">    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get size of file</span>
        <span class="n">file_stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">io</span><span class="o">.</span><span class="n">SEEK_END</span><span class="p">)</span>
        <span class="n">size</span> <span class="o">=</span> <span class="n">file_stream</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
        <span class="n">file_stream</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Set content size to progress object</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">set_content_size</span><span class="p">(</span><span class="n">size</span><span class="p">)</span>

        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">chunk</span> <span class="o">=</span> <span class="n">file_stream</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">add_transferred_chunk</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">chunk</span><span class="p">))</span>
            <span class="k">yield</span> <span class="n">chunk</span>

    <span class="k">def</span> <span class="nf">_upload_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">url</span><span class="p">,</span>
        <span class="n">stream</span><span class="p">,</span>
        <span class="n">progress</span><span class="p">,</span>
        <span class="n">request_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload file to server.</span>

<span class="sd">        Args:</span>
<span class="sd">            url (str): Url where file will be uploaded.</span>
<span class="sd">            stream (Union[io.BytesIO, BinaryIO]): File stream.</span>
<span class="sd">            progress (TransferProgress): Object that gives ability to track</span>
<span class="sd">                progress.</span>
<span class="sd">            request_type (Optional[RequestType]): Type of request that will</span>
<span class="sd">                be used. Default is PUT.</span>
<span class="sd">            chunk_size (Optional[int]): Size of chunks that are uploaded</span>
<span class="sd">                at once.</span>
<span class="sd">            **kwargs (Any): Additional arguments that will be passed</span>
<span class="sd">                to request function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            RestApiResponse: Server response.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">request_type</span> <span class="o">=</span> <span class="n">RequestTypes</span><span class="o">.</span><span class="n">put</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&quot;headers&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_headers</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">headers</span><span class="p">:</span>
                    <span class="n">headers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">post_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_base_functions_mapping</span><span class="p">[</span><span class="n">request_type</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">post_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_session_functions_mapping</span><span class="p">[</span><span class="n">request_type</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk_size</span><span class="p">:</span>
            <span class="n">chunk_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_upload_chunk_size</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">post_func</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_upload_chunks_iter</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">chunk_size</span><span class="p">),</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span>

<div class="viewcode-block" id="ServerAPI.upload_file_from_stream"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.upload_file_from_stream">[docs]</a>    <span class="k">def</span> <span class="nf">upload_file_from_stream</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload file to server from bytes.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Use retries and timeout.</span>
<span class="sd">            Return RestApiResponse.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (str): Endpoint or url where file will be uploaded.</span>
<span class="sd">            stream (Union[io.BytesIO, BinaryIO]): File content stream.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object that gives ability</span>
<span class="sd">                to track upload progress.</span>
<span class="sd">            request_type (Optional[RequestType]): Type of request that will</span>
<span class="sd">                be used to upload file.</span>
<span class="sd">            **kwargs (Any): Additional arguments that will be passed</span>
<span class="sd">                to request function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            requests.Response: Response object</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span><span class="p">):</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">endpoint</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">=</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rest_url</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">)</span>

        <span class="c1"># Create dummy object so the function does not have to check</span>
        <span class="c1">#   &#39;progress&#39; variable everywhere</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">TransferProgress</span><span class="p">()</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">set_destination_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">set_started</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upload_file</span><span class="p">(</span>
                <span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">set_failed</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">exc</span><span class="p">))</span>
            <span class="k">raise</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="n">progress</span><span class="o">.</span><span class="n">set_transfer_done</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.upload_file"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.upload_file">[docs]</a>    <span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">request_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload file to server.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Use retries and timeout.</span>
<span class="sd">            Return RestApiResponse.</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (str): Endpoint or url where file will be uploaded.</span>
<span class="sd">            filepath (str): Source filepath.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object that gives ability</span>
<span class="sd">                to track upload progress.</span>
<span class="sd">            request_type (Optional[RequestType]): Type of request that will</span>
<span class="sd">                be used to upload file.</span>
<span class="sd">            **kwargs (Any): Additional arguments that will be passed</span>
<span class="sd">                to request function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            requests.Response: Response object</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">progress</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">progress</span> <span class="o">=</span> <span class="n">TransferProgress</span><span class="p">()</span>

        <span class="n">progress</span><span class="o">.</span><span class="n">set_source_url</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">stream</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_file_from_stream</span><span class="p">(</span>
                <span class="n">endpoint</span><span class="p">,</span> <span class="n">stream</span><span class="p">,</span> <span class="n">progress</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.upload_reviewable"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.upload_reviewable">[docs]</a>    <span class="k">def</span> <span class="nf">upload_reviewable</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version_id</span><span class="p">,</span>
        <span class="n">filepath</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">content_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload reviewable file to server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            version_id (str): Version id.</span>
<span class="sd">            filepath (str): Reviewable file path to upload.</span>
<span class="sd">            label (Optional[str]): Reviewable label. Filled automatically</span>
<span class="sd">                server side with filename.</span>
<span class="sd">            content_type (Optional[str]): MIME type of the file.</span>
<span class="sd">            filename (Optional[str]): User as original filename. Filename from</span>
<span class="sd">                &#39;filepath&#39; is used when not filled.</span>
<span class="sd">            progress (Optional[TransferProgress]): Progress.</span>
<span class="sd">            headers (Optional[Dict[str, Any]]): Headers.</span>

<span class="sd">        Returns:</span>
<span class="sd">            RestApiResponse: Server response.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">content_type</span><span class="p">:</span>
            <span class="n">content_type</span> <span class="o">=</span> <span class="n">get_media_mime_type</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">content_type</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not determine MIME type of file &#39;</span><span class="si">{</span><span class="n">filepath</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">headers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">headers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_headers</span><span class="p">(</span><span class="n">content_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Make sure content-type is filled with file content type</span>
            <span class="n">content_type_key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">key</span>
                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">headers</span>
                    <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;content-type&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;Content-Type&quot;</span>
            <span class="p">)</span>
            <span class="n">headers</span><span class="p">[</span><span class="n">content_type_key</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_type</span>

        <span class="c1"># Fill original filename if not explicitly defined</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filename</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">filepath</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;x-file-name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">filename</span>

        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;?label=</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">label</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;/projects/</span><span class="si">{</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;/versions/</span><span class="si">{</span><span class="n">version_id</span><span class="si">}</span><span class="s2">/reviewables</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span>
            <span class="n">filepath</span><span class="p">,</span>
            <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="n">RequestTypes</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.trigger_server_restart"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.trigger_server_restart">[docs]</a>    <span class="k">def</span> <span class="nf">trigger_server_restart</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trigger server restart.</span>

<span class="sd">        Restart may be required when a change of specific value happened on</span>
<span class="sd">        server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;system/restart&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">204</span><span class="p">:</span>
            <span class="c1"># TODO add better exception</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Failed to restart server&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.query_graphql"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.query_graphql">[docs]</a>    <span class="k">def</span> <span class="nf">query_graphql</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">variables</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute GraphQl query.</span>

<span class="sd">        Args:</span>
<span class="sd">            query (str): GraphQl query string.</span>
<span class="sd">            variables (Optional[dict[str, Any]): Variables that can be</span>
<span class="sd">                used in query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            GraphQlResponse: Response from server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;query&quot;</span><span class="p">:</span> <span class="n">query</span><span class="p">,</span> <span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="n">variables</span> <span class="ow">or</span> <span class="p">{}}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_rest_request</span><span class="p">(</span>
            <span class="n">RequestTypes</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_graphql_url</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">GraphQlResponse</span><span class="p">(</span><span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_graphql_schema"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_graphql_schema">[docs]</a>    <span class="k">def</span> <span class="nf">get_graphql_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">query_graphql</span><span class="p">(</span><span class="n">INTROSPECTION_QUERY</span><span class="p">)</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_server_schema"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_server_schema">[docs]</a>    <span class="k">def</span> <span class="nf">get_server_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get server schema with info, url paths, components etc.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Cache schema - How to find out it is outdated?</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Full server schema.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/openapi.json&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_rest_request</span><span class="p">(</span><span class="n">RequestTypes</span><span class="o">.</span><span class="n">get</span><span class="p">,</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_schemas"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_schemas">[docs]</a>    <span class="k">def</span> <span class="nf">get_schemas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get components schema.</span>

<span class="sd">        Name of components does not match entity type names e.g. &#39;project&#39; is</span>
<span class="sd">        under &#39;ProjectModel&#39;. We should find out some mapping. Also, there</span>
<span class="sd">        are properties which don&#39;t have information about reference to object</span>
<span class="sd">        e.g. &#39;config&#39; has just object definition without reference schema.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Component schemas.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">server_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_server_schema</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">server_schema</span><span class="p">[</span><span class="s2">&quot;components&quot;</span><span class="p">][</span><span class="s2">&quot;schemas&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_attributes_schema"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_attributes_schema">[docs]</a>    <span class="k">def</span> <span class="nf">get_attributes_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_cache</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_cache</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reset_attributes_schema</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_schema</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">)</span>
            <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_schema</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attributes_schema</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.reset_attributes_schema"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.reset_attributes_schema">[docs]</a>    <span class="k">def</span> <span class="nf">reset_attributes_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attributes_schema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type_attributes_cache</span> <span class="o">=</span> <span class="p">{}</span></div>

<div class="viewcode-block" id="ServerAPI.set_attribute_config"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.set_attribute_config">[docs]</a>    <span class="k">def</span> <span class="nf">set_attribute_config</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">builtin</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
            <span class="n">origin_attr</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="n">attr</span> <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span>
                    <span class="k">if</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">attribute_name</span>
                <span class="p">),</span>
                <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">origin_attr</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="n">origin_attr</span><span class="p">[</span><span class="s2">&quot;position&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">position</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="s2">&quot;attributes/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">),</span>
            <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
            <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span>
            <span class="n">builtin</span><span class="o">=</span><span class="n">builtin</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">204</span><span class="p">:</span>
            <span class="c1"># TODO raise different exception</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Attribute </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> was not created/updated. </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">attribute_name</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">detail</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_attributes_schema</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.remove_attribute_config"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.remove_attribute_config">[docs]</a>    <span class="k">def</span> <span class="nf">remove_attribute_config</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attribute_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove attribute from server.</span>

<span class="sd">        This can&#39;t be un-done, please use carefully.</span>

<span class="sd">        Args:</span>
<span class="sd">            attribute_name (str): Name of attribute to remove.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;attributes/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attribute_name</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">(</span>
            <span class="s2">&quot;Attribute </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> was not created/updated. </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">attribute_name</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">detail</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">reset_attributes_schema</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.get_attributes_for_type"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_attributes_for_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_attributes_for_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get attribute schemas available for an entity type.</span>

<span class="sd">        Example::</span>
<span class="sd">        </span>
<span class="sd">            ```</span>
<span class="sd">            # Example attribute schema</span>
<span class="sd">            {</span>
<span class="sd">                # Common</span>
<span class="sd">                &quot;type&quot;: &quot;integer&quot;,</span>
<span class="sd">                &quot;title&quot;: &quot;Clip Out&quot;,</span>
<span class="sd">                &quot;description&quot;: null,</span>
<span class="sd">                &quot;example&quot;: 1,</span>
<span class="sd">                &quot;default&quot;: 1,</span>
<span class="sd">                # These can be filled based on value of &#39;type&#39;</span>
<span class="sd">                &quot;gt&quot;: null,</span>
<span class="sd">                &quot;ge&quot;: null,</span>
<span class="sd">                &quot;lt&quot;: null,</span>
<span class="sd">                &quot;le&quot;: null,</span>
<span class="sd">                &quot;minLength&quot;: null,</span>
<span class="sd">                &quot;maxLength&quot;: null,</span>
<span class="sd">                &quot;minItems&quot;: null,</span>
<span class="sd">                &quot;maxItems&quot;: null,</span>
<span class="sd">                &quot;regex&quot;: null,</span>
<span class="sd">                &quot;enum&quot;: null</span>
<span class="sd">            }</span>
<span class="sd">            ```</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_type (str): Entity type for which should be attributes</span>
<span class="sd">                received.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, dict[str, Any]]: Attribute schemas that are available</span>
<span class="sd">                for entered entity type.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type_attributes_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">attributes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">attributes_schema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_schema</span><span class="p">()</span>
            <span class="n">attributes</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes_schema</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">entity_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;scope&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">attr_name</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="n">attributes</span><span class="p">[</span><span class="n">attr_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">attr</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_entity_type_attributes_cache</span><span class="p">[</span><span class="n">entity_type</span><span class="p">]</span> <span class="o">=</span> <span class="n">attributes</span>

        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">attributes</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_attributes_fields_for_type"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_attributes_fields_for_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_attributes_fields_for_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare attribute fields for entity type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: Attributes fields for entity type.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_for_type</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;attrib.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="n">attributes</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ServerAPI.get_default_fields_for_type"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_default_fields_for_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_fields_for_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Default fields for entity type.</span>

<span class="sd">        Returns most of commonly used fields from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            entity_type (str): Name of entity type.</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: Fields that should be queried from server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Event does not have attributes</span>
        <span class="k">if</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;event&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_EVENT_FIELDS</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;project&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_PROJECT_FIELDS</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
                <span class="n">entity_type_defaults</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;folder&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_FOLDER_FIELDS</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
                <span class="n">entity_type_defaults</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_TASK_FIELDS</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
                <span class="n">entity_type_defaults</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_PRODUCT_FIELDS</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
                <span class="n">entity_type_defaults</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_VERSION_FIELDS</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
                <span class="n">entity_type_defaults</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;representation&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">DEFAULT_REPRESENTATION_FIELDS</span>
                <span class="o">|</span> <span class="n">REPRESENTATION_FILES_FIELDS</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
                <span class="n">entity_type_defaults</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;folderType&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_FOLDER_TYPE_FIELDS</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;taskType&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_TASK_TYPE_FIELDS</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;productType&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_PRODUCT_TYPE_FIELDS</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;workfile&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_WORKFILE_INFO_FIELDS</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
                <span class="n">entity_type_defaults</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;user&quot;</span><span class="p">:</span>
            <span class="n">entity_type_defaults</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_USER_FIELDS</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown entity type </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_type</span><span class="p">))</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="n">entity_type_defaults</span>
            <span class="o">|</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_fields_for_type</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_addons_info"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addons_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_addons_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">details</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get information about addons available on server.</span>

<span class="sd">        Args:</span>
<span class="sd">            details (Optional[bool]): Detailed data with information how</span>
<span class="sd">                to get client code.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;addons&quot;</span>
        <span class="k">if</span> <span class="n">details</span><span class="p">:</span>
            <span class="n">endpoint</span> <span class="o">+=</span> <span class="s2">&quot;?details=1&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_addon_url"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addon_url">[docs]</a>    <span class="k">def</span> <span class="nf">get_addon_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="o">*</span><span class="n">subpaths</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate url to addon route.</span>

<span class="sd">        Examples:</span>

<span class="sd">            &gt;&gt;&gt; api = ServerAPI(&quot;https://your.url.com&quot;)</span>
<span class="sd">            &gt;&gt;&gt; api.get_addon_url(</span>
<span class="sd">            ...     &quot;example&quot;, &quot;1.0.0&quot;, &quot;private&quot;, &quot;my.zip&quot;)</span>
<span class="sd">            &#39;https://your.url.com/addons/example/1.0.0/private/my.zip&#39;</span>

<span class="sd">        Args:</span>
<span class="sd">            addon_name (str): Name of addon.</span>
<span class="sd">            addon_version (str): Version of addon.</span>
<span class="sd">            *subpaths (str): Any amount of subpaths that are added to</span>
<span class="sd">                addon url.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Final url.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ending</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">subpaths</span><span class="p">:</span>
            <span class="n">ending</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">subpaths</span><span class="p">))</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/addons/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_base_url</span><span class="p">,</span>
            <span class="n">addon_name</span><span class="p">,</span>
            <span class="n">addon_version</span><span class="p">,</span>
            <span class="n">ending</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.download_addon_private_file"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.download_addon_private_file">[docs]</a>    <span class="k">def</span> <span class="nf">download_addon_private_file</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">addon_name</span><span class="p">,</span>
        <span class="n">addon_version</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">destination_dir</span><span class="p">,</span>
        <span class="n">destination_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download a file from addon private files.</span>

<span class="sd">        This method requires to have authorized token available. Private files</span>
<span class="sd">        are not under &#39;/api&#39; restpoint.</span>

<span class="sd">        Args:</span>
<span class="sd">            addon_name (str): Addon name.</span>
<span class="sd">            addon_version (str): Addon version.</span>
<span class="sd">            filename (str): Filename in private folder on server.</span>
<span class="sd">            destination_dir (str): Where the file should be downloaded.</span>
<span class="sd">            destination_filename (Optional[str]): Name of destination</span>
<span class="sd">                filename. Source filename is used if not passed.</span>
<span class="sd">            chunk_size (Optional[int]): Download chunk size.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object that gives ability</span>
<span class="sd">                to track download progress.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Filepath to downloaded file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">destination_filename</span><span class="p">:</span>
            <span class="n">destination_filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="n">dst_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">,</span> <span class="n">destination_filename</span><span class="p">)</span>
        <span class="c1"># Filename can contain &quot;subfolders&quot;</span>
        <span class="n">dst_dirpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">dst_filepath</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">dst_dirpath</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_addon_url</span><span class="p">(</span>
            <span class="n">addon_name</span><span class="p">,</span>
            <span class="n">addon_version</span><span class="p">,</span>
            <span class="s2">&quot;private&quot;</span><span class="p">,</span>
            <span class="n">filename</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
            <span class="n">url</span><span class="p">,</span> <span class="n">dst_filepath</span><span class="p">,</span> <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">dst_filepath</span></div>

<div class="viewcode-block" id="ServerAPI.get_installers"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_installers">[docs]</a>    <span class="k">def</span> <span class="nf">get_installers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">platform_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Information about desktop application installers on server.</span>

<span class="sd">        Desktop application installers are helpers to download/update AYON</span>
<span class="sd">        desktop application for artists.</span>

<span class="sd">        Args:</span>
<span class="sd">            version (Optional[str]): Filter installers by version.</span>
<span class="sd">            platform_name (Optional[str]): Filter installers by platform name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;platform&quot;</span><span class="p">,</span> <span class="n">platform_name</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span>
        <span class="p">]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">query_fields</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">query_fields</span><span class="p">))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;desktop/installers</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.create_installer"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_installer">[docs]</a>    <span class="k">def</span> <span class="nf">create_installer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">version</span><span class="p">,</span>
        <span class="n">python_version</span><span class="p">,</span>
        <span class="n">platform_name</span><span class="p">,</span>
        <span class="n">python_modules</span><span class="p">,</span>
        <span class="n">runtime_python_modules</span><span class="p">,</span>
        <span class="n">checksum</span><span class="p">,</span>
        <span class="n">checksum_algorithm</span><span class="p">,</span>
        <span class="n">file_size</span><span class="p">,</span>
        <span class="n">sources</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new installer information on server.</span>

<span class="sd">        This step will create only metadata. Make sure to upload installer</span>
<span class="sd">            to the server using &#39;upload_installer&#39; method.</span>

<span class="sd">        Runtime python modules are modules that are required to run AYON</span>
<span class="sd">            desktop application, but are not added to PYTHONPATH for any</span>
<span class="sd">            subprocess.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Installer filename.</span>
<span class="sd">            version (str): Version of installer.</span>
<span class="sd">            python_version (str): Version of Python.</span>
<span class="sd">            platform_name (str): Name of platform.</span>
<span class="sd">            python_modules (dict[str, str]): Python modules that are available</span>
<span class="sd">                in installer.</span>
<span class="sd">            runtime_python_modules (dict[str, str]): Runtime python modules</span>
<span class="sd">                that are available in installer.</span>
<span class="sd">            checksum (str): Installer file checksum.</span>
<span class="sd">            checksum_algorithm (str): Type of checksum used to create checksum.</span>
<span class="sd">            file_size (int): File size.</span>
<span class="sd">            sources (Optional[list[dict[str, Any]]]): List of sources that</span>
<span class="sd">                can be used to download file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
            <span class="s2">&quot;pythonVersion&quot;</span><span class="p">:</span> <span class="n">python_version</span><span class="p">,</span>
            <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="n">platform_name</span><span class="p">,</span>
            <span class="s2">&quot;pythonModules&quot;</span><span class="p">:</span> <span class="n">python_modules</span><span class="p">,</span>
            <span class="s2">&quot;runtimePythonModules&quot;</span><span class="p">:</span> <span class="n">runtime_python_modules</span><span class="p">,</span>
            <span class="s2">&quot;checksum&quot;</span><span class="p">:</span> <span class="n">checksum</span><span class="p">,</span>
            <span class="s2">&quot;checksumAlgorithm&quot;</span><span class="p">:</span> <span class="n">checksum_algorithm</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">file_size</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
            <span class="n">body</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sources</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;desktop/installers&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">body</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.update_installer"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_installer">[docs]</a>    <span class="k">def</span> <span class="nf">update_installer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">sources</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update installer information on server.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Installer filename.</span>
<span class="sd">            sources (list[dict[str, Any]]): List of sources that</span>
<span class="sd">                can be used to download file. Fully replaces existing sources.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;desktop/installers/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
            <span class="n">sources</span><span class="o">=</span><span class="n">sources</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_installer"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_installer">[docs]</a>    <span class="k">def</span> <span class="nf">delete_installer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete installer from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Installer filename.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;desktop/installers/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.download_installer"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.download_installer">[docs]</a>    <span class="k">def</span> <span class="nf">download_installer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">dst_filepath</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download installer file from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Installer filename.</span>
<span class="sd">            dst_filepath (str): Destination filepath.</span>
<span class="sd">            chunk_size (Optional[int]): Download chunk size.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object that gives ability</span>
<span class="sd">                to track download progress.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
            <span class="s2">&quot;desktop/installers/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
            <span class="n">dst_filepath</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
            <span class="n">progress</span><span class="o">=</span><span class="n">progress</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.upload_installer"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.upload_installer">[docs]</a>    <span class="k">def</span> <span class="nf">upload_installer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_filepath</span><span class="p">,</span> <span class="n">dst_filename</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload installer file to server.</span>

<span class="sd">        Args:</span>
<span class="sd">            src_filepath (str): Source filepath.</span>
<span class="sd">            dst_filename (str): Destination filename.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object that gives ability</span>
<span class="sd">                to track download progress.</span>

<span class="sd">        Returns:</span>
<span class="sd">            requests.Response: Response object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="s2">&quot;desktop/installers/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">),</span>
            <span class="n">src_filepath</span><span class="p">,</span>
            <span class="n">progress</span><span class="o">=</span><span class="n">progress</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_dependency_package_route</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="s2">&quot;desktop/dependencyPackages&quot;</span>
        <span class="k">if</span> <span class="n">filename</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">endpoint</span>

<div class="viewcode-block" id="ServerAPI.get_dependency_packages"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_dependency_packages">[docs]</a>    <span class="k">def</span> <span class="nf">get_dependency_packages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Information about dependency packages on server.</span>

<span class="sd">        To download dependency package, use &#39;download_dependency_package&#39;</span>
<span class="sd">        method and pass in &#39;filename&#39;.</span>

<span class="sd">        Example data structure::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;packages&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;filename&quot;: str,</span>
<span class="sd">                        &quot;platform&quot;: str,</span>
<span class="sd">                        &quot;checksum&quot;: str,</span>
<span class="sd">                        &quot;checksumAlgorithm&quot;: str,</span>
<span class="sd">                        &quot;size&quot;: int,</span>
<span class="sd">                        &quot;sources&quot;: list[dict[str, Any]],</span>
<span class="sd">                        &quot;supportedAddons&quot;: dict[str, str],</span>
<span class="sd">                        &quot;pythonModules&quot;: dict[str, str]</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Information about dependency packages known for</span>
<span class="sd">                server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dependency_package_route</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.create_dependency_package"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_dependency_package">[docs]</a>    <span class="k">def</span> <span class="nf">create_dependency_package</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">filename</span><span class="p">,</span>
        <span class="n">python_modules</span><span class="p">,</span>
        <span class="n">source_addons</span><span class="p">,</span>
        <span class="n">installer_version</span><span class="p">,</span>
        <span class="n">checksum</span><span class="p">,</span>
        <span class="n">checksum_algorithm</span><span class="p">,</span>
        <span class="n">file_size</span><span class="p">,</span>
        <span class="n">sources</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">platform_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create dependency package on server.</span>

<span class="sd">        The package will be created on a server, it is also required to upload</span>
<span class="sd">        the package archive file (using :meth:`upload_dependency_package`).</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Filename of dependency package.</span>
<span class="sd">            python_modules (dict[str, str]): Python modules in dependency</span>
<span class="sd">                package::</span>

<span class="sd">                    {&quot;&lt;module name&gt;&quot;: &quot;&lt;module version&gt;&quot;, ...}</span>

<span class="sd">            source_addons (dict[str, str]): Name of addons for which is</span>
<span class="sd">                dependency package created::</span>

<span class="sd">                    {&quot;&lt;addon name&gt;&quot;: &quot;&lt;addon version&gt;&quot;, ...}</span>

<span class="sd">            installer_version (str): Version of installer for which was</span>
<span class="sd">                package created.</span>
<span class="sd">            checksum (str): Checksum of archive file where dependencies are.</span>
<span class="sd">            checksum_algorithm (str): Algorithm used to calculate checksum.</span>
<span class="sd">            file_size (Optional[int]): Size of file.</span>
<span class="sd">            sources (Optional[list[dict[str, Any]]]): Information about</span>
<span class="sd">                sources from where it is possible to get file.</span>
<span class="sd">            platform_name (Optional[str]): Name of platform for which is</span>
<span class="sd">                dependency package targeted. Default value is</span>
<span class="sd">                current platform.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">post_body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;filename&quot;</span><span class="p">:</span> <span class="n">filename</span><span class="p">,</span>
            <span class="s2">&quot;pythonModules&quot;</span><span class="p">:</span> <span class="n">python_modules</span><span class="p">,</span>
            <span class="s2">&quot;sourceAddons&quot;</span><span class="p">:</span> <span class="n">source_addons</span><span class="p">,</span>
            <span class="s2">&quot;installerVersion&quot;</span><span class="p">:</span> <span class="n">installer_version</span><span class="p">,</span>
            <span class="s2">&quot;checksum&quot;</span><span class="p">:</span> <span class="n">checksum</span><span class="p">,</span>
            <span class="s2">&quot;checksumAlgorithm&quot;</span><span class="p">:</span> <span class="n">checksum_algorithm</span><span class="p">,</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">file_size</span><span class="p">,</span>
            <span class="s2">&quot;platform&quot;</span><span class="p">:</span> <span class="n">platform_name</span> <span class="ow">or</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">sources</span><span class="p">:</span>
            <span class="n">post_body</span><span class="p">[</span><span class="s2">&quot;sources&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sources</span>

        <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dependency_package_route</span><span class="p">()</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="o">**</span><span class="n">post_body</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.update_dependency_package"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_dependency_package">[docs]</a>    <span class="k">def</span> <span class="nf">update_dependency_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">sources</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update dependency package metadata on server.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Filename of dependency package.</span>
<span class="sd">            sources (list[dict[str, Any]]): Information about</span>
<span class="sd">                sources from where it is possible to get file. Fully replaces</span>
<span class="sd">                existing sources.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_get_dependency_package_route</span><span class="p">(</span><span class="n">filename</span><span class="p">),</span>
            <span class="n">sources</span><span class="o">=</span><span class="n">sources</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_dependency_package"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_dependency_package">[docs]</a>    <span class="k">def</span> <span class="nf">delete_dependency_package</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">platform_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove dependency package for specific platform.</span>

<span class="sd">        Args:</span>
<span class="sd">            filename (str): Filename of dependency package.</span>
<span class="sd">            platform_name (Optional[str]): Deprecated.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">platform_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Argument &#39;platform_name&#39; is deprecated in&quot;</span>
                    <span class="s2">&quot; &#39;delete_dependency_package&#39;. The argument will be&quot;</span>
                    <span class="s2">&quot; removed, please modify your code accordingly.&quot;</span>
                <span class="p">),</span>
                <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>

        <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dependency_package_route</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">route</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">(</span><span class="s2">&quot;Failed to delete dependency file&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.download_dependency_package"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.download_dependency_package">[docs]</a>    <span class="k">def</span> <span class="nf">download_dependency_package</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">src_filename</span><span class="p">,</span>
        <span class="n">dst_directory</span><span class="p">,</span>
        <span class="n">dst_filename</span><span class="p">,</span>
        <span class="n">platform_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">chunk_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Download dependency package from server.</span>

<span class="sd">        This method requires to have authorized token available. The package</span>
<span class="sd">        is only downloaded.</span>

<span class="sd">        Args:</span>
<span class="sd">            src_filename (str): Filename of dependency pacakge.</span>
<span class="sd">                For server version 0.2.0 and lower it is name of package</span>
<span class="sd">                to download.</span>
<span class="sd">            dst_directory (str): Where the file should be downloaded.</span>
<span class="sd">            dst_filename (str): Name of destination filename.</span>
<span class="sd">            platform_name (Optional[str]): Deprecated.</span>
<span class="sd">            chunk_size (Optional[int]): Download chunk size.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object that gives ability</span>
<span class="sd">                to track download progress.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Filepath to downloaded file.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">platform_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Argument &#39;platform_name&#39; is deprecated in&quot;</span>
                    <span class="s2">&quot; &#39;download_dependency_package&#39;. The argument will be&quot;</span>
                    <span class="s2">&quot; removed, please modify your code accordingly.&quot;</span>
                <span class="p">),</span>
                <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>
        <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dependency_package_route</span><span class="p">(</span><span class="n">src_filename</span><span class="p">)</span>
        <span class="n">package_filepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dst_directory</span><span class="p">,</span> <span class="n">dst_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span>
            <span class="n">route</span><span class="p">,</span>
            <span class="n">package_filepath</span><span class="p">,</span>
            <span class="n">chunk_size</span><span class="o">=</span><span class="n">chunk_size</span><span class="p">,</span>
            <span class="n">progress</span><span class="o">=</span><span class="n">progress</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">package_filepath</span></div>

<div class="viewcode-block" id="ServerAPI.upload_dependency_package"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.upload_dependency_package">[docs]</a>    <span class="k">def</span> <span class="nf">upload_dependency_package</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">src_filepath</span><span class="p">,</span> <span class="n">dst_filename</span><span class="p">,</span> <span class="n">platform_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload dependency package to server.</span>

<span class="sd">        Args:</span>
<span class="sd">            src_filepath (str): Path to a package file.</span>
<span class="sd">            dst_filename (str): Dependency package filename or name of package</span>
<span class="sd">                for server version 0.2.0 or lower. Must be unique.</span>
<span class="sd">            platform_name (Optional[str]): Deprecated.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object to keep track about</span>
<span class="sd">                upload state.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">platform_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="p">(</span>
                    <span class="s2">&quot;Argument &#39;platform_name&#39; is deprecated in&quot;</span>
                    <span class="s2">&quot; &#39;upload_dependency_package&#39;. The argument will be&quot;</span>
                    <span class="s2">&quot; removed, please modify your code accordingly.&quot;</span>
                <span class="p">),</span>
                <span class="ne">DeprecationWarning</span>
            <span class="p">)</span>

        <span class="n">route</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_dependency_package_route</span><span class="p">(</span><span class="n">dst_filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">route</span><span class="p">,</span> <span class="n">src_filepath</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.upload_addon_zip"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.upload_addon_zip">[docs]</a>    <span class="k">def</span> <span class="nf">upload_addon_zip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">src_filepath</span><span class="p">,</span> <span class="n">progress</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Upload addon zip file to server.</span>

<span class="sd">        File is validated on server. If it is valid, it is installed. It will</span>
<span class="sd">            create an event job which can be tracked (tracking part is not</span>
<span class="sd">            implemented yet).</span>

<span class="sd">        Example output::</span>

<span class="sd">            {&#39;eventId&#39;: &#39;a1bfbdee27c611eea7580242ac120003&#39;}</span>

<span class="sd">        Args:</span>
<span class="sd">            src_filepath (str): Path to a zip file.</span>
<span class="sd">            progress (Optional[TransferProgress]): Object to keep track about</span>
<span class="sd">                upload state.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Response data from server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="s2">&quot;addons/install&quot;</span><span class="p">,</span>
            <span class="n">src_filepath</span><span class="p">,</span>
            <span class="n">progress</span><span class="o">=</span><span class="n">progress</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="n">RequestTypes</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.get_bundles"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_bundles">[docs]</a>    <span class="k">def</span> <span class="nf">get_bundles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Server bundles with basic information.</span>

<span class="sd">        This is example output::</span>
<span class="sd">        </span>
<span class="sd">            {</span>
<span class="sd">                &quot;bundles&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;name&quot;: &quot;my_bundle&quot;,</span>
<span class="sd">                        &quot;createdAt&quot;: &quot;2023-06-12T15:37:02.420260&quot;,</span>
<span class="sd">                        &quot;installerVersion&quot;: &quot;1.0.0&quot;,</span>
<span class="sd">                        &quot;addons&quot;: {</span>
<span class="sd">                            &quot;core&quot;: &quot;1.2.3&quot;</span>
<span class="sd">                        },</span>
<span class="sd">                        &quot;dependencyPackages&quot;: {</span>
<span class="sd">                            &quot;windows&quot;: &quot;a_windows_package123.zip&quot;,</span>
<span class="sd">                            &quot;linux&quot;: &quot;a_linux_package123.zip&quot;,</span>
<span class="sd">                            &quot;darwin&quot;: &quot;a_mac_package123.zip&quot;</span>
<span class="sd">                        },</span>
<span class="sd">                        &quot;isProduction&quot;: False,</span>
<span class="sd">                        &quot;isStaging&quot;: False</span>
<span class="sd">                    }</span>
<span class="sd">                ],</span>
<span class="sd">                &quot;productionBundle&quot;: &quot;my_bundle&quot;,</span>
<span class="sd">                &quot;stagingBundle&quot;: &quot;test_bundle&quot;</span>
<span class="sd">            }</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Server bundles with basic information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;bundles&quot;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.create_bundle"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">create_bundle</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">addon_versions</span><span class="p">,</span>
        <span class="n">installer_version</span><span class="p">,</span>
        <span class="n">dependency_packages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_production</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_staging</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create bundle on server.</span>

<span class="sd">        Bundle cannot be changed once is created. Only isProduction, isStaging</span>
<span class="sd">        and dependency packages can change after creation.</span>

<span class="sd">        Args:</span>
<span class="sd">            name (str): Name of bundle.</span>
<span class="sd">            addon_versions (dict[str, str]): Addon versions.</span>
<span class="sd">            installer_version (Union[str, None]): Installer version.</span>
<span class="sd">            dependency_packages (Optional[dict[str, str]]): Dependency</span>
<span class="sd">                package names. Keys are platform names and values are name of</span>
<span class="sd">                packages.</span>
<span class="sd">            is_production (Optional[bool]): Bundle will be marked as</span>
<span class="sd">                production.</span>
<span class="sd">            is_staging (Optional[bool]): Bundle will be marked as staging.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;installerVersion&quot;</span><span class="p">:</span> <span class="n">installer_version</span><span class="p">,</span>
            <span class="s2">&quot;addons&quot;</span><span class="p">:</span> <span class="n">addon_versions</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;dependencyPackages&quot;</span><span class="p">,</span> <span class="n">dependency_packages</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;isProduction&quot;</span><span class="p">,</span> <span class="n">is_production</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;isStaging&quot;</span><span class="p">,</span> <span class="n">is_staging</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">body</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;bundles&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">body</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.update_bundle"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">update_bundle</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bundle_name</span><span class="p">,</span>
        <span class="n">dependency_packages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_production</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_staging</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update bundle on server.</span>

<span class="sd">        Dependency packages can be update only for single platform. Others</span>
<span class="sd">        will be left untouched. Use &#39;None&#39; value to unset dependency package</span>
<span class="sd">        from bundle.</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_name (str): Name of bundle.</span>
<span class="sd">            dependency_packages (Optional[dict[str, str]]): Dependency pacakge</span>
<span class="sd">                names that should be used with the bundle.</span>
<span class="sd">            is_production (Optional[bool]): Bundle will be marked as</span>
<span class="sd">                production.</span>
<span class="sd">            is_staging (Optional[bool]): Bundle will be marked as staging.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">body</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;dependencyPackages&quot;</span><span class="p">,</span> <span class="n">dependency_packages</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;isProduction&quot;</span><span class="p">,</span> <span class="n">is_production</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;isStaging&quot;</span><span class="p">,</span> <span class="n">is_staging</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">}</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;bundles&quot;</span><span class="p">,</span> <span class="n">bundle_name</span><span class="p">),</span>
            <span class="o">**</span><span class="n">body</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_bundle"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_bundle">[docs]</a>    <span class="k">def</span> <span class="nf">delete_bundle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bundle_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete bundle from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_name (str): Name of bundle to delete.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;bundles&quot;</span><span class="p">,</span> <span class="n">bundle_name</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

    <span class="c1"># Anatomy presets</span>
<div class="viewcode-block" id="ServerAPI.get_project_anatomy_presets"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_anatomy_presets">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_anatomy_presets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Anatomy presets available on server.</span>

<span class="sd">        Content has basic information about presets. Example output::</span>

<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;name&quot;: &quot;netflix_VFX&quot;,</span>
<span class="sd">                    &quot;primary&quot;: false,</span>
<span class="sd">                    &quot;version&quot;: &quot;1.0.0&quot;</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    ...</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, str]]: Anatomy presets available on server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anatomy/presets&quot;</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;presets&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="ServerAPI.get_default_anatomy_preset_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_default_anatomy_preset_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_anatomy_preset_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Name of default anatomy preset.</span>

<span class="sd">        Primary preset is used as default preset. But when primary preset is</span>
<span class="sd">        not set a built-in is used instead. Built-in preset is named &#39;_&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Name of preset that can be used by</span>
<span class="sd">                &#39;get_project_anatomy_preset&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">preset</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_anatomy_presets</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">preset</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;primary&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">preset</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="s2">&quot;_&quot;</span></div>

<div class="viewcode-block" id="ServerAPI.get_project_anatomy_preset"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_anatomy_preset">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_anatomy_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">preset_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Anatomy preset values by name.</span>

<span class="sd">        Get anatomy preset values by preset name. Primary preset is returned</span>
<span class="sd">        if preset name is set to &#39;None&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            preset_name (Optional[str]): Preset name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Anatomy preset values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">preset_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">preset_name</span> <span class="o">=</span> <span class="s2">&quot;__primary__&quot;</span>
            <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_tuple</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
                <span class="n">preset_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_anatomy_preset_name</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;anatomy/presets/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">preset_name</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_build_in_anatomy_preset"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_build_in_anatomy_preset">[docs]</a>    <span class="k">def</span> <span class="nf">get_build_in_anatomy_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get built-in anatomy preset.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Built-in anatomy preset.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">preset_name</span> <span class="o">=</span> <span class="s2">&quot;__builtin__&quot;</span>
        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_tuple</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="n">preset_name</span> <span class="o">=</span> <span class="s2">&quot;_&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_anatomy_preset</span><span class="p">(</span><span class="n">preset_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_project_root_overrides"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_root_overrides">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_root_overrides</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Root overrides per site name.</span>

<span class="sd">        Method is based on logged user and can&#39;t be received for any other</span>
<span class="sd">            user on server.</span>

<span class="sd">        Output will contain only roots per site id used by logged user.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>

<span class="sd">        Returns:</span>
<span class="sd">             dict[str, dict[str, str]]: Root values by root name by site id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/roots&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_project_roots_by_site"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_roots_by_site">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_roots_by_site</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Root overrides per site name.</span>

<span class="sd">        Method is based on logged user and can&#39;t be received for any other</span>
<span class="sd">        user on server.</span>

<span class="sd">        Output will contain only roots per site id used by logged user.</span>

<span class="sd">        Deprecated:</span>
<span class="sd">            Use &#39;get_project_root_overrides&#39; instead. Function</span>
<span class="sd">                deprecated since 1.0.6</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>

<span class="sd">        Returns:</span>
<span class="sd">             dict[str, dict[str, str]]: Root values by root name by site id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;Method &#39;get_project_roots_by_site&#39; is deprecated.&quot;</span>
                <span class="s2">&quot; Please use &#39;get_project_root_overrides&#39; instead.&quot;</span>
            <span class="p">),</span>
            <span class="ne">DeprecationWarning</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_root_overrides</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_project_root_overrides_by_site_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_root_overrides_by_site_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_root_overrides_by_site_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Root overrides for site.</span>

<span class="sd">        If site id is not passed a site set in current api object is used</span>
<span class="sd">        instead.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            site_id (Optional[str]): Site id for which want to receive</span>
<span class="sd">                site overrides.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Root values by root name or None if</span>
<span class="sd">                site does not have overrides.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">site_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">site_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_id</span>

        <span class="k">if</span> <span class="n">site_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="n">roots</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_roots_by_site</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">roots</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">site_id</span><span class="p">,</span> <span class="p">{})</span></div>

<div class="viewcode-block" id="ServerAPI.get_project_roots_for_site"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_roots_for_site">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_roots_for_site</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Root overrides for site.</span>

<span class="sd">        If site id is not passed a site set in current api object is used</span>
<span class="sd">        instead.</span>

<span class="sd">        Deprecated:</span>
<span class="sd">            Use &#39;get_project_root_overrides_by_site_id&#39; instead. Function</span>
<span class="sd">                deprecated since 1.0.6</span>
<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            site_id (Optional[str]): Site id for which want to receive</span>
<span class="sd">                site overrides.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Root values by root name, root name is not</span>
<span class="sd">                available if it does not have overrides.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="p">(</span>
                <span class="s2">&quot;Method &#39;get_project_roots_for_site&#39; is deprecated.&quot;</span>
                <span class="s2">&quot; Please use &#39;get_project_root_overrides_by_site_id&#39; instead.&quot;</span>
            <span class="p">),</span>
            <span class="ne">DeprecationWarning</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_root_overrides_by_site_id</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_project_roots_values</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">platform_name</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Root values for site or platform.</span>

<span class="sd">        Helper function that treats &#39;siteRoots&#39; endpoint. The endpoint</span>
<span class="sd">            requires to pass exactly one query value of site id</span>
<span class="sd">            or platform name.</span>

<span class="sd">        When using platform name, it does return default project roots without</span>
<span class="sd">            any site overrides.</span>

<span class="sd">        Output should contain all project roots with all filled values. If</span>
<span class="sd">            value does not have override on a site, it should be filled with</span>
<span class="sd">            project default value.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            site_id (Optional[str]): Site id for which want to receive</span>
<span class="sd">                site overrides.</span>
<span class="sd">            platform_name (Optional[str]): Platform for which want to receive</span>
<span class="sd">                roots.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Root values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">site_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_data</span><span class="p">[</span><span class="s2">&quot;site_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_id</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">platform_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">platform_name</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span>
            <span class="n">query_data</span><span class="p">[</span><span class="s2">&quot;platform&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">platform_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">query_data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">]))</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/siteRoots</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>

<div class="viewcode-block" id="ServerAPI.get_project_roots_by_site_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_roots_by_site_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_roots_by_site_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Root values for a site.</span>

<span class="sd">        If site id is not passed a site set in current api object is used</span>
<span class="sd">        instead. If site id is not available, default roots are returned</span>
<span class="sd">        for current platform.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            site_id (Optional[str]): Site id for which want to receive</span>
<span class="sd">                root values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Root values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">site_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">site_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_id</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_project_roots_values</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_project_roots_by_platform"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_roots_by_platform">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_roots_by_platform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">platform_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Root values for a site.</span>

<span class="sd">        If platform name is not passed current platform name is used instead.</span>

<span class="sd">        This function does return root values without site overrides. It is</span>
<span class="sd">            possible to use the function to receive default root values.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            platform_name (Optional[Literal[&quot;windows&quot;, &quot;linux&quot;, &quot;darwin&quot;]]):</span>
<span class="sd">                Platform name for which want to receive root values. Current</span>
<span class="sd">                platform name is used if not passed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Root values.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_project_roots_values</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="n">platform_name</span><span class="o">=</span><span class="n">platform_name</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_addon_settings_schema"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addon_settings_schema">[docs]</a>    <span class="k">def</span> <span class="nf">get_addon_settings_schema</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Sudio/Project settings schema of an addon.</span>

<span class="sd">        Project schema may look differently as some enums are based on project</span>
<span class="sd">        values.</span>

<span class="sd">        Args:</span>
<span class="sd">            addon_name (str): Name of addon.</span>
<span class="sd">            addon_version (str): Version of addon.</span>
<span class="sd">            project_name (Optional[str]): Schema for specific project or</span>
<span class="sd">                default studio schemas.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Schema of studio/project settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">project_name</span><span class="p">:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="p">)</span>

        <span class="n">endpoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_addon_url</span><span class="p">(</span>
            <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_addon_site_settings_schema"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addon_site_settings_schema">[docs]</a>    <span class="k">def</span> <span class="nf">get_addon_site_settings_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Site settings schema of an addon.</span>

<span class="sd">        Args:</span>
<span class="sd">            addon_name (str): Name of addon.</span>
<span class="sd">            addon_version (str): Version of addon.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Schema of site settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;addons/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/siteSettings/schema&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span>
        <span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_addon_studio_settings"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addon_studio_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_addon_studio_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">addon_name</span><span class="p">,</span>
        <span class="n">addon_version</span><span class="p">,</span>
        <span class="n">variant</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Addon studio settings.</span>

<span class="sd">        Receive studio settings for specific version of an addon.</span>

<span class="sd">        Args:</span>
<span class="sd">            addon_name (str): Name of addon.</span>
<span class="sd">            addon_version (str): Version of addon.</span>
<span class="sd">            variant (Optional[Literal[&#39;production&#39;, &#39;staging&#39;]]): Name of</span>
<span class="sd">                settings variant. Used &#39;default_settings_variant&#39; by default.</span>

<span class="sd">        Returns:</span>
<span class="sd">           dict[str, Any]: Addon settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">variant</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_settings_variant</span>

        <span class="n">query_items</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">variant</span><span class="p">:</span>
            <span class="n">query_items</span><span class="p">[</span><span class="s2">&quot;variant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variant</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">prepare_query_string</span><span class="p">(</span><span class="n">query_items</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;addons/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/settings</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_addon_project_settings"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addon_project_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_addon_project_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">addon_name</span><span class="p">,</span>
        <span class="n">addon_version</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">variant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_site</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Addon project settings.</span>

<span class="sd">        Receive project settings for specific version of an addon. The settings</span>
<span class="sd">        may be with site overrides when enabled.</span>

<span class="sd">        Site id is filled with current connection site id if not passed. To</span>
<span class="sd">        make sure any site id is used set &#39;use_site&#39; to &#39;False&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            addon_name (str): Name of addon.</span>
<span class="sd">            addon_version (str): Version of addon.</span>
<span class="sd">            project_name (str): Name of project for which the settings are</span>
<span class="sd">                received.</span>
<span class="sd">            variant (Optional[Literal[&#39;production&#39;, &#39;staging&#39;]]): Name of</span>
<span class="sd">                settings variant. Used &#39;default_settings_variant&#39; by default.</span>
<span class="sd">            site_id (Optional[str]): Name of site which is used for site</span>
<span class="sd">                overrides. Is filled with connection &#39;site_id&#39; attribute</span>
<span class="sd">                if not passed.</span>
<span class="sd">            use_site (Optional[bool]): To force disable option of using site</span>
<span class="sd">                overrides set to &#39;False&#39;. In that case won&#39;t be applied</span>
<span class="sd">                any site overrides.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Addon settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">use_site</span><span class="p">:</span>
            <span class="n">site_id</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">site_id</span><span class="p">:</span>
            <span class="n">site_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_id</span>

        <span class="n">query_items</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">site_id</span><span class="p">:</span>
            <span class="n">query_items</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_id</span>

        <span class="k">if</span> <span class="n">variant</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">variant</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_settings_variant</span>

        <span class="k">if</span> <span class="n">variant</span><span class="p">:</span>
            <span class="n">query_items</span><span class="p">[</span><span class="s2">&quot;variant&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">variant</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">prepare_query_string</span><span class="p">(</span><span class="n">query_items</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;addons/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/settings/</span><span class="si">{}{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">query</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_addon_settings"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addon_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_addon_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">addon_name</span><span class="p">,</span>
        <span class="n">addon_version</span><span class="p">,</span>
        <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">variant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_site</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Receive addon settings.</span>

<span class="sd">        Receive addon settings based on project name value. Some arguments may</span>
<span class="sd">        be ignored if &#39;project_name&#39; is set to &#39;None&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            addon_name (str): Name of addon.</span>
<span class="sd">            addon_version (str): Version of addon.</span>
<span class="sd">            project_name (Optional[str]): Name of project for which the</span>
<span class="sd">                settings are received. A studio settings values are received</span>
<span class="sd">                if is &#39;None&#39;.</span>
<span class="sd">            variant (Optional[Literal[&#39;production&#39;, &#39;staging&#39;]]): Name of</span>
<span class="sd">                settings variant. Used &#39;default_settings_variant&#39; by default.</span>
<span class="sd">            site_id (Optional[str]): Name of site which is used for site</span>
<span class="sd">                overrides. Is filled with connection &#39;site_id&#39; attribute</span>
<span class="sd">                if not passed.</span>
<span class="sd">            use_site (Optional[bool]): To force disable option of using</span>
<span class="sd">                site overrides set to &#39;False&#39;. In that case won&#39;t be applied</span>
<span class="sd">                any site overrides.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Addon settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">project_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_addon_studio_settings</span><span class="p">(</span>
                <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="n">variant</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_addon_project_settings</span><span class="p">(</span>
            <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">variant</span><span class="p">,</span> <span class="n">site_id</span><span class="p">,</span> <span class="n">use_site</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_addon_site_settings"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addon_site_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_addon_site_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Site settings of an addon.</span>

<span class="sd">        If site id is not available an empty dictionary is returned.</span>

<span class="sd">        Args:</span>
<span class="sd">            addon_name (str): Name of addon.</span>
<span class="sd">            addon_version (str): Version of addon.</span>
<span class="sd">            site_id (Optional[str]): Name of site for which should be settings</span>
<span class="sd">                returned. using &#39;site_id&#39; attribute if not passed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Site settings.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">site_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">site_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_id</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">site_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">prepare_query_string</span><span class="p">({</span><span class="s2">&quot;site&quot;</span><span class="p">:</span> <span class="n">site_id</span><span class="p">})</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;addons/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/siteSettings</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">addon_name</span><span class="p">,</span> <span class="n">addon_version</span><span class="p">,</span> <span class="n">query</span>
        <span class="p">))</span>
        <span class="n">result</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_bundle_settings"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_bundle_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_bundle_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bundle_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">variant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_site</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get complete set of settings for given data.</span>

<span class="sd">        If project is not passed then studio settings are returned. If variant</span>
<span class="sd">        is not passed &#39;default_settings_variant&#39; is used. If bundle name is</span>
<span class="sd">        not passed then current production/staging bundle is used, based on</span>
<span class="sd">        variant value.</span>

<span class="sd">        Output contains addon settings and site settings in single dictionary.</span>

<span class="sd">        Todos:</span>
<span class="sd">            - test how it behaves if there is not any bundle.</span>
<span class="sd">            - test how it behaves if there is not any production/staging</span>
<span class="sd">                bundle.</span>

<span class="sd">        Example output::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;addons&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;name&quot;: &quot;addon-name&quot;,</span>
<span class="sd">                        &quot;version&quot;: &quot;addon-version&quot;,</span>
<span class="sd">                        &quot;settings&quot;: {...},</span>
<span class="sd">                        &quot;siteSettings&quot;: {...}</span>
<span class="sd">                    }</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: All settings for single bundle.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_values</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;project_name&quot;</span><span class="p">,</span> <span class="n">project_name</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;variant&quot;</span><span class="p">,</span> <span class="n">variant</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_settings_variant</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;bundle_name&quot;</span><span class="p">,</span> <span class="n">bundle_name</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">use_site</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">site_id</span><span class="p">:</span>
                <span class="n">site_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site_id</span>
            <span class="k">if</span> <span class="n">site_id</span><span class="p">:</span>
                <span class="n">query_values</span><span class="p">[</span><span class="s2">&quot;site_id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">site_id</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">prepare_query_string</span><span class="p">(</span><span class="n">query_values</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;settings</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_addons_studio_settings"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addons_studio_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_addons_studio_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bundle_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">variant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_site</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">only_values</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All addons settings in one bulk.</span>

<span class="sd">        Warnings:</span>
<span class="sd">            Behavior of this function changed with AYON server version 0.3.0.</span>
<span class="sd">                Structure of output from server changed. If using</span>
<span class="sd">                &#39;only_values=True&#39; then output should be same as before.</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_name (Optional[str]): Name of bundle for which should be</span>
<span class="sd">                settings received.</span>
<span class="sd">            variant (Optional[Literal[&#39;production&#39;, &#39;staging&#39;]]): Name of</span>
<span class="sd">                settings variant. Used &#39;default_settings_variant&#39; by default.</span>
<span class="sd">            site_id (Optional[str]): Site id for which want to receive</span>
<span class="sd">                site overrides.</span>
<span class="sd">            use_site (bool): To force disable option of using site overrides</span>
<span class="sd">                set to &#39;False&#39;. In that case won&#39;t be applied any site</span>
<span class="sd">                overrides.</span>
<span class="sd">            only_values (Optional[bool]): Output will contain only settings</span>
<span class="sd">                values without metadata about addons.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Settings of all addons on server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bundle_settings</span><span class="p">(</span>
            <span class="n">bundle_name</span><span class="o">=</span><span class="n">bundle_name</span><span class="p">,</span>
            <span class="n">variant</span><span class="o">=</span><span class="n">variant</span><span class="p">,</span>
            <span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span>
            <span class="n">use_site</span><span class="o">=</span><span class="n">use_site</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">only_values</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">addon</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">addon</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">addon</span> <span class="ow">in</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;addons&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="ServerAPI.get_addons_project_settings"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addons_project_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_addons_project_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">bundle_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">variant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_site</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">only_values</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Project settings of all addons.</span>

<span class="sd">        Server returns information about used addon versions, so full output</span>
<span class="sd">        looks like:</span>

<span class="sd">        ```json</span>
<span class="sd">            {</span>
<span class="sd">                &quot;settings&quot;: {...},</span>
<span class="sd">                &quot;addons&quot;: {...}</span>
<span class="sd">            }</span>
<span class="sd">        ```</span>

<span class="sd">        The output can be limited to only values. To do so is &#39;only_values&#39;</span>
<span class="sd">        argument which is by default set to &#39;True&#39;. In that case output</span>
<span class="sd">        contains only value of &#39;settings&#39; key.</span>

<span class="sd">        Warnings:</span>
<span class="sd">            Behavior of this function changed with AYON server version 0.3.0.</span>
<span class="sd">                Structure of output from server changed. If using</span>
<span class="sd">                &#39;only_values=True&#39; then output should be same as before.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project for which are settings</span>
<span class="sd">                received.</span>
<span class="sd">            bundle_name (Optional[str]): Name of bundle for which should be</span>
<span class="sd">                settings received.</span>
<span class="sd">            variant (Optional[Literal[&#39;production&#39;, &#39;staging&#39;]]): Name of</span>
<span class="sd">                settings variant. Used &#39;default_settings_variant&#39; by default.</span>
<span class="sd">            site_id (Optional[str]): Site id for which want to receive</span>
<span class="sd">                site overrides.</span>
<span class="sd">            use_site (bool): To force disable option of using site overrides</span>
<span class="sd">                set to &#39;False&#39;. In that case won&#39;t be applied any site</span>
<span class="sd">                overrides.</span>
<span class="sd">            only_values (Optional[bool]): Output will contain only settings</span>
<span class="sd">                values without metadata about addons.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Settings of all addons on server for passed</span>
<span class="sd">                project.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_name</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Project name must be passed.&quot;</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_bundle_settings</span><span class="p">(</span>
            <span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span>
            <span class="n">bundle_name</span><span class="o">=</span><span class="n">bundle_name</span><span class="p">,</span>
            <span class="n">variant</span><span class="o">=</span><span class="n">variant</span><span class="p">,</span>
            <span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span>
            <span class="n">use_site</span><span class="o">=</span><span class="n">use_site</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">only_values</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">addon</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">addon</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">addon</span> <span class="ow">in</span> <span class="n">output</span><span class="p">[</span><span class="s2">&quot;addons&quot;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="ServerAPI.get_addons_settings"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_addons_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_addons_settings</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bundle_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">variant</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">site_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">use_site</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">only_values</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Universal function to receive all addon settings.</span>

<span class="sd">        Based on &#39;project_name&#39; will receive studio settings or project</span>
<span class="sd">        settings. In case project is not passed is &#39;site_id&#39; ignored.</span>

<span class="sd">        Warnings:</span>
<span class="sd">            Behavior of this function changed with AYON server version 0.3.0.</span>
<span class="sd">                Structure of output from server changed. If using</span>
<span class="sd">                &#39;only_values=True&#39; then output should be same as before.</span>

<span class="sd">        Args:</span>
<span class="sd">            bundle_name (Optional[str]): Name of bundle for which should be</span>
<span class="sd">                settings received.</span>
<span class="sd">            project_name (Optional[str]): Name of project for which should be</span>
<span class="sd">                settings received.</span>
<span class="sd">            variant (Optional[Literal[&#39;production&#39;, &#39;staging&#39;]]): Name of</span>
<span class="sd">                settings variant. Used &#39;default_settings_variant&#39; by default.</span>
<span class="sd">            site_id (Optional[str]): Id of site for which want to receive</span>
<span class="sd">                site overrides.</span>
<span class="sd">            use_site (Optional[bool]): To force disable option of using site</span>
<span class="sd">                overrides set to &#39;False&#39;. In that case won&#39;t be applied</span>
<span class="sd">                any site overrides.</span>
<span class="sd">            only_values (Optional[bool]): Only settings values will be</span>
<span class="sd">                returned. By default, is set to &#39;True&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">project_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_addons_studio_settings</span><span class="p">(</span>
                <span class="n">bundle_name</span><span class="o">=</span><span class="n">bundle_name</span><span class="p">,</span>
                <span class="n">variant</span><span class="o">=</span><span class="n">variant</span><span class="p">,</span>
                <span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span>
                <span class="n">use_site</span><span class="o">=</span><span class="n">use_site</span><span class="p">,</span>
                <span class="n">only_values</span><span class="o">=</span><span class="n">only_values</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_addons_project_settings</span><span class="p">(</span>
            <span class="n">project_name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span>
            <span class="n">bundle_name</span><span class="o">=</span><span class="n">bundle_name</span><span class="p">,</span>
            <span class="n">variant</span><span class="o">=</span><span class="n">variant</span><span class="p">,</span>
            <span class="n">site_id</span><span class="o">=</span><span class="n">site_id</span><span class="p">,</span>
            <span class="n">use_site</span><span class="o">=</span><span class="n">use_site</span><span class="p">,</span>
            <span class="n">only_values</span><span class="o">=</span><span class="n">only_values</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_secrets"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_secrets">[docs]</a>    <span class="k">def</span> <span class="nf">get_secrets</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get all secrets.</span>

<span class="sd">        Example output::</span>

<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;name&quot;: &quot;secret_1&quot;,</span>
<span class="sd">                    &quot;value&quot;: &quot;secret_value_1&quot;,</span>
<span class="sd">                },</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;name&quot;: &quot;secret_2&quot;,</span>
<span class="sd">                    &quot;value&quot;: &quot;secret_value_2&quot;,</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, str]]: List of secret entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secrets&quot;</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_secret"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_secret">[docs]</a>    <span class="k">def</span> <span class="nf">get_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get secret by name.</span>

<span class="sd">        Example output::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;name&quot;: &quot;secret_name&quot;,</span>
<span class="sd">                &quot;value&quot;: &quot;secret_value&quot;,</span>
<span class="sd">            }</span>

<span class="sd">        Args:</span>
<span class="sd">            secret_name (str): Name of secret.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Secret entity data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;secrets/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secret_name</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.save_secret"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.save_secret">[docs]</a>    <span class="k">def</span> <span class="nf">save_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_name</span><span class="p">,</span> <span class="n">secret_value</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Save secret.</span>

<span class="sd">        This endpoint can create and update secret.</span>

<span class="sd">        Args:</span>
<span class="sd">            secret_name (str): Name of secret.</span>
<span class="sd">            secret_value (str): Value of secret.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="s2">&quot;secrets/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secret_name</span><span class="p">),</span>
            <span class="n">name</span><span class="o">=</span><span class="n">secret_name</span><span class="p">,</span>
            <span class="n">value</span><span class="o">=</span><span class="n">secret_value</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.delete_secret"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_secret">[docs]</a>    <span class="k">def</span> <span class="nf">delete_secret</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete secret by name.</span>

<span class="sd">        Args:</span>
<span class="sd">            secret_name (str): Name of secret to delete.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;secrets/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">secret_name</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

    <span class="c1"># Entity getters</span>
<div class="viewcode-block" id="ServerAPI.get_rest_project"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_project">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query project by name.</span>

<span class="sd">        This call returns project with anatomy data.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Project entity data or &#39;None&#39; if</span>
<span class="sd">                project was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_name</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_projects"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_projects">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_projects</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query available project entities.</span>

<span class="sd">        User must be logged in.</span>

<span class="sd">        Args:</span>
<span class="sd">            active (Optional[bool]): Filter active/inactive projects. Both</span>
<span class="sd">                are returned if &#39;None&#39; is passed.</span>
<span class="sd">            library (Optional[bool]): Filter standard/library projects. Both</span>
<span class="sd">                are returned if &#39;None&#39; is passed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Available projects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">project_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_names</span><span class="p">(</span><span class="n">active</span><span class="p">,</span> <span class="n">library</span><span class="p">):</span>
            <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_project</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">project</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">project</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_entity_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_entity_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_entity_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get entity using REST on a project by its id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where entity is.</span>
<span class="sd">            entity_type (Literal[&quot;folder&quot;, &quot;task&quot;, &quot;product&quot;, &quot;version&quot;]): The</span>
<span class="sd">                entity type which should be received.</span>
<span class="sd">            entity_id (str): Id of entity.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Received entity data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">((</span><span class="n">project_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">)):</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">entity_endpoint</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">entity_type</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="n">entity_endpoint</span><span class="p">,</span> <span class="n">entity_id</span>
        <span class="p">))</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_folder"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_folder">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_entity_by_id</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;folder&quot;</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_folders"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_folders">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_folders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">include_attrib</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get simplified flat list of all project folders.</span>

<span class="sd">        Get all project folders in single REST call. This can be faster than</span>
<span class="sd">            using &#39;get_folders&#39; method which is using GraphQl, but does not</span>
<span class="sd">            allow any filtering, and set of fields is defined</span>
<span class="sd">            by server backend.</span>

<span class="sd">        Example::</span>

<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: &quot;112233445566&quot;,</span>
<span class="sd">                    &quot;parentId&quot;: &quot;112233445567&quot;,</span>
<span class="sd">                    &quot;path&quot;: &quot;/root/parent/child&quot;,</span>
<span class="sd">                    &quot;parents&quot;: [&quot;root&quot;, &quot;parent&quot;],</span>
<span class="sd">                    &quot;name&quot;: &quot;child&quot;,</span>
<span class="sd">                    &quot;label&quot;: &quot;Child&quot;,</span>
<span class="sd">                    &quot;folderType&quot;: &quot;Folder&quot;,</span>
<span class="sd">                    &quot;hasTasks&quot;: False,</span>
<span class="sd">                    &quot;hasChildren&quot;: False,</span>
<span class="sd">                    &quot;taskNames&quot;: [</span>
<span class="sd">                        &quot;Compositing&quot;,</span>
<span class="sd">                    ],</span>
<span class="sd">                    &quot;status&quot;: &quot;In Progress&quot;,</span>
<span class="sd">                    &quot;attrib&quot;: {},</span>
<span class="sd">                    &quot;ownAttrib&quot;: [],</span>
<span class="sd">                    &quot;updatedAt&quot;: &quot;2023-06-12T15:37:02.420260&quot;,</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            include_attrib (Optional[bool]): Include attribute values</span>
<span class="sd">                in output. Slower to query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of folder entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_tuple</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">UnsupportedServerVersion</span><span class="p">(</span>
                <span class="s2">&quot;Function &#39;get_folders_rest&#39; is supported&quot;</span>
                <span class="s2">&quot; for AYON server 1.0.8 and above.&quot;</span>
            <span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;?attrib=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">include_attrib</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/folders</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;folders&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_task"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_task">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_entity_by_id</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;task&quot;</span><span class="p">,</span> <span class="n">task_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_product"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_product">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">product_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_entity_by_id</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="n">product_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_version"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_version">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_entity_by_id</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">version_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_rest_representation"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_rest_representation">[docs]</a>    <span class="k">def</span> <span class="nf">get_rest_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">representation_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_entity_by_id</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;representation&quot;</span><span class="p">,</span> <span class="n">representation_id</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_project_names"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Receive available project names.</span>

<span class="sd">        User must be logged in.</span>

<span class="sd">        Args:</span>
<span class="sd">            active (Optional[bool]): Filter active/inactive projects. Both</span>
<span class="sd">                are returned if &#39;None&#39; is passed.</span>
<span class="sd">            library (Optional[bool]): Filter standard/library projects. Both</span>
<span class="sd">                are returned if &#39;None&#39; is passed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: List of available project names.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query_keys</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_keys</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">active</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span>

        <span class="k">if</span> <span class="n">library</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">query_keys</span><span class="p">[</span><span class="s2">&quot;library&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span> <span class="k">if</span> <span class="n">library</span> <span class="k">else</span> <span class="s2">&quot;false&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">query_keys</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">query_keys</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">]))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projects</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="o">**</span><span class="n">query_keys</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span>
        <span class="n">project_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;projects&quot;</span><span class="p">]:</span>
                <span class="n">project_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">project</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">project_names</span></div>

    <span class="k">def</span> <span class="nf">_should_use_rest_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Fetch of project must be done using REST endpoint.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: REST endpoint must be used to get requested fields.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_prepare_project_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">own_attributes</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;attrib&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_fields_for_type</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;folderTypes&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;folderTypes&quot;</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">|=</span> <span class="p">{</span>
                <span class="s2">&quot;folderTypes.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;folderType&quot;</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="s2">&quot;taskTypes&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;taskTypes&quot;</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">|=</span> <span class="p">{</span>
                <span class="s2">&quot;taskTypes.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;taskType&quot;</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="s2">&quot;productTypes&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;productTypes&quot;</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">|=</span> <span class="p">{</span>
                <span class="s2">&quot;productTypes.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;productType&quot;</span><span class="p">)</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_projects"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_projects">[docs]</a>    <span class="k">def</span> <span class="nf">get_projects</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">library</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get projects.</span>

<span class="sd">        Args:</span>
<span class="sd">            active (Optional[bool]): Filter active or inactive projects.</span>
<span class="sd">                Filter is disabled when &#39;None&#39; is passed.</span>
<span class="sd">            library (Optional[bool]): Filter library projects. Filter is</span>
<span class="sd">                disabled when &#39;None&#39; is passed.</span>
<span class="sd">            fields (Optional[Iterable[str]]): fields to be queried</span>
<span class="sd">                for project.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Queried projects.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="n">use_rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_use_rest_project</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_rest</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_projects</span><span class="p">(</span><span class="n">active</span><span class="p">,</span> <span class="n">library</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
                    <span class="n">fill_own_attribs</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">project</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_project_fields</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">own_attributes</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">projects_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">project</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;projects&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
                    <span class="n">fill_own_attribs</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">project</span></div>

<div class="viewcode-block" id="ServerAPI.get_project"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project">[docs]</a>    <span class="k">def</span> <span class="nf">get_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            fields (Optional[Iterable[str]]): fields to be queried</span>
<span class="sd">                for project.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Project entity data or None</span>
<span class="sd">                if project was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="n">use_rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_should_use_rest_project</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">use_rest</span><span class="p">:</span>
            <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_project</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
                <span class="n">fill_own_attribs</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">project</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_project_fields</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">own_attributes</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">project_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;projectName&quot;</span><span class="p">,</span> <span class="n">project_name</span><span class="p">)</span>

        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">project</span> <span class="o">=</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">project</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">project</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">project_name</span>
            <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
                <span class="n">fill_own_attribs</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">project</span></div>

<div class="viewcode-block" id="ServerAPI.get_folders_hierarchy"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folders_hierarchy">[docs]</a>    <span class="k">def</span> <span class="nf">get_folders_hierarchy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">search_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_types</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get project hierarchy.</span>

<span class="sd">        All folders in project in hierarchy data structure.</span>

<span class="sd">        Example output:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;hierarchy&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: &quot;...&quot;,</span>
<span class="sd">                        &quot;name&quot;: &quot;...&quot;,</span>
<span class="sd">                        &quot;label&quot;: &quot;...&quot;,</span>
<span class="sd">                        &quot;status&quot;: &quot;...&quot;,</span>
<span class="sd">                        &quot;folderType&quot;: &quot;...&quot;,</span>
<span class="sd">                        &quot;hasTasks&quot;: False,</span>
<span class="sd">                        &quot;taskNames&quot;: [],</span>
<span class="sd">                        &quot;parents&quot;: [],</span>
<span class="sd">                        &quot;parentId&quot;: None,</span>
<span class="sd">                        &quot;children&quot;: [...children folders...]</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                ]</span>
<span class="sd">            }</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for folders.</span>
<span class="sd">            search_string (Optional[str]): Search string to filter folders.</span>
<span class="sd">            folder_types (Optional[Iterable[str]]): Folder types to filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Response data from server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">folder_types</span><span class="p">:</span>
            <span class="n">folder_types</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">folder_types</span><span class="p">)</span>

        <span class="n">query_fields</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;search&quot;</span><span class="p">,</span> <span class="n">search_string</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;types&quot;</span><span class="p">,</span> <span class="n">folder_types</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span>
        <span class="p">]</span>
        <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">query_fields</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;?</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">query_fields</span><span class="p">))</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/hierarchy</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">query</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.get_folders_rest"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folders_rest">[docs]</a>    <span class="k">def</span> <span class="nf">get_folders_rest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">include_attrib</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get simplified flat list of all project folders.</span>

<span class="sd">        Get all project folders in single REST call. This can be faster than</span>
<span class="sd">            using &#39;get_folders&#39; method which is using GraphQl, but does not</span>
<span class="sd">            allow any filtering, and set of fields is defined</span>
<span class="sd">            by server backend.</span>

<span class="sd">        Example::</span>

<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;id&quot;: &quot;112233445566&quot;,</span>
<span class="sd">                    &quot;parentId&quot;: &quot;112233445567&quot;,</span>
<span class="sd">                    &quot;path&quot;: &quot;/root/parent/child&quot;,</span>
<span class="sd">                    &quot;parents&quot;: [&quot;root&quot;, &quot;parent&quot;],</span>
<span class="sd">                    &quot;name&quot;: &quot;child&quot;,</span>
<span class="sd">                    &quot;label&quot;: &quot;Child&quot;,</span>
<span class="sd">                    &quot;folderType&quot;: &quot;Folder&quot;,</span>
<span class="sd">                    &quot;hasTasks&quot;: False,</span>
<span class="sd">                    &quot;hasChildren&quot;: False,</span>
<span class="sd">                    &quot;taskNames&quot;: [</span>
<span class="sd">                        &quot;Compositing&quot;,</span>
<span class="sd">                    ],</span>
<span class="sd">                    &quot;status&quot;: &quot;In Progress&quot;,</span>
<span class="sd">                    &quot;attrib&quot;: {},</span>
<span class="sd">                    &quot;ownAttrib&quot;: [],</span>
<span class="sd">                    &quot;updatedAt&quot;: &quot;2023-06-12T15:37:02.420260&quot;,</span>
<span class="sd">                },</span>
<span class="sd">                ...</span>
<span class="sd">            ]</span>

<span class="sd">        Deprecated:</span>
<span class="sd">            Use &#39;get_rest_folders&#39; instead. Function was renamed to match</span>
<span class="sd">                other rest functions, like &#39;get_rest_folder&#39;,</span>
<span class="sd">                &#39;get_rest_project&#39; etc. .</span>
<span class="sd">            Will be removed in &#39;1.0.7&#39; or &#39;1.1.0&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            include_attrib (Optional[bool]): Include attribute values</span>
<span class="sd">                in output. Slower to query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: List of folder entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_folders</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">include_attrib</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_folders"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folders">[docs]</a>    <span class="k">def</span> <span class="nf">get_folders</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_paths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_path_regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">has_products</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">has_tasks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">has_children</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">has_links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query folders from server.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Folder name won&#39;t be unique identifier, so we should add folder path</span>
<span class="sd">                filtering.</span>

<span class="sd">        Notes:</span>
<span class="sd">            Filter &#39;active&#39; don&#39;t have direct filter in GraphQl.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            folder_ids (Optional[Iterable[str]]): Folder ids to filter.</span>
<span class="sd">            folder_paths (Optional[Iterable[str]]): Folder paths used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            folder_names (Optional[Iterable[str]]): Folder names used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            folder_types (Optional[Iterable[str]]): Folder types used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            parent_ids (Optional[Iterable[str]]): Ids of folder parents.</span>
<span class="sd">                Use &#39;None&#39; if folder is direct child of project.</span>
<span class="sd">            folder_path_regex (Optional[str]): Folder path regex used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            has_products (Optional[bool]): Filter folders with/without</span>
<span class="sd">                products. Ignored when None, default behavior.</span>
<span class="sd">            has_tasks (Optional[bool]): Filter folders with/without</span>
<span class="sd">                tasks. Ignored when None, default behavior.</span>
<span class="sd">            has_children (Optional[bool]): Filter folders with/without</span>
<span class="sd">                children. Ignored when None, default behavior.</span>
<span class="sd">            statuses (Optional[Iterable[str]]): Folder statuses used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Folder tags used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            active (Optional[bool]): Filter active/inactive folders.</span>
<span class="sd">                Both are returned if is set to None.</span>
<span class="sd">            has_links (Optional[Literal[IN, OUT, ANY]]): Filter</span>
<span class="sd">                representations with IN/OUT/ANY links.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                folder. All possible folder fields are returned</span>
<span class="sd">                if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Queried folder entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_name</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">folder_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">folder_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">folder_paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_paths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_paths</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_paths</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderPaths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">folder_paths</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">folder_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_names</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_names</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">folder_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">folder_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_types</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">folder_types</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderStatuses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderTags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">parent_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">parent_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parent_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">parent_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">parent_ids</span><span class="p">:</span>
                <span class="c1"># Replace &#39;None&#39; with &#39;&quot;root&quot;&#39; which is used during GraphQl</span>
                <span class="c1">#   query for parent ids filter for folders without folder</span>
                <span class="c1">#   parent</span>
                <span class="n">parent_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">parent_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">project_name</span> <span class="ow">in</span> <span class="n">parent_ids</span><span class="p">:</span>
                <span class="c1"># Replace project name with &#39;&quot;root&quot;&#39; which is used during</span>
                <span class="c1">#   GraphQl query for parent ids filter for folders without</span>
                <span class="c1">#   folder parent</span>
                <span class="n">parent_ids</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>
                <span class="n">parent_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">)</span>

            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;parentFolderIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parent_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">folder_path_regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderPathRegex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">folder_path_regex</span>

        <span class="k">if</span> <span class="n">has_products</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderHasProducts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_products</span>

        <span class="k">if</span> <span class="n">has_tasks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderHasTasks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_tasks</span>

        <span class="k">if</span> <span class="n">has_links</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderHasLinks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_links</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">has_children</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderHasChildren&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_children</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;folder&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;attrib&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_fields_for_type</span><span class="p">(</span><span class="s2">&quot;folder&quot;</span><span class="p">)</span>

        <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
            <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">own_attributes</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">use_rest</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">folders_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;folders&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">use_rest</span><span class="p">:</span>
                    <span class="n">folder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_folder</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
                    <span class="n">fill_own_attribs</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">folder</span></div>

<div class="viewcode-block" id="ServerAPI.get_folder_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folder_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query folder entity by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            folder_id (str): Folder id.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Folder entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folders</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">folder_ids</span><span class="o">=</span><span class="p">[</span><span class="n">folder_id</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">folder</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_folder_by_path"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folder_by_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_by_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_path</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query folder entity by path.</span>

<span class="sd">        Folder path is a path to folder with all parent names joined by slash.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            folder_path (str): Folder path.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Folder entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folders</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">folder_paths</span><span class="o">=</span><span class="p">[</span><span class="n">folder_path</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">folder</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_folder_by_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folder_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_by_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_name</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query folder entity by path.</span>

<span class="sd">        Warnings:</span>
<span class="sd">            Folder name is not a unique identifier of a folder. Function is</span>
<span class="sd">                kept for OpenPype 3 compatibility.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            folder_name (str): Folder name.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Folder entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folders</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folders</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">folder_names</span><span class="o">=</span><span class="p">[</span><span class="n">folder_name</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">folder</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_folder_ids_with_products"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folder_ids_with_products">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_ids_with_products</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">folder_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find folders which have at least one product.</span>

<span class="sd">        Folders that have at least one product should be immutable, so they</span>
<span class="sd">        should not change path -&gt; change of name or name of any parent</span>
<span class="sd">        is not possible.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            folder_ids (Optional[Iterable[str]]): Limit folder ids filtering</span>
<span class="sd">                to a set of folders. If set to None all folders on project are</span>
<span class="sd">                checked.</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: Folder ids that have at least one product.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">folder_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">set</span><span class="p">()</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">folders_graphql_query</span><span class="p">({</span><span class="s2">&quot;id&quot;</span><span class="p">})</span>
        <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;projectName&quot;</span><span class="p">,</span> <span class="n">project_name</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;folderHasProducts&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">folder_ids</span><span class="p">:</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;folderIds&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">folder_ids</span><span class="p">))</span>

        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">folders</span> <span class="o">=</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;folders&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">folders</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ServerAPI.create_folder"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_folder">[docs]</a>    <span class="k">def</span> <span class="nf">create_folder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">folder_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">thumbnail_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new folder.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            name (str): Folder name.</span>
<span class="sd">            folder_type (Optional[str]): Folder type.</span>
<span class="sd">            parent_id (Optional[str]): Parent folder id. Parent is project</span>
<span class="sd">                if is ``None``.</span>
<span class="sd">            label (Optional[str]): Label of folder.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): Folder attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): Folder data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Folder tags.</span>
<span class="sd">            status (Optional[str]): Folder status.</span>
<span class="sd">            active (Optional[bool]): Folder active state.</span>
<span class="sd">            thumbnail_id (Optional[str]): Folder thumbnail id.</span>
<span class="sd">            folder_id (Optional[str]): Folder id. If not passed new id is</span>
<span class="sd">                generated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Entity id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_id</span><span class="p">:</span>
            <span class="n">folder_id</span> <span class="o">=</span> <span class="n">create_entity_id</span><span class="p">()</span>
        <span class="n">create_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">folder_id</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;folderType&quot;</span><span class="p">,</span> <span class="n">folder_type</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;parentId&quot;</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">create_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/folders&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="o">**</span><span class="n">create_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">folder_id</span></div>

<div class="viewcode-block" id="ServerAPI.update_folder"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_folder">[docs]</a>    <span class="k">def</span> <span class="nf">update_folder</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_id</span><span class="o">=</span><span class="n">NOT_SET</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">NOT_SET</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">thumbnail_id</span><span class="o">=</span><span class="n">NOT_SET</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update folder entity on server.</span>

<span class="sd">        Do not pass ``parent_id``, ``label`` amd ``thumbnail_id`` if you don&#39;t</span>
<span class="sd">            want to change their values. Value ``None`` would unset</span>
<span class="sd">            their value.</span>

<span class="sd">        Update of ``data`` will override existing value on folder entity.</span>

<span class="sd">        Update of ``attrib`` does change only passed attributes. If you want</span>
<span class="sd">            to unset value, use ``None``.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            folder_id (str): Folder id.</span>
<span class="sd">            name (Optional[str]): New name.</span>
<span class="sd">            folder_type (Optional[str]): New folder type.</span>
<span class="sd">            parent_id (Optional[Union[str, None]]): New parent folder id.</span>
<span class="sd">            label (Optional[Union[str, None]]): New label.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): New attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): New data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): New tags.</span>
<span class="sd">            status (Optional[str]): New status.</span>
<span class="sd">            active (Optional[bool]): New active state.</span>
<span class="sd">            thumbnail_id (Optional[Union[str, None]]): New thumbnail id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;folderType&quot;</span><span class="p">,</span> <span class="n">folder_type</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">update_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;parentId&quot;</span><span class="p">,</span> <span class="n">parent_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NOT_SET</span><span class="p">:</span>
                <span class="n">update_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/folders/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">),</span>
            <span class="o">**</span><span class="n">update_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_folder"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_folder">[docs]</a>    <span class="k">def</span> <span class="nf">delete_folder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete folder.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            folder_id (str): Folder id to delete.</span>
<span class="sd">            force (Optional[bool]): Folder delete folder with all children</span>
<span class="sd">                folder, products, versions and representations.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/folders/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">url</span> <span class="o">+=</span> <span class="s2">&quot;?force=true&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.get_tasks"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_tasks">[docs]</a>    <span class="k">def</span> <span class="nf">get_tasks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">task_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assignees</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assignees_all</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query task entities from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            task_ids (Iterable[str]): Task ids to filter.</span>
<span class="sd">            task_names (Iterable[str]): Task names used for filtering.</span>
<span class="sd">            task_types (Iterable[str]): Task types used for filtering.</span>
<span class="sd">            folder_ids (Iterable[str]): Ids of task parents. Use &#39;None&#39;</span>
<span class="sd">                if folder is direct child of project.</span>
<span class="sd">            assignees (Optional[Iterable[str]]): Task assignees used for</span>
<span class="sd">                filtering. All tasks with any of passed assignees are</span>
<span class="sd">                returned.</span>
<span class="sd">            assignees_all (Optional[Iterable[str]]): Task assignees used</span>
<span class="sd">                for filtering. Task must have all of passed assignees to be</span>
<span class="sd">                returned.</span>
<span class="sd">            statuses (Optional[Iterable[str]]): Task statuses used for</span>
<span class="sd">                filtering.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Task tags used for</span>
<span class="sd">                filtering.</span>
<span class="sd">            active (Optional[bool]): Filter active/inactive tasks.</span>
<span class="sd">                Both are returned if is set to None.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                folder. All possible folder fields are returned</span>
<span class="sd">                if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Queried task entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_name</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">task_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">task_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">task_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">task_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_names</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">task_names</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">task_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">task_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">task_types</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">task_types</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">folder_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">folder_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">assignees</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assignees</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">assignees</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">assignees</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskAssigneesAny&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">assignees</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">assignees_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assignees_all</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">assignees_all</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">assignees_all</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskAssigneesAll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">assignees_all</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskStatuses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskTags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;attrib&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_fields_for_type</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">)</span>

        <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
            <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">tasks_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;tasks&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">use_rest</span><span class="p">:</span>
                    <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_task</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
                    <span class="n">fill_own_attribs</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">task</span></div>

<div class="viewcode-block" id="ServerAPI.get_task_by_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_task_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_by_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="p">,</span>
        <span class="n">task_name</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query task entity by name and folder id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            folder_id (str): Folder id.</span>
<span class="sd">            task_name (str): Task name</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Task entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tasks</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">folder_ids</span><span class="o">=</span><span class="p">[</span><span class="n">folder_id</span><span class="p">],</span>
            <span class="n">task_names</span><span class="o">=</span><span class="p">[</span><span class="n">task_name</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">task</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_task_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_task_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query task entity by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            task_id (str): Task id.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Task entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tasks</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">task_ids</span><span class="o">=</span><span class="p">[</span><span class="n">task_id</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">task</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_tasks_by_folder_paths"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_tasks_by_folder_paths">[docs]</a>    <span class="k">def</span> <span class="nf">get_tasks_by_folder_paths</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_paths</span><span class="p">,</span>
        <span class="n">task_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assignees</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assignees_all</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query task entities from server by folder paths.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            folder_paths (list[str]): Folder paths.</span>
<span class="sd">            task_names (Iterable[str]): Task names used for filtering.</span>
<span class="sd">            task_types (Iterable[str]): Task types used for filtering.</span>
<span class="sd">            assignees (Optional[Iterable[str]]): Task assignees used for</span>
<span class="sd">                filtering. All tasks with any of passed assignees are</span>
<span class="sd">                returned.</span>
<span class="sd">            assignees_all (Optional[Iterable[str]]): Task assignees used</span>
<span class="sd">                for filtering. Task must have all of passed assignees to be</span>
<span class="sd">                returned.</span>
<span class="sd">            statuses (Optional[Iterable[str]]): Task statuses used for</span>
<span class="sd">                filtering.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Task tags used for</span>
<span class="sd">                filtering.</span>
<span class="sd">            active (Optional[bool]): Filter active/inactive tasks.</span>
<span class="sd">                Both are returned if is set to None.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                folder. All possible folder fields are returned</span>
<span class="sd">                if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[dict[str, list[dict[str, Any]]]: Task entities by</span>
<span class="sd">                folder path.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">folder_paths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_paths</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">folder_paths</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span><span class="p">,</span>
            <span class="s2">&quot;folderPaths&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">folder_paths</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">task_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_names</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">task_names</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">task_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">task_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">task_types</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">task_types</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">assignees</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assignees</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">assignees</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">assignees</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskAssigneesAny&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">assignees</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">assignees_all</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">assignees_all</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">assignees_all</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">assignees_all</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskAssigneesAll&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">assignees_all</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskStatuses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskTags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;attrib&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_fields_for_type</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">)</span>

        <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
            <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;ownAttrib&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">tasks_by_folder_paths_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">folder_path</span><span class="p">:</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">folder_path</span> <span class="ow">in</span> <span class="n">folder_paths</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">folder</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;folders&quot;</span><span class="p">]:</span>
                <span class="n">folder_path</span> <span class="o">=</span> <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">folder</span><span class="p">[</span><span class="s2">&quot;tasks&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]:</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">use_rest</span><span class="p">:</span>
                        <span class="n">task</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_task</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">task</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">own_attributes</span><span class="p">:</span>
                        <span class="n">fill_own_attribs</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
                    <span class="n">output</span><span class="p">[</span><span class="n">folder_path</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="ServerAPI.get_tasks_by_folder_path"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_tasks_by_folder_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_tasks_by_folder_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_path</span><span class="p">,</span>
        <span class="n">task_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assignees</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assignees_all</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query task entities from server by folder path.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            folder_path (str): Folder path.</span>
<span class="sd">            task_names (Iterable[str]): Task names used for filtering.</span>
<span class="sd">            task_types (Iterable[str]): Task types used for filtering.</span>
<span class="sd">            assignees (Optional[Iterable[str]]): Task assignees used for</span>
<span class="sd">                filtering. All tasks with any of passed assignees are</span>
<span class="sd">                returned.</span>
<span class="sd">            assignees_all (Optional[Iterable[str]]): Task assignees used</span>
<span class="sd">                for filtering. Task must have all of passed assignees to be</span>
<span class="sd">                returned.</span>
<span class="sd">            statuses (Optional[Iterable[str]]): Task statuses used for</span>
<span class="sd">                filtering.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Task tags used for</span>
<span class="sd">                filtering.</span>
<span class="sd">            active (Optional[bool]): Filter active/inactive tasks.</span>
<span class="sd">                Both are returned if is set to None.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                folder. All possible folder fields are returned</span>
<span class="sd">                if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tasks_by_folder_paths</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="p">[</span><span class="n">folder_path</span><span class="p">],</span>
            <span class="n">task_names</span><span class="p">,</span>
            <span class="n">task_types</span><span class="o">=</span><span class="n">task_types</span><span class="p">,</span>
            <span class="n">assignees</span><span class="o">=</span><span class="n">assignees</span><span class="p">,</span>
            <span class="n">assignees_all</span><span class="o">=</span><span class="n">assignees_all</span><span class="p">,</span>
            <span class="n">statuses</span><span class="o">=</span><span class="n">statuses</span><span class="p">,</span>
            <span class="n">tags</span><span class="o">=</span><span class="n">tags</span><span class="p">,</span>
            <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)[</span><span class="n">folder_path</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_task_by_folder_path"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_task_by_folder_path">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_by_folder_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_path</span><span class="p">,</span>
        <span class="n">task_name</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query task entity by folder path and task name.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            folder_path (str): Folder path.</span>
<span class="sd">            task_name (str): Task name.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Task fields that should</span>
<span class="sd">                be returned.</span>
<span class="sd">            own_attributes (Optional[bool]): Attribute values that are</span>
<span class="sd">                not explicitly set on entity will have &#39;None&#39; value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Task entity data or None if was</span>
<span class="sd">                not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tasks_by_folder_path</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">folder_path</span><span class="p">,</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">task_names</span><span class="o">=</span><span class="p">[</span><span class="n">task_name</span><span class="p">],</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">task</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.create_task"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_task">[docs]</a>    <span class="k">def</span> <span class="nf">create_task</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">task_type</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">assignees</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">thumbnail_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new task.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            name (str): Folder name.</span>
<span class="sd">            task_type (str): Task type.</span>
<span class="sd">            folder_id (str): Parent folder id.</span>
<span class="sd">            label (Optional[str]): Label of folder.</span>
<span class="sd">            assignees (Optional[Iterable[str]]): Task assignees.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): Task attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): Task data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Task tags.</span>
<span class="sd">            status (Optional[str]): Task status.</span>
<span class="sd">            active (Optional[bool]): Task active state.</span>
<span class="sd">            thumbnail_id (Optional[str]): Task thumbnail id.</span>
<span class="sd">            task_id (Optional[str]): Task id. If not passed new id is</span>
<span class="sd">                generated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Task id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_id</span><span class="p">:</span>
            <span class="n">task_id</span> <span class="o">=</span> <span class="n">create_entity_id</span><span class="p">()</span>
        <span class="n">create_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">task_id</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;taskType&quot;</span><span class="p">:</span> <span class="n">task_type</span><span class="p">,</span>
            <span class="s2">&quot;folderId&quot;</span><span class="p">:</span> <span class="n">folder_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;assignees&quot;</span><span class="p">,</span> <span class="n">assignees</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">create_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/tasks&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="o">**</span><span class="n">create_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">folder_id</span></div>

<div class="viewcode-block" id="ServerAPI.update_task"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_task">[docs]</a>    <span class="k">def</span> <span class="nf">update_task</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">NOT_SET</span><span class="p">,</span>
        <span class="n">assignees</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">thumbnail_id</span><span class="o">=</span><span class="n">NOT_SET</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update task entity on server.</span>

<span class="sd">        Do not pass ``label`` amd ``thumbnail_id`` if you don&#39;t</span>
<span class="sd">            want to change their values. Value ``None`` would unset</span>
<span class="sd">            their value.</span>

<span class="sd">        Update of ``data`` will override existing value on folder entity.</span>

<span class="sd">        Update of ``attrib`` does change only passed attributes. If you want</span>
<span class="sd">            to unset value, use ``None``.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            task_id (str): Task id.</span>
<span class="sd">            name (Optional[str]): New name.</span>
<span class="sd">            task_type (Optional[str]): New task type.</span>
<span class="sd">            folder_id (Optional[str]): New folder id.</span>
<span class="sd">            label (Optional[Union[str, None]]): New label.</span>
<span class="sd">            assignees (Optional[str]): New assignees.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): New attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): New data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): New tags.</span>
<span class="sd">            status (Optional[str]): New status.</span>
<span class="sd">            active (Optional[bool]): New active state.</span>
<span class="sd">            thumbnail_id (Optional[Union[str, None]]): New thumbnail id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;taskType&quot;</span><span class="p">,</span> <span class="n">task_type</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;folderId&quot;</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;assignees&quot;</span><span class="p">,</span> <span class="n">assignees</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">update_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="n">label</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NOT_SET</span><span class="p">:</span>
                <span class="n">update_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/tasks/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">task_id</span><span class="p">),</span>
            <span class="o">**</span><span class="n">update_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_task"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_task">[docs]</a>    <span class="k">def</span> <span class="nf">delete_task</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">task_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete task.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            task_id (str): Task id to delete.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/tasks/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">task_id</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_filter_product</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">use_rest</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">product</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">active</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">use_rest</span><span class="p">:</span>
            <span class="n">product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_product</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">product</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">product</span>

<div class="viewcode-block" id="ServerAPI.get_products"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_products">[docs]</a>    <span class="k">def</span> <span class="nf">get_products</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_name_regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_path_regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">names_by_folder_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query products from server.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Separate &#39;name_by_folder_ids&#39; filtering to separated method. It</span>
<span class="sd">                cannot be combined with some other filters.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            product_ids (Optional[Iterable[str]]): Task ids to filter.</span>
<span class="sd">            product_names (Optional[Iterable[str]]): Task names used for</span>
<span class="sd">                filtering.</span>
<span class="sd">            folder_ids (Optional[Iterable[str]]): Ids of task parents.</span>
<span class="sd">                Use &#39;None&#39; if folder is direct child of project.</span>
<span class="sd">            product_types (Optional[Iterable[str]]): Product types used for</span>
<span class="sd">                filtering.</span>
<span class="sd">            product_name_regex (Optional[str]): Filter products by name regex.</span>
<span class="sd">            product_path_regex (Optional[str]): Filter products by path regex.</span>
<span class="sd">                Path starts with folder path and ends with product name.</span>
<span class="sd">            names_by_folder_ids (Optional[dict[str, Iterable[str]]]): Product</span>
<span class="sd">                name filtering by folder id.</span>
<span class="sd">            statuses (Optional[Iterable[str]]): Product statuses used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Product tags used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            active (Optional[bool]): Filter active/inactive products.</span>
<span class="sd">                Both are returned if is set to None.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                folder. All possible folder fields are returned</span>
<span class="sd">                if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                products.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Queried product entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">project_name</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="c1"># Prepare these filters before &#39;name_by_filter_ids&#39; filter</span>
        <span class="n">filter_product_names</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">product_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filter_product_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">product_names</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_product_names</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="n">filter_folder_ids</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">folder_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filter_folder_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_folder_ids</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># This will disable &#39;folder_ids&#39; and &#39;product_names&#39; filters</span>
        <span class="c1">#   - maybe could be enhanced in future?</span>
        <span class="k">if</span> <span class="n">names_by_folder_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filter_product_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">filter_folder_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">folder_id</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">names_by_folder_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">folder_id</span> <span class="ow">and</span> <span class="n">names</span><span class="p">:</span>
                    <span class="n">filter_folder_ids</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">folder_id</span><span class="p">)</span>
                    <span class="n">filter_product_names</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">filter_product_names</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">filter_folder_ids</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="c1"># Convert fields and add minimum required fields</span>
        <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">}</span>
            <span class="k">if</span> <span class="s2">&quot;attrib&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_fields_for_type</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">)</span>

        <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
            <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">own_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_PLACEHOLDER</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;&#39;own_attributes&#39; is not supported for products. The argument&quot;</span>
                <span class="s2">&quot; will be removed form function signature in future&quot;</span>
                <span class="s2">&quot; (apx. version 1.0.10 or 1.1.0).&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Add &#39;name&#39; and &#39;folderId&#39; if &#39;names_by_folder_ids&#39; filter is entered</span>
        <span class="k">if</span> <span class="n">names_by_folder_ids</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;folderId&quot;</span><span class="p">)</span>

        <span class="c1"># Prepare filters for query</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">filter_folder_ids</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;folderIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filter_folder_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">filter_product_names</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;productNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filter_product_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">product_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">product_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">product_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">product_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;productIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">product_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">product_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">product_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">product_types</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;productTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product_types</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;productStatuses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;productTags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">product_name_regex</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;productNameRegex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product_name_regex</span>

        <span class="k">if</span> <span class="n">product_path_regex</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;productPathRegex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">product_path_regex</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">products_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">products</span> <span class="o">=</span> <span class="n">parsed_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;products&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="c1"># Filter products by &#39;names_by_folder_ids&#39;</span>
        <span class="k">if</span> <span class="n">names_by_folder_ids</span><span class="p">:</span>
            <span class="n">products_by_folder_id</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
                <span class="n">filtered_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_product</span><span class="p">(</span>
                    <span class="n">project_name</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">use_rest</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">filtered_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">folder_id</span> <span class="o">=</span> <span class="n">filtered_product</span><span class="p">[</span><span class="s2">&quot;folderId&quot;</span><span class="p">]</span>
                    <span class="n">products_by_folder_id</span><span class="p">[</span><span class="n">folder_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">filtered_product</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">folder_id</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">names_by_folder_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">folder_product</span> <span class="ow">in</span> <span class="n">products_by_folder_id</span><span class="p">[</span><span class="n">folder_id</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">folder_product</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">folder_product</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
                <span class="n">filtered_product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filter_product</span><span class="p">(</span>
                    <span class="n">project_name</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">active</span><span class="p">,</span> <span class="n">use_rest</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">filtered_product</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">filtered_product</span></div>

<div class="viewcode-block" id="ServerAPI.get_product_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_product_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_product_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query product entity by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            product_id (str): Product id.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                products.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Product entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">products</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_products</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">product_ids</span><span class="o">=</span><span class="p">[</span><span class="n">product_id</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">product</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_product_by_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_product_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_product_by_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_name</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query product entity by name and folder id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            product_name (str): Product name.</span>
<span class="sd">            folder_id (str): Folder id (Folder is a parent of products).</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                products.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Product entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">products</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_products</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">product_names</span><span class="o">=</span><span class="p">[</span><span class="n">product_name</span><span class="p">],</span>
            <span class="n">folder_ids</span><span class="o">=</span><span class="p">[</span><span class="n">folder_id</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">product</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_product_types"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_product_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_product_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Types of products.</span>

<span class="sd">        This is server wide information. Product types have &#39;name&#39;, &#39;icon&#39; and</span>
<span class="sd">            &#39;color&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            fields (Optional[Iterable[str]]): Product types fields to query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Product types information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;productType&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">product_types_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parsed_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;productTypes&quot;</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="ServerAPI.get_project_product_types"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_project_product_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_project_product_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Types of products available on a project.</span>

<span class="sd">        Filter only product types available on project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for</span>
<span class="sd">                product types.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Product types fields to query.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Product types information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;productType&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">project_product_types_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;projectName&quot;</span><span class="p">,</span> <span class="n">project_name</span><span class="p">)</span>

        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">parsed_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;productTypes&quot;</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="ServerAPI.get_product_type_names"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_product_type_names">[docs]</a>    <span class="k">def</span> <span class="nf">get_product_type_names</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">product_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Product type names.</span>

<span class="sd">        Warnings:</span>
<span class="sd">            This function will be probably removed. Matters if &#39;products_id&#39;</span>
<span class="sd">                filter has real use-case.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (Optional[str]): Name of project where to look for</span>
<span class="sd">                queried entities.</span>
<span class="sd">            product_ids (Optional[Iterable[str]]): Product ids filter. Can be</span>
<span class="sd">                used only with &#39;project_name&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            set[str]: Product type names.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">project_name</span> <span class="ow">and</span> <span class="n">product_ids</span><span class="p">:</span>
            <span class="n">products</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_products</span><span class="p">(</span>
                <span class="n">project_name</span><span class="p">,</span>
                <span class="n">product_ids</span><span class="o">=</span><span class="n">product_ids</span><span class="p">,</span>
                <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;productType&quot;</span><span class="p">],</span>
                <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="n">product</span><span class="p">[</span><span class="s2">&quot;productType&quot;</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">products</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="n">product_info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">product_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_product_types</span><span class="p">(</span>
                <span class="n">project_name</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ServerAPI.create_product"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_product">[docs]</a>    <span class="k">def</span> <span class="nf">create_product</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">product_type</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new product.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            name (str): Product name.</span>
<span class="sd">            product_type (str): Product type.</span>
<span class="sd">            folder_id (str): Parent folder id.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): Product attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): Product data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Product tags.</span>
<span class="sd">            status (Optional[str]): Product status.</span>
<span class="sd">            active (Optional[bool]): Product active state.</span>
<span class="sd">            product_id (Optional[str]): Product id. If not passed new id is</span>
<span class="sd">                generated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Product id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">product_id</span><span class="p">:</span>
            <span class="n">product_id</span> <span class="o">=</span> <span class="n">create_entity_id</span><span class="p">()</span>
        <span class="n">create_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">product_id</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;productType&quot;</span><span class="p">:</span> <span class="n">product_type</span><span class="p">,</span>
            <span class="s2">&quot;folderId&quot;</span><span class="p">:</span> <span class="n">folder_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">create_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/products&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="o">**</span><span class="n">create_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">product_id</span></div>

<div class="viewcode-block" id="ServerAPI.update_product"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_product">[docs]</a>    <span class="k">def</span> <span class="nf">update_product</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_id</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update product entity on server.</span>

<span class="sd">        Update of ``data`` will override existing value on folder entity.</span>

<span class="sd">        Update of ``attrib`` does change only passed attributes. If you want</span>
<span class="sd">            to unset value, use ``None``.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            product_id (str): Product id.</span>
<span class="sd">            name (Optional[str]): New product name.</span>
<span class="sd">            folder_id (Optional[str]): New product id.</span>
<span class="sd">            product_type (Optional[str]): New product type.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): New product attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): New product data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): New product tags.</span>
<span class="sd">            status (Optional[str]): New product status.</span>
<span class="sd">            active (Optional[bool]): New product active state.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;productType&quot;</span><span class="p">,</span> <span class="n">product_type</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;folderId&quot;</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">update_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/products/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">product_id</span><span class="p">),</span>
            <span class="o">**</span><span class="n">update_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_product"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_product">[docs]</a>    <span class="k">def</span> <span class="nf">delete_product</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">product_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete product.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            product_id (str): Product id to delete.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/products/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">product_id</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.get_versions"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_versions">[docs]</a>    <span class="k">def</span> <span class="nf">get_versions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">versions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">hero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">standard</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">latest</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get version entities based on passed filters from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for versions.</span>
<span class="sd">            version_ids (Optional[Iterable[str]]): Version ids used for</span>
<span class="sd">                version filtering.</span>
<span class="sd">            product_ids (Optional[Iterable[str]]): Product ids used for</span>
<span class="sd">                version filtering.</span>
<span class="sd">            versions (Optional[Iterable[int]]): Versions we&#39;re interested in.</span>
<span class="sd">            hero (Optional[bool]): Receive also hero versions when set to true.</span>
<span class="sd">            standard (Optional[bool]): Receive versions which are not hero when</span>
<span class="sd">                set to true.</span>
<span class="sd">            latest (Optional[bool]): Return only latest version of standard</span>
<span class="sd">                versions. This can be combined only with &#39;standard&#39; attribute</span>
<span class="sd">                set to True.</span>
<span class="sd">            statuses (Optional[Iterable[str]]): Representation statuses used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Representation tags used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            active (Optional[bool]): Receive active/inactive entities.</span>
<span class="sd">                Both are returned when &#39;None&#39; is passed.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried</span>
<span class="sd">                for version. All possible folder fields are returned</span>
<span class="sd">                if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                versions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Queried version entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;attrib&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_fields_for_type</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>

        <span class="c1"># Make sure fields have minimum required fields</span>
        <span class="n">fields</span> <span class="o">|=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">}</span>

        <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
            <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">own_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_PLACEHOLDER</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;&#39;own_attributes&#39; is not supported for versions. The argument&quot;</span>
                <span class="s2">&quot; will be removed form function signature in future&quot;</span>
                <span class="s2">&quot; (apx. version 1.0.10 or 1.1.0).&quot;</span>
            <span class="p">)</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">version_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">version_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;versionIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">version_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">product_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">product_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">product_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">product_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;productIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">product_ids</span><span class="p">)</span>

        <span class="c1"># TODO versions can&#39;t be used as filter at this moment!</span>
        <span class="k">if</span> <span class="n">versions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">versions</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">versions</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;versions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">versions</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;versionStatuses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;versionTags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">hero</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">standard</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">queries</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># Add filters based on &#39;hero&#39; and &#39;standard&#39;</span>
        <span class="c1"># NOTE: There is not a filter to &quot;ignore&quot; hero versions or to get</span>
        <span class="c1">#   latest and hero version</span>
        <span class="c1"># - if latest and hero versions should be returned it must be done in</span>
        <span class="c1">#       2 graphql queries</span>
        <span class="k">if</span> <span class="n">standard</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">latest</span><span class="p">:</span>
            <span class="c1"># This query all versions standard + hero</span>
            <span class="c1"># - hero must be filtered out if is not enabled during loop</span>
            <span class="n">query</span> <span class="o">=</span> <span class="n">versions_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>
            <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">hero</span><span class="p">:</span>
                <span class="c1"># Add hero query if hero is enabled</span>
                <span class="n">hero_query</span> <span class="o">=</span> <span class="n">versions_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">hero_query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

                <span class="n">hero_query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;heroOnly&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">hero_query</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">standard</span><span class="p">:</span>
                <span class="n">standard_query</span> <span class="o">=</span> <span class="n">versions_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">standard_query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">latest</span><span class="p">:</span>
                    <span class="n">standard_query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;latestOnly&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">standard_query</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">queries</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;versions&quot;</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">version</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">active</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="ow">not</span> <span class="n">hero</span> <span class="ow">and</span> <span class="n">version</span><span class="p">[</span><span class="s2">&quot;version&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">continue</span>

                    <span class="k">if</span> <span class="n">use_rest</span><span class="p">:</span>
                        <span class="n">version</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_version</span><span class="p">(</span>
                            <span class="n">project_name</span><span class="p">,</span> <span class="n">version</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>

                    <span class="k">yield</span> <span class="n">version</span></div>

<div class="viewcode-block" id="ServerAPI.get_version_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_version_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_version_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query version entity by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            version_id (str): Version id.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                versions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Version entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_versions</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">version_ids</span><span class="o">=</span><span class="p">[</span><span class="n">version_id</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">hero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">version</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_version_by_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_version_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_version_by_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version</span><span class="p">,</span>
        <span class="n">product_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query version entity by version and product id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            version (int): Version of version entity.</span>
<span class="sd">            product_id (str): Product id. Product is a parent of version.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                versions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Version entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_versions</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">product_ids</span><span class="o">=</span><span class="p">[</span><span class="n">product_id</span><span class="p">],</span>
            <span class="n">versions</span><span class="o">=</span><span class="p">[</span><span class="n">version</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">version</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_hero_version_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_hero_version_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_hero_version_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query hero version entity by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            version_id (int): Hero version id.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                versions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Version entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hero_versions</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">version_ids</span><span class="o">=</span><span class="p">[</span><span class="n">version_id</span><span class="p">],</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">version</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_hero_version_by_product_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_hero_version_by_product_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_hero_version_by_product_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query hero version entity by product id.</span>

<span class="sd">        Only one hero version is available on a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            product_id (int): Product id.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                versions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Version entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_hero_versions</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">product_ids</span><span class="o">=</span><span class="p">[</span><span class="n">product_id</span><span class="p">],</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">version</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_hero_versions"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_hero_versions">[docs]</a>    <span class="k">def</span> <span class="nf">get_hero_versions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query hero versions by multiple filters.</span>

<span class="sd">        Only one hero version is available on a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for queried</span>
<span class="sd">                entities.</span>
<span class="sd">            product_ids (Optional[Iterable[str]]): Product ids.</span>
<span class="sd">            version_ids (Optional[Iterable[str]]): Version ids.</span>
<span class="sd">            active (Optional[bool]): Receive active/inactive entities.</span>
<span class="sd">                Both are returned when &#39;None&#39; is passed.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields that should be returned.</span>
<span class="sd">                All fields are returned if &#39;None&#39; is passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                versions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict, None]: Version entity data or None if was not found.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_versions</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">version_ids</span><span class="o">=</span><span class="n">version_ids</span><span class="p">,</span>
            <span class="n">product_ids</span><span class="o">=</span><span class="n">product_ids</span><span class="p">,</span>
            <span class="n">hero</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">standard</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_last_versions"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_last_versions">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_versions</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_ids</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query last version entities by product ids.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for representation.</span>
<span class="sd">            product_ids (Iterable[str]): Product ids.</span>
<span class="sd">            active (Optional[bool]): Receive active/inactive entities.</span>
<span class="sd">                Both are returned when &#39;None&#39; is passed.</span>
<span class="sd">            fields (Optional[Iterable[str]]): fields to be queried</span>
<span class="sd">                for representations.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                versions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, dict[str, Any]]: Last versions by product id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;productId&quot;</span><span class="p">)</span>

        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_versions</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">product_ids</span><span class="o">=</span><span class="n">product_ids</span><span class="p">,</span>
            <span class="n">latest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">hero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">version</span><span class="p">[</span><span class="s2">&quot;productId&quot;</span><span class="p">]:</span> <span class="n">version</span>
            <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ServerAPI.get_last_version_by_product_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_last_version_by_product_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_version_by_product_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_id</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query last version entity by product id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for representation.</span>
<span class="sd">            product_id (str): Product id.</span>
<span class="sd">            active (Optional[bool]): Receive active/inactive entities.</span>
<span class="sd">                Both are returned when &#39;None&#39; is passed.</span>
<span class="sd">            fields (Optional[Iterable[str]]): fields to be queried</span>
<span class="sd">                for representations.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                versions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Queried version entity or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">versions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_versions</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">product_ids</span><span class="o">=</span><span class="p">[</span><span class="n">product_id</span><span class="p">],</span>
            <span class="n">latest</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">hero</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">version</span> <span class="ow">in</span> <span class="n">versions</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">version</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_last_version_by_product_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_last_version_by_product_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_version_by_product_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_name</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query last version entity by product name and folder id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for representation.</span>
<span class="sd">            product_name (str): Product name.</span>
<span class="sd">            folder_id (str): Folder id.</span>
<span class="sd">            active (Optional[bool]): Receive active/inactive entities.</span>
<span class="sd">                Both are returned when &#39;None&#39; is passed.</span>
<span class="sd">            fields (Optional[Iterable[str]]): fields to be queried</span>
<span class="sd">                for representations.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                representations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Queried version entity or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">folder_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_product_by_name</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="n">product_name</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">product</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_last_version_by_product_id</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">product</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="n">active</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.version_is_latest"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.version_is_latest">[docs]</a>    <span class="k">def</span> <span class="nf">version_is_latest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Is version latest from a product.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for representation.</span>
<span class="sd">            version_id (str): Version id.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Version is latest or not.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">GraphQlQuery</span><span class="p">(</span><span class="s2">&quot;VersionIsLatest&quot;</span><span class="p">)</span>
        <span class="n">project_name_var</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span>
            <span class="s2">&quot;projectName&quot;</span><span class="p">,</span> <span class="s2">&quot;String!&quot;</span><span class="p">,</span> <span class="n">project_name</span>
        <span class="p">)</span>
        <span class="n">version_id_var</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">add_variable</span><span class="p">(</span>
            <span class="s2">&quot;versionId&quot;</span><span class="p">,</span> <span class="s2">&quot;String!&quot;</span><span class="p">,</span> <span class="n">version_id</span>
        <span class="p">)</span>
        <span class="n">project_query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;project&quot;</span><span class="p">)</span>
        <span class="n">project_query</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">project_name_var</span><span class="p">)</span>
        <span class="n">version_query</span> <span class="o">=</span> <span class="n">project_query</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>
        <span class="n">version_query</span><span class="o">.</span><span class="n">set_filter</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="n">version_id_var</span><span class="p">)</span>
        <span class="n">product_query</span> <span class="o">=</span> <span class="n">version_query</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">)</span>
        <span class="n">latest_version_query</span> <span class="o">=</span> <span class="n">product_query</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">)</span>
        <span class="n">latest_version_query</span><span class="o">.</span><span class="n">add_field</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">latest_version</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;version&quot;</span><span class="p">][</span><span class="s2">&quot;product&quot;</span><span class="p">][</span><span class="s2">&quot;latestVersion&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">latest_version</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">version_id</span></div>

<div class="viewcode-block" id="ServerAPI.create_version"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_version">[docs]</a>    <span class="k">def</span> <span class="nf">create_version</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version</span><span class="p">,</span>
        <span class="n">product_id</span><span class="p">,</span>
        <span class="n">task_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">author</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">thumbnail_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new version.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            version (int): Version.</span>
<span class="sd">            product_id (str): Parent product id.</span>
<span class="sd">            task_id (Optional[str]): Parent task id.</span>
<span class="sd">            author (Optional[str]): Version author.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): Version attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): Version data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Version tags.</span>
<span class="sd">            status (Optional[str]): Version status.</span>
<span class="sd">            active (Optional[bool]): Version active state.</span>
<span class="sd">            thumbnail_id (Optional[str]): Version thumbnail id.</span>
<span class="sd">            version_id (Optional[str]): Version id. If not passed new id is</span>
<span class="sd">                generated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Version id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">version_id</span><span class="p">:</span>
            <span class="n">version_id</span> <span class="o">=</span> <span class="n">create_entity_id</span><span class="p">()</span>
        <span class="n">create_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">version_id</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="n">version</span><span class="p">,</span>
            <span class="s2">&quot;productId&quot;</span><span class="p">:</span> <span class="n">product_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;taskId&quot;</span><span class="p">,</span> <span class="n">task_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;author&quot;</span><span class="p">,</span> <span class="n">author</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">create_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/versions&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="o">**</span><span class="n">create_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">version_id</span></div>

<div class="viewcode-block" id="ServerAPI.update_version"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_version">[docs]</a>    <span class="k">def</span> <span class="nf">update_version</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version_id</span><span class="p">,</span>
        <span class="n">version</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_id</span><span class="o">=</span><span class="n">NOT_SET</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">thumbnail_id</span><span class="o">=</span><span class="n">NOT_SET</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update version entity on server.</span>

<span class="sd">        Do not pass ``task_id`` amd ``thumbnail_id`` if you don&#39;t</span>
<span class="sd">            want to change their values. Value ``None`` would unset</span>
<span class="sd">            their value.</span>

<span class="sd">        Update of ``data`` will override existing value on folder entity.</span>

<span class="sd">        Update of ``attrib`` does change only passed attributes. If you want</span>
<span class="sd">            to unset value, use ``None``.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            version_id (str): Version id.</span>
<span class="sd">            version (Optional[int]): New version.</span>
<span class="sd">            product_id (Optional[str]): New product id.</span>
<span class="sd">            task_id (Optional[Union[str, None]]): New task id.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): New attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): New data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): New tags.</span>
<span class="sd">            status (Optional[str]): New status.</span>
<span class="sd">            active (Optional[bool]): New active state.</span>
<span class="sd">            thumbnail_id (Optional[Union[str, None]]): New thumbnail id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">version</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;productId&quot;</span><span class="p">,</span> <span class="n">product_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;taskId&quot;</span><span class="p">,</span> <span class="n">task_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">update_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;taskId&quot;</span><span class="p">,</span> <span class="n">task_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;thumbnailId&quot;</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NOT_SET</span><span class="p">:</span>
                <span class="n">update_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/versions/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">version_id</span><span class="p">),</span>
            <span class="o">**</span><span class="n">update_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_version"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_version">[docs]</a>    <span class="k">def</span> <span class="nf">delete_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">version_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete version.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            version_id (str): Version id to delete.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/versions/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">version_id</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_representation_conversion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">representation</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;context&quot;</span> <span class="ow">in</span> <span class="n">representation</span><span class="p">:</span>
            <span class="n">orig_context</span> <span class="o">=</span> <span class="n">representation</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">]</span>
            <span class="n">context</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">if</span> <span class="n">orig_context</span> <span class="ow">and</span> <span class="n">orig_context</span> <span class="o">!=</span> <span class="s2">&quot;null&quot;</span><span class="p">:</span>
                <span class="n">context</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">orig_context</span><span class="p">)</span>
            <span class="n">representation</span><span class="p">[</span><span class="s2">&quot;context&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">context</span>

        <span class="n">repre_files</span> <span class="o">=</span> <span class="n">representation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">repre_files</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">for</span> <span class="n">repre_file</span> <span class="ow">in</span> <span class="n">repre_files</span><span class="p">:</span>
            <span class="n">repre_file_size</span> <span class="o">=</span> <span class="n">repre_file</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">repre_file_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">repre_file</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">repre_file</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">])</span>

<div class="viewcode-block" id="ServerAPI.get_representations"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representations">[docs]</a>    <span class="k">def</span> <span class="nf">get_representations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">representation_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">names_by_version_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">has_links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get representation entities based on passed filters from server.</span>

<span class="sd">        Todos:</span>
<span class="sd">            Add separated function for &#39;names_by_version_ids&#39; filtering.</span>
<span class="sd">                Because can&#39;t be combined with others.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for versions.</span>
<span class="sd">            representation_ids (Optional[Iterable[str]]): Representation ids</span>
<span class="sd">                used for representation filtering.</span>
<span class="sd">            representation_names (Optional[Iterable[str]]): Representation</span>
<span class="sd">                names used for representation filtering.</span>
<span class="sd">            version_ids (Optional[Iterable[str]]): Version ids used for</span>
<span class="sd">                representation filtering. Versions are parents of</span>
<span class="sd">                    representations.</span>
<span class="sd">            names_by_version_ids (Optional[bool]): Find representations</span>
<span class="sd">                by names and version ids. This filter discard all</span>
<span class="sd">                other filters.</span>
<span class="sd">            statuses (Optional[Iterable[str]]): Representation statuses used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Representation tags used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            active (Optional[bool]): Receive active/inactive entities.</span>
<span class="sd">                Both are returned when &#39;None&#39; is passed.</span>
<span class="sd">            has_links (Optional[Literal[IN, OUT, ANY]]): Filter</span>
<span class="sd">                representations with IN/OUT/ANY links.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                representation. All possible fields are returned if &#39;None&#39; is</span>
<span class="sd">                passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                representations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Queried representation entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;representation&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="k">if</span> <span class="s2">&quot;attrib&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">)</span>
                <span class="n">fields</span> <span class="o">|=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_fields_for_type</span><span class="p">(</span>
                    <span class="s2">&quot;representation&quot;</span>
                <span class="p">)</span>

        <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="s2">&quot;data&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">graphql_allows_data_in_query</span><span class="p">:</span>
            <span class="n">use_rest</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">}</span>

        <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">own_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_PLACEHOLDER</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;&#39;own_attributes&#39; is not supported for representations. &quot;</span>
                <span class="s2">&quot;The argument will be removed form function signature in &quot;</span>
                <span class="s2">&quot;future (apx. version 1.0.10 or 1.1.0).&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="s2">&quot;files&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">|=</span> <span class="n">REPRESENTATION_FILES_FIELDS</span>

        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">representation_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">representation_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">representation_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">representation_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;representationIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">representation_ids</span><span class="p">)</span>

        <span class="n">version_ids_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">representaion_names_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">names_by_version_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version_ids_filter</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">representaion_names_filter</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">version_id</span><span class="p">,</span> <span class="n">names</span> <span class="ow">in</span> <span class="n">names_by_version_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">version_ids_filter</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">version_id</span><span class="p">)</span>
                <span class="n">representaion_names_filter</span> <span class="o">|=</span> <span class="nb">set</span><span class="p">(</span><span class="n">names</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">version_ids_filter</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">representaion_names_filter</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">representation_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">representaion_names_filter</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">representation_names</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">representaion_names_filter</span><span class="p">:</span>
                    <span class="k">return</span>

            <span class="k">if</span> <span class="n">version_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">version_ids_filter</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">version_ids</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">version_ids_filter</span><span class="p">:</span>
                    <span class="k">return</span>

        <span class="k">if</span> <span class="n">version_ids_filter</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;versionIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">version_ids_filter</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">representaion_names_filter</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;representationNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">representaion_names_filter</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;representationStatuses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;representationTags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_links</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;representationHasLinks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_links</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">representations_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">repre</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;representations&quot;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">active</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">repre</span><span class="p">[</span><span class="s2">&quot;active&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="k">if</span> <span class="n">use_rest</span><span class="p">:</span>
                    <span class="n">repre</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_rest_representation</span><span class="p">(</span>
                        <span class="n">project_name</span><span class="p">,</span> <span class="n">repre</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">repre</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_representation_conversion</span><span class="p">(</span><span class="n">repre</span><span class="p">)</span>

                <span class="k">yield</span> <span class="n">repre</span></div>

<div class="viewcode-block" id="ServerAPI.get_representation_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representation_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_representation_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query representation entity from server based on id filter.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for representation.</span>
<span class="sd">            representation_id (str): Id of representation.</span>
<span class="sd">            fields (Optional[Iterable[str]]): fields to be queried</span>
<span class="sd">                for representations.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                representations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Queried representation entity or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">representations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_representations</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">representation_ids</span><span class="o">=</span><span class="p">[</span><span class="n">representation_id</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">representation</span> <span class="ow">in</span> <span class="n">representations</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">representation</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_representation_by_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representation_by_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_representation_by_name</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_name</span><span class="p">,</span>
        <span class="n">version_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query representation entity by name and version id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for representation.</span>
<span class="sd">            representation_name (str): Representation name.</span>
<span class="sd">            version_id (str): Version id.</span>
<span class="sd">            fields (Optional[Iterable[str]]): fields to be queried</span>
<span class="sd">                for representations.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                representations.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Queried representation entity or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">representations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_representations</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">representation_names</span><span class="o">=</span><span class="p">[</span><span class="n">representation_name</span><span class="p">],</span>
            <span class="n">version_ids</span><span class="o">=</span><span class="p">[</span><span class="n">version_id</span><span class="p">],</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">representation</span> <span class="ow">in</span> <span class="n">representations</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">representation</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_representations_hierarchy"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representations_hierarchy">[docs]</a>    <span class="k">def</span> <span class="nf">get_representations_hierarchy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_ids</span><span class="p">,</span>
        <span class="n">project_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">representation_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find representation with parents by representation id.</span>

<span class="sd">        Representation entity with parent entities up to project.</span>

<span class="sd">        Default fields are used when any fields are set to `None`. But it is</span>
<span class="sd">            possible to pass in empty iterable (list, set, tuple) to skip</span>
<span class="sd">            entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for entities.</span>
<span class="sd">            representation_ids (Iterable[str]): Representation ids.</span>
<span class="sd">            project_fields (Optional[Iterable[str]]): Project fields.</span>
<span class="sd">            folder_fields (Optional[Iterable[str]]): Folder fields.</span>
<span class="sd">            task_fields (Optional[Iterable[str]]): Task fields.</span>
<span class="sd">            product_fields (Optional[Iterable[str]]): Product fields.</span>
<span class="sd">            version_fields (Optional[Iterable[str]]): Version fields.</span>
<span class="sd">            representation_fields (Optional[Iterable[str]]): Representation</span>
<span class="sd">                fields.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, RepresentationHierarchy]: Parent entities by</span>
<span class="sd">                representation id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">representation_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">project_fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">project_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">project_fields</span><span class="p">)</span>

        <span class="n">project</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">project_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">project_fields</span><span class="p">:</span>
            <span class="c1"># Keep project as empty dictionary if does not have</span>
            <span class="c1">#   filled any fields</span>
            <span class="n">project</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">(</span>
                <span class="n">project_name</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="n">project_fields</span>
            <span class="p">)</span>

        <span class="n">repre_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">representation_ids</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">repre_id</span><span class="p">:</span> <span class="n">RepresentationHierarchy</span><span class="p">(</span>
                <span class="n">project</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">repre_id</span> <span class="ow">in</span> <span class="n">representation_ids</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">folder_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;folder&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">folder_fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">task_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">task_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">product_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">product_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">product_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">product_fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">version_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">version_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">version_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">version_fields</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">representation_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">representation_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span>
                <span class="s2">&quot;representation&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">representation_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">representation_fields</span><span class="p">)</span>

        <span class="n">representation_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">representations_hierarchy_qraphql_query</span><span class="p">(</span>
            <span class="n">folder_fields</span><span class="p">,</span>
            <span class="n">task_fields</span><span class="p">,</span>
            <span class="n">product_fields</span><span class="p">,</span>
            <span class="n">version_fields</span><span class="p">,</span>
            <span class="n">representation_fields</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;projectName&quot;</span><span class="p">,</span> <span class="n">project_name</span><span class="p">)</span>
        <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="s2">&quot;representationIds&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">repre_ids</span><span class="p">))</span>

        <span class="n">parsed_data</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">repre</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;representations&quot;</span><span class="p">]:</span>
            <span class="n">repre_id</span> <span class="o">=</span> <span class="n">repre</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="n">version</span> <span class="o">=</span> <span class="n">repre</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">product</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">task</span> <span class="o">=</span> <span class="n">version</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;task&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;folder&quot;</span><span class="p">,</span> <span class="p">{})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">version</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">task</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_convert_entity_data</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>

            <span class="n">output</span><span class="p">[</span><span class="n">repre_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">RepresentationHierarchy</span><span class="p">(</span>
                <span class="n">project</span><span class="p">,</span> <span class="n">folder</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">product</span><span class="p">,</span> <span class="n">version</span><span class="p">,</span> <span class="n">repre</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="ServerAPI.get_representation_hierarchy"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representation_hierarchy">[docs]</a>    <span class="k">def</span> <span class="nf">get_representation_hierarchy</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_id</span><span class="p">,</span>
        <span class="n">project_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">representation_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find representation parents by representation id.</span>

<span class="sd">        Representation parent entities up to project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for entities.</span>
<span class="sd">            representation_id (str): Representation id.</span>
<span class="sd">            project_fields (Optional[Iterable[str]]): Project fields.</span>
<span class="sd">            folder_fields (Optional[Iterable[str]]): Folder fields.</span>
<span class="sd">            task_fields (Optional[Iterable[str]]): Task fields.</span>
<span class="sd">            product_fields (Optional[Iterable[str]]): Product fields.</span>
<span class="sd">            version_fields (Optional[Iterable[str]]): Version fields.</span>
<span class="sd">            representation_fields (Optional[Iterable[str]]): Representation</span>
<span class="sd">                fields.</span>

<span class="sd">        Returns:</span>
<span class="sd">            RepresentationHierarchy: Representation hierarchy entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">representation_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">parents_by_repre_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_representations_hierarchy</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="p">[</span><span class="n">representation_id</span><span class="p">],</span>
            <span class="n">project_fields</span><span class="o">=</span><span class="n">project_fields</span><span class="p">,</span>
            <span class="n">folder_fields</span><span class="o">=</span><span class="n">folder_fields</span><span class="p">,</span>
            <span class="n">task_fields</span><span class="o">=</span><span class="n">task_fields</span><span class="p">,</span>
            <span class="n">product_fields</span><span class="o">=</span><span class="n">product_fields</span><span class="p">,</span>
            <span class="n">version_fields</span><span class="o">=</span><span class="n">version_fields</span><span class="p">,</span>
            <span class="n">representation_fields</span><span class="o">=</span><span class="n">representation_fields</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">parents_by_repre_id</span><span class="p">[</span><span class="n">representation_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_representations_parents"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representations_parents">[docs]</a>    <span class="k">def</span> <span class="nf">get_representations_parents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_ids</span><span class="p">,</span>
        <span class="n">project_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find representations parents by representation id.</span>

<span class="sd">        Representation parent entities up to project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for entities.</span>
<span class="sd">            representation_ids (Iterable[str]): Representation ids.</span>
<span class="sd">            project_fields (Optional[Iterable[str]]): Project fields.</span>
<span class="sd">            folder_fields (Optional[Iterable[str]]): Folder fields.</span>
<span class="sd">            product_fields (Optional[Iterable[str]]): Product fields.</span>
<span class="sd">            version_fields (Optional[Iterable[str]]): Version fields.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, RepresentationParents]: Parent entities by</span>
<span class="sd">                representation id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">hierarchy_by_repre_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_representations_hierarchy</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">representation_ids</span><span class="p">,</span>
            <span class="n">project_fields</span><span class="o">=</span><span class="n">project_fields</span><span class="p">,</span>
            <span class="n">folder_fields</span><span class="o">=</span><span class="n">folder_fields</span><span class="p">,</span>
            <span class="n">task_fields</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span>
            <span class="n">product_fields</span><span class="o">=</span><span class="n">product_fields</span><span class="p">,</span>
            <span class="n">version_fields</span><span class="o">=</span><span class="n">version_fields</span><span class="p">,</span>
            <span class="n">representation_fields</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="n">repre_id</span><span class="p">:</span> <span class="n">RepresentationParents</span><span class="p">(</span>
                <span class="n">hierarchy</span><span class="o">.</span><span class="n">version</span><span class="p">,</span>
                <span class="n">hierarchy</span><span class="o">.</span><span class="n">product</span><span class="p">,</span>
                <span class="n">hierarchy</span><span class="o">.</span><span class="n">folder</span><span class="p">,</span>
                <span class="n">hierarchy</span><span class="o">.</span><span class="n">project</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">repre_id</span><span class="p">,</span> <span class="n">hierarchy</span> <span class="ow">in</span> <span class="n">hierarchy_by_repre_id</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span></div>

<div class="viewcode-block" id="ServerAPI.get_representation_parents"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representation_parents">[docs]</a>    <span class="k">def</span> <span class="nf">get_representation_parents</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span> 
        <span class="n">representation_id</span><span class="p">,</span>
        <span class="n">project_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">product_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find representation parents by representation id.</span>

<span class="sd">        Representation parent entities up to project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for entities.</span>
<span class="sd">            representation_id (str): Representation id.</span>
<span class="sd">            project_fields (Optional[Iterable[str]]): Project fields.</span>
<span class="sd">            folder_fields (Optional[Iterable[str]]): Folder fields.</span>
<span class="sd">            product_fields (Optional[Iterable[str]]): Product fields.</span>
<span class="sd">            version_fields (Optional[Iterable[str]]): Version fields.</span>

<span class="sd">        Returns:</span>
<span class="sd">            RepresentationParents: Representation parent entities.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">representation_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">parents_by_repre_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_representations_parents</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="p">[</span><span class="n">representation_id</span><span class="p">],</span>
            <span class="n">project_fields</span><span class="o">=</span><span class="n">project_fields</span><span class="p">,</span>
            <span class="n">folder_fields</span><span class="o">=</span><span class="n">folder_fields</span><span class="p">,</span>
            <span class="n">product_fields</span><span class="o">=</span><span class="n">product_fields</span><span class="p">,</span>
            <span class="n">version_fields</span><span class="o">=</span><span class="n">version_fields</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">parents_by_repre_id</span><span class="p">[</span><span class="n">representation_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_repre_ids_by_context_filters"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_repre_ids_by_context_filters">[docs]</a>    <span class="k">def</span> <span class="nf">get_repre_ids_by_context_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">context_filters</span><span class="p">,</span>
        <span class="n">representation_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_ids</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Find representation ids which match passed context filters.</span>

<span class="sd">        Each representation has context integrated on representation entity in</span>
<span class="sd">        database. The context may contain project, folder, task name or</span>
<span class="sd">        product name, product type and many more. This implementation gives</span>
<span class="sd">        option to quickly filter representation based on representation data</span>
<span class="sd">        in database.</span>

<span class="sd">        Context filters have defined structure. To define filter of nested</span>
<span class="sd">            subfield use dot &#39;.&#39; as delimiter (For example &#39;task.name&#39;).</span>
<span class="sd">        Filter values can be regex filters. String or ``re.Pattern`` can</span>
<span class="sd">            be used.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where to look for representations.</span>
<span class="sd">            context_filters (dict[str, list[str]]): Filters of context fields.</span>
<span class="sd">            representation_names (Optional[Iterable[str]]): Representation</span>
<span class="sd">                names, can be used as additional filter for representations</span>
<span class="sd">                by their names.</span>
<span class="sd">            version_ids (Optional[Iterable[str]]): Version ids, can be used</span>
<span class="sd">                as additional filter for representations by their parent ids.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[str]: Representation ids that match passed filters.</span>

<span class="sd">        Example:</span>
<span class="sd">            The function returns just representation ids so if entities are</span>
<span class="sd">                required for funtionality they must be queried afterwards by</span>
<span class="sd">                their ids.</span>
<span class="sd">            &gt;&gt;&gt; project_name = &quot;testProject&quot;</span>
<span class="sd">            &gt;&gt;&gt; filters = {</span>
<span class="sd">            ...     &quot;task.name&quot;: [&quot;[aA]nimation&quot;],</span>
<span class="sd">            ...     &quot;product&quot;: [&quot;.*[Mm]ain&quot;]</span>
<span class="sd">            ... }</span>
<span class="sd">            &gt;&gt;&gt; repre_ids = get_repre_ids_by_context_filters(</span>
<span class="sd">            ...     project_name, filters)</span>
<span class="sd">            &gt;&gt;&gt; repres = get_representations(project_name, repre_ids)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">context_filters</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;Expected &#39;dict&#39; got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">context_filters</span><span class="p">)))</span>
            <span class="p">)</span>

        <span class="n">filter_body</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">representation_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">representation_names</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">filter_body</span><span class="p">[</span><span class="s2">&quot;names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">representation_names</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">version_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">version_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[]</span>
            <span class="n">filter_body</span><span class="p">[</span><span class="s2">&quot;versionIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">version_ids</span><span class="p">))</span>

        <span class="n">body_context_filters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">filters</span> <span class="ow">in</span> <span class="n">context_filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="p">(</span><span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Expected &#39;set&#39;, &#39;list&#39;, &#39;tuple&#39; got </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">filters</span><span class="p">))))</span>

            <span class="n">new_filters</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filter_value</span><span class="p">,</span> <span class="n">PatternType</span><span class="p">):</span>
                    <span class="n">filter_value</span> <span class="o">=</span> <span class="n">filter_value</span><span class="o">.</span><span class="n">pattern</span>
                <span class="n">new_filters</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">filter_value</span><span class="p">)</span>

            <span class="n">body_context_filters</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s2">&quot;key&quot;</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
                <span class="s2">&quot;values&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">new_filters</span><span class="p">)</span>
            <span class="p">})</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/repreContextFilter&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="n">context</span><span class="o">=</span><span class="n">body_context_filters</span><span class="p">,</span>
            <span class="o">**</span><span class="n">filter_body</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;ids&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.create_representation"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_representation">[docs]</a>    <span class="k">def</span> <span class="nf">create_representation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">version_id</span><span class="p">,</span>
        <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">representation_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new representation.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            name (str): Representation name.</span>
<span class="sd">            version_id (str): Parent version id.</span>
<span class="sd">            files (Optional[list[dict]]): Representation files information.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): Representation attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): Representation data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Representation tags.</span>
<span class="sd">            status (Optional[str]): Representation status.</span>
<span class="sd">            active (Optional[bool]): Representation active state.</span>
<span class="sd">            representation_id (Optional[str]): Representation id. If not</span>
<span class="sd">                passed new id is generated.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Representation id.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">representation_id</span><span class="p">:</span>
            <span class="n">representation_id</span> <span class="o">=</span> <span class="n">create_entity_id</span><span class="p">()</span>
        <span class="n">create_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">representation_id</span><span class="p">,</span>
            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">name</span><span class="p">,</span>
            <span class="s2">&quot;versionId&quot;</span><span class="p">:</span> <span class="n">version_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">create_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/representations&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="o">**</span><span class="n">create_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">representation_id</span></div>

<div class="viewcode-block" id="ServerAPI.update_representation"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_representation">[docs]</a>    <span class="k">def</span> <span class="nf">update_representation</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_id</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">version_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">files</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">status</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update representation entity on server.</span>

<span class="sd">        Update of ``data`` will override existing value on folder entity.</span>

<span class="sd">        Update of ``attrib`` does change only passed attributes. If you want</span>
<span class="sd">            to unset value, use ``None``.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            representation_id (str): Representation id.</span>
<span class="sd">            name (Optional[str]): New name.</span>
<span class="sd">            version_id (Optional[str]): New version id.</span>
<span class="sd">            files (Optional[list[dict]]): New files</span>
<span class="sd">                information.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): New attributes.</span>
<span class="sd">            data (Optional[dict[str, Any]]): New data.</span>
<span class="sd">            tags (Optional[Iterable[str]]): New tags.</span>
<span class="sd">            status (Optional[str]): New status.</span>
<span class="sd">            active (Optional[bool]): New active state.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">update_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;versionId&quot;</span><span class="p">,</span> <span class="n">version_id</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;files&quot;</span><span class="p">,</span> <span class="n">files</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;status&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
        <span class="p">):</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">update_data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/representations/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_name</span><span class="p">,</span> <span class="n">representation_id</span>
            <span class="p">),</span>
            <span class="o">**</span><span class="n">update_data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_representation"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_representation">[docs]</a>    <span class="k">def</span> <span class="nf">delete_representation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">representation_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete representation.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name.</span>
<span class="sd">            representation_id (str): Representation id to delete.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/representation/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_name</span><span class="p">,</span> <span class="n">representation_id</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.get_workfiles_info"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_workfiles_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_workfiles_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">workfile_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">paths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">path_regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">has_links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Workfile info entities by passed filters.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project under which the entity is located.</span>
<span class="sd">            workfile_ids (Optional[Iterable[str]]): Workfile ids.</span>
<span class="sd">            task_ids (Optional[Iterable[str]]): Task ids.</span>
<span class="sd">            paths (Optional[Iterable[str]]): Rootless workfiles paths.</span>
<span class="sd">            path_regex (Optional[str]): Regex filter for workfile path.</span>
<span class="sd">            statuses (Optional[Iterable[str]]): Workfile info statuses used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            tags (Optional[Iterable[str]]): Workfile info tags used</span>
<span class="sd">                for filtering.</span>
<span class="sd">            has_links (Optional[Literal[IN, OUT, ANY]]): Filter</span>
<span class="sd">                representations with IN/OUT/ANY links.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                representation. All possible fields are returned if &#39;None&#39; is</span>
<span class="sd">                passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                workfiles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Generator[dict[str, Any]]: Queried workfile info entites.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">task_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">task_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">task_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">task_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;taskIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">task_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">paths</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">paths</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">paths</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;paths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">path_regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;workfilePathRegex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">path_regex</span>

        <span class="k">if</span> <span class="n">workfile_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">workfile_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">workfile_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">workfile_ids</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;workfileIds&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">workfile_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">statuses</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">statuses</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">statuses</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;workfileStatuses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">statuses</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">tags</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tags</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">tags</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;workfileTags&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tags</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_links</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;workfilehasLinks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">has_links</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_fields_for_type</span><span class="p">(</span><span class="s2">&quot;workfile&quot;</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;attrib&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">)</span>
            <span class="n">fields</span> <span class="o">|=</span> <span class="p">{</span>
                <span class="s2">&quot;attrib.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_attributes_for_type</span><span class="p">(</span><span class="s2">&quot;workfile&quot;</span><span class="p">)</span>
            <span class="p">}</span>
        
        <span class="k">if</span> <span class="n">own_attributes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">_PLACEHOLDER</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
                <span class="s2">&quot;&#39;own_attributes&#39; is not supported for workfiles. The argument&quot;</span>
                <span class="s2">&quot; will be removed form function signature in future&quot;</span>
                <span class="s2">&quot; (apx. version 1.0.10 or 1.1.0).&quot;</span>
            <span class="p">)</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">workfiles_info_graphql_query</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">workfile_info</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="s2">&quot;workfiles&quot;</span><span class="p">]:</span>
                <span class="k">yield</span> <span class="n">workfile_info</span></div>

<div class="viewcode-block" id="ServerAPI.get_workfile_info"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_workfile_info">[docs]</a>    <span class="k">def</span> <span class="nf">get_workfile_info</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">,</span>
        <span class="n">path</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Workfile info entity by task id and workfile path.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project under which the entity is located.</span>
<span class="sd">            task_id (str): Task id.</span>
<span class="sd">            path (str): Rootless workfile path.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                representation. All possible fields are returned if &#39;None&#39; is</span>
<span class="sd">                passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                workfiles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Workfile info entity or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">task_id</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">path</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">workfile_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workfiles_info</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">task_ids</span><span class="o">=</span><span class="p">[</span><span class="n">task_id</span><span class="p">],</span>
            <span class="n">paths</span><span class="o">=</span><span class="p">[</span><span class="n">path</span><span class="p">],</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">workfile_info</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.get_workfile_info_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_workfile_info_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_workfile_info_by_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">workfile_id</span><span class="p">,</span>
        <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">own_attributes</span><span class="o">=</span><span class="n">_PLACEHOLDER</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Workfile info entity by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project under which the entity is located.</span>
<span class="sd">            workfile_id (str): Workfile info id.</span>
<span class="sd">            fields (Optional[Iterable[str]]): Fields to be queried for</span>
<span class="sd">                representation. All possible fields are returned if &#39;None&#39; is</span>
<span class="sd">                passed.</span>
<span class="sd">            own_attributes (Optional[bool]): DEPRECATED: Not supported for</span>
<span class="sd">                workfiles.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[dict[str, Any], None]: Workfile info entity or None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">workfile_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">workfile_info</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_workfiles_info</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">workfile_ids</span><span class="o">=</span><span class="p">[</span><span class="n">workfile_id</span><span class="p">],</span>
            <span class="n">fields</span><span class="o">=</span><span class="n">fields</span><span class="p">,</span>
            <span class="n">own_attributes</span><span class="o">=</span><span class="n">own_attributes</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">workfile_info</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">_prepare_thumbnail_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">response</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">content_type</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content_type</span>

        <span class="c1"># It is expected the response contains thumbnail id otherwise the</span>
        <span class="c1">#   content cannot be cached and filepath returned</span>
        <span class="n">thumbnail_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-Thumbnail-Id&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">thumbnail_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span>

        <span class="k">return</span> <span class="n">ThumbnailContent</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">,</span> <span class="n">content</span><span class="p">,</span> <span class="n">content_type</span>
        <span class="p">)</span>

<div class="viewcode-block" id="ServerAPI.get_thumbnail_by_id"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_thumbnail_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_thumbnail_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get thumbnail from server by id.</span>

<span class="sd">        Permissions of thumbnails are related to entities so thumbnails must</span>
<span class="sd">        be queried per entity. So an entity type and entity type is required</span>
<span class="sd">        to be passed.</span>

<span class="sd">        Notes:</span>
<span class="sd">            It is recommended to use one of prepared entity type specific</span>
<span class="sd">                methods &#39;get_folder_thumbnail&#39;, &#39;get_version_thumbnail&#39; or</span>
<span class="sd">                &#39;get_workfile_thumbnail&#39;.</span>
<span class="sd">            We do recommend pass thumbnail id if you have access to it. Each</span>
<span class="sd">                entity that allows thumbnails has &#39;thumbnailId&#39; field, so it</span>
<span class="sd">                can be queried.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project under which the entity is located.</span>
<span class="sd">            thumbnail_id (Optional[str]): DEPRECATED Use</span>
<span class="sd">                &#39;get_thumbnail_by_id&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ThumbnailContent: Thumbnail content wrapper. Does not have to be</span>
<span class="sd">                valid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_get</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/thumbnails/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_name</span><span class="p">,</span>
                <span class="n">thumbnail_id</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_thumbnail_content</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_thumbnail"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">get_thumbnail</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">entity_type</span><span class="p">,</span> <span class="n">entity_id</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get thumbnail from server.</span>

<span class="sd">        Permissions of thumbnails are related to entities so thumbnails must</span>
<span class="sd">        be queried per entity. So an entity type and entity type is required</span>
<span class="sd">        to be passed.</span>

<span class="sd">        Notes:</span>
<span class="sd">            It is recommended to use one of prepared entity type specific</span>
<span class="sd">                methods &#39;get_folder_thumbnail&#39;, &#39;get_version_thumbnail&#39; or</span>
<span class="sd">                &#39;get_workfile_thumbnail&#39;.</span>
<span class="sd">            We do recommend pass thumbnail id if you have access to it. Each</span>
<span class="sd">                entity that allows thumbnails has &#39;thumbnailId&#39; field, so it</span>
<span class="sd">                can be queried.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project under which the entity is located.</span>
<span class="sd">            entity_type (str): Entity type which passed entity id represents.</span>
<span class="sd">            entity_id (str): Entity id for which thumbnail should be returned.</span>
<span class="sd">            thumbnail_id (Optional[str]): DEPRECATED Use</span>
<span class="sd">                &#39;get_thumbnail_by_id&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            ThumbnailContent: Thumbnail content wrapper. Does not have to be</span>
<span class="sd">                valid.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">thumbnail_id</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_thumbnail_by_id</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">entity_type</span> <span class="ow">in</span> <span class="p">(</span>
            <span class="s2">&quot;folder&quot;</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">,</span>
            <span class="s2">&quot;workfile&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">entity_type</span> <span class="o">+=</span> <span class="s2">&quot;s&quot;</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raw_get</span><span class="p">(</span><span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/</span><span class="si">{}</span><span class="s2">/thumbnail&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="n">entity_type</span><span class="p">,</span>
            <span class="n">entity_id</span>
        <span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_thumbnail_content</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">response</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_folder_thumbnail"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folder_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_thumbnail</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepared method to receive thumbnail for folder entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project under which the entity is located.</span>
<span class="sd">            folder_id (str): Folder id for which thumbnail should be returned.</span>
<span class="sd">            thumbnail_id (Optional[str]): Prepared thumbnail id from entity.</span>
<span class="sd">                Used only to check if thumbnail was already cached.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Path to downloaded thumbnail or none if entity</span>
<span class="sd">                does not have any (or if user does not have permissions).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_thumbnail</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;folder&quot;</span><span class="p">,</span> <span class="n">folder_id</span><span class="p">,</span> <span class="n">thumbnail_id</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_version_thumbnail"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_version_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">get_version_thumbnail</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">version_id</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepared method to receive thumbnail for version entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project under which the entity is located.</span>
<span class="sd">            version_id (str): Version id for which thumbnail should be</span>
<span class="sd">                returned.</span>
<span class="sd">            thumbnail_id (Optional[str]): Prepared thumbnail id from entity.</span>
<span class="sd">                Used only to check if thumbnail was already cached.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Path to downloaded thumbnail or none if entity</span>
<span class="sd">                does not have any (or if user does not have permissions).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_thumbnail</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">version_id</span><span class="p">,</span> <span class="n">thumbnail_id</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_workfile_thumbnail"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_workfile_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">get_workfile_thumbnail</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">workfile_id</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepared method to receive thumbnail for workfile entity.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project under which the entity is located.</span>
<span class="sd">            workfile_id (str): Worfile id for which thumbnail should be</span>
<span class="sd">                returned.</span>
<span class="sd">            thumbnail_id (Optional[str]): Prepared thumbnail id from entity.</span>
<span class="sd">                Used only to check if thumbnail was already cached.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[str, None]: Path to downloaded thumbnail or none if entity</span>
<span class="sd">                does not have any (or if user does not have permissions).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_thumbnail</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;workfile&quot;</span><span class="p">,</span> <span class="n">workfile_id</span><span class="p">,</span> <span class="n">thumbnail_id</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_get_thumbnail_mime_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thumbnail_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get thumbnail mime type on thumbnail creation based on source path.</span>

<span class="sd">        Args:</span>
<span class="sd">            thumbnail_path (str): Path to thumbnail source fie.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Mime type used for thumbnail creation.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Mime type cannot be determined.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">thumbnail_path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s2">&quot;.png&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;image/png&quot;</span>

        <span class="k">elif</span> <span class="n">ext</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;.jpeg&quot;</span><span class="p">,</span> <span class="s2">&quot;.jpg&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="s2">&quot;image/jpeg&quot;</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Thumbnail source file has unknown extensions </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ext</span><span class="p">))</span>

<div class="viewcode-block" id="ServerAPI.create_thumbnail"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">create_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">src_filepath</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new thumbnail on server from passed path.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where the thumbnail will be created</span>
<span class="sd">                and can be used.</span>
<span class="sd">            src_filepath (str): Filepath to thumbnail which should be uploaded.</span>
<span class="sd">            thumbnail_id (Optional[str]): Prepared if of thumbnail.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Created thumbnail id.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When thumbnail source cannot be processed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Entered filepath does not exist.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">thumbnail_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_thumbnail</span><span class="p">(</span>
                <span class="n">project_name</span><span class="p">,</span>
                <span class="n">thumbnail_id</span><span class="p">,</span>
                <span class="n">src_filepath</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">thumbnail_id</span>

        <span class="n">mime_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_thumbnail_mime_type</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/thumbnails&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="n">src_filepath</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="n">RequestTypes</span><span class="o">.</span><span class="n">post</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="n">mime_type</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.update_thumbnail"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_thumbnail">[docs]</a>    <span class="k">def</span> <span class="nf">update_thumbnail</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">,</span> <span class="n">src_filepath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Change thumbnail content by id.</span>

<span class="sd">        Update can be also used to create new thumbnail.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where the thumbnail will be created</span>
<span class="sd">                and can be used.</span>
<span class="sd">            thumbnail_id (str): Thumbnail id to update.</span>
<span class="sd">            src_filepath (str): Filepath to thumbnail which should be uploaded.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When thumbnail source cannot be processed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Entered filepath does not exist.&quot;</span><span class="p">)</span>

        <span class="n">mime_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_thumbnail_mime_type</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/thumbnails/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">thumbnail_id</span><span class="p">),</span>
            <span class="n">src_filepath</span><span class="p">,</span>
            <span class="n">request_type</span><span class="o">=</span><span class="n">RequestTypes</span><span class="o">.</span><span class="n">put</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="n">mime_type</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.create_project"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_project">[docs]</a>    <span class="k">def</span> <span class="nf">create_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">project_code</span><span class="p">,</span>
        <span class="n">library_project</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">preset_name</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create project using AYON settings.</span>

<span class="sd">        This project creation function is not validating project entity on</span>
<span class="sd">        creation. It is because project entity is created blindly with only</span>
<span class="sd">        minimum required information about project which is name and code.</span>

<span class="sd">        Entered project name must be unique and project must not exist yet.</span>

<span class="sd">        Note:</span>
<span class="sd">            This function is here to be OP v4 ready but in v3 has more logic</span>
<span class="sd">                to do. That&#39;s why inner imports are in the body.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): New project name. Should be unique.</span>
<span class="sd">            project_code (str): Project&#39;s code should be unique too.</span>
<span class="sd">            library_project (Optional[bool]): Project is library project.</span>
<span class="sd">            preset_name (Optional[str]): Name of anatomy preset. Default is</span>
<span class="sd">                used if not passed.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: When project name already exists.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, Any]: Created project entity.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">(</span><span class="n">project_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Project with name </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> already exists&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_name</span>
            <span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">PROJECT_NAME_REGEX</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">project_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">((</span>
                <span class="s2">&quot;Project name </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> contain invalid characters&quot;</span>
            <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">))</span>

        <span class="n">preset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project_anatomy_preset</span><span class="p">(</span><span class="n">preset_name</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="n">project_name</span><span class="p">,</span>
            <span class="n">code</span><span class="o">=</span><span class="n">project_code</span><span class="p">,</span>
            <span class="n">anatomy</span><span class="o">=</span><span class="n">preset</span><span class="p">,</span>
            <span class="n">library</span><span class="o">=</span><span class="n">library_project</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="mi">201</span><span class="p">:</span>
            <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;Unknown details (</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">details</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;detail&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">details</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Failed to create project </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_name</span><span class="p">,</span> <span class="n">details</span>
            <span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">(</span><span class="n">project_name</span><span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.update_project"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.update_project">[docs]</a>    <span class="k">def</span> <span class="nf">update_project</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">library</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">folder_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">task_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">statuses</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">tags</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">attrib</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">project_code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">changes</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update project entity on server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            library (Optional[bool]): Change library state.</span>
<span class="sd">            folder_types (Optional[list[dict[str, Any]]]): Folder type</span>
<span class="sd">                definitions.</span>
<span class="sd">            task_types (Optional[list[dict[str, Any]]]): Task type</span>
<span class="sd">                definitions.</span>
<span class="sd">            link_types (Optional[list[dict[str, Any]]]): Link type</span>
<span class="sd">                definitions.</span>
<span class="sd">            statuses (Optional[list[dict[str, Any]]]): Status definitions.</span>
<span class="sd">            tags (Optional[list[dict[str, Any]]]): List of tags available to</span>
<span class="sd">                set on entities.</span>
<span class="sd">            config (Optional[dict[dict[str, Any]]]): Project anatomy config</span>
<span class="sd">                with templates and roots.</span>
<span class="sd">            attrib (Optional[dict[str, Any]]): Project attributes to change.</span>
<span class="sd">            data (Optional[dict[str, Any]]): Custom data of a project. This</span>
<span class="sd">                value will 100% override project data.</span>
<span class="sd">            active (Optional[bool]): Change active state of a project.</span>
<span class="sd">            project_code (Optional[str]): Change project code. Not recommended</span>
<span class="sd">                during production.</span>
<span class="sd">            **changes: Other changed keys based on Rest API documentation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="n">key</span><span class="p">:</span> <span class="n">value</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="p">(</span><span class="s2">&quot;library&quot;</span><span class="p">,</span> <span class="n">library</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;folderTypes&quot;</span><span class="p">,</span> <span class="n">folder_types</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;taskTypes&quot;</span><span class="p">,</span> <span class="n">task_types</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;linkTypes&quot;</span><span class="p">,</span> <span class="n">link_types</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;statuses&quot;</span><span class="p">,</span> <span class="n">statuses</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;tags&quot;</span><span class="p">,</span> <span class="n">tags</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;config&quot;</span><span class="p">,</span> <span class="n">config</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="n">attrib</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">data</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="n">active</span><span class="p">),</span>
                <span class="p">(</span><span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="n">project_code</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">})</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="o">**</span><span class="n">changes</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_project"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_project">[docs]</a>    <span class="k">def</span> <span class="nf">delete_project</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Delete project from server.</span>

<span class="sd">        This will completely remove project from server without any step back.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project name that will be removed.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_project</span><span class="p">(</span><span class="n">project_name</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Project with name </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> was not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">project_name</span>
            <span class="p">))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">204</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Failed to delete project </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">. </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">project_name</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;detail&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="p">)</span></div>

    <span class="c1"># --- Links ---</span>
<div class="viewcode-block" id="ServerAPI.get_full_link_type_name"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_full_link_type_name">[docs]</a>    <span class="k">def</span> <span class="nf">get_full_link_type_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate full link type name used for query from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            link_type_name (str): Type of link.</span>
<span class="sd">            input_type (str): Input entity type of link.</span>
<span class="sd">            output_type (str): Output entity type of link.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Full name of link type used for query from server.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s2">&quot;|&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span><span class="p">])</span></div>

<div class="viewcode-block" id="ServerAPI.get_link_types"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_link_types">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_types</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;All link types available on a project.</span>

<span class="sd">        Example output:</span>
<span class="sd">            [</span>
<span class="sd">                {</span>
<span class="sd">                    &quot;name&quot;: &quot;reference|folder|folder&quot;,</span>
<span class="sd">                    &quot;link_type&quot;: &quot;reference&quot;,</span>
<span class="sd">                    &quot;input_type&quot;: &quot;folder&quot;,</span>
<span class="sd">                    &quot;output_type&quot;: &quot;folder&quot;,</span>
<span class="sd">                    &quot;data&quot;: {}</span>
<span class="sd">                }</span>
<span class="sd">            ]</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project where to look for link types.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Link types available on project.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/links/types&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;types&quot;</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_link_type"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_link_type">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get link type data.</span>

<span class="sd">        There is not dedicated REST endpoint to get single link type,</span>
<span class="sd">        so method &#39;get_link_types&#39; is used.</span>

<span class="sd">        Example output:</span>
<span class="sd">            {</span>
<span class="sd">                &quot;name&quot;: &quot;reference|folder|folder&quot;,</span>
<span class="sd">                &quot;link_type&quot;: &quot;reference&quot;,</span>
<span class="sd">                &quot;input_type&quot;: &quot;folder&quot;,</span>
<span class="sd">                &quot;output_type&quot;: &quot;folder&quot;,</span>
<span class="sd">                &quot;data&quot;: {}</span>
<span class="sd">            }</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where link type is available.</span>
<span class="sd">            link_type_name (str): Name of link type.</span>
<span class="sd">            input_type (str): Input entity type of link.</span>
<span class="sd">            output_type (str): Output entity type of link.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[None, dict[str, Any]]: Link type information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_link_type_name</span><span class="p">(</span>
            <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">link_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_link_types</span><span class="p">(</span><span class="n">project_name</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">link_type</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">full_type_name</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">link_type</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ServerAPI.create_link_type"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_link_type">[docs]</a>    <span class="k">def</span> <span class="nf">create_link_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create or update link type on server.</span>

<span class="sd">        Warning:</span>
<span class="sd">            Because PUT is used for creation it is also used for update.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where link type is created.</span>
<span class="sd">            link_type_name (str): Name of link type.</span>
<span class="sd">            input_type (str): Input entity type of link.</span>
<span class="sd">            output_type (str): Output entity type of link.</span>
<span class="sd">            data (Optional[dict[str, Any]]): Additional data related to link.</span>

<span class="sd">        Raises:</span>
<span class="sd">            HTTPRequestError: Server error happened.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">full_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_link_type_name</span><span class="p">(</span>
            <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/links/types/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">full_type_name</span><span class="p">),</span>
            <span class="o">**</span><span class="n">data</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.delete_link_type"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_link_type">[docs]</a>    <span class="k">def</span> <span class="nf">delete_link_type</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove link type from project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where link type is created.</span>
<span class="sd">            link_type_name (str): Name of link type.</span>
<span class="sd">            input_type (str): Input entity type of link.</span>
<span class="sd">            output_type (str): Output entity type of link.</span>

<span class="sd">        Raises:</span>
<span class="sd">            HTTPRequestError: Server error happened.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_link_type_name</span><span class="p">(</span>
            <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span>
        <span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/links/types/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">full_type_name</span><span class="p">))</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

<div class="viewcode-block" id="ServerAPI.make_sure_link_type_exists"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.make_sure_link_type_exists">[docs]</a>    <span class="k">def</span> <span class="nf">make_sure_link_type_exists</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Make sure link type exists on a project.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Name of project.</span>
<span class="sd">            link_type_name (str): Name of link type.</span>
<span class="sd">            input_type (str): Input entity type of link.</span>
<span class="sd">            output_type (str): Output entity type of link.</span>
<span class="sd">            data (Optional[dict[str, Any]]): Link type related data.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">link_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_link_type</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="n">link_type</span>
            <span class="ow">and</span> <span class="p">(</span><span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">data</span> <span class="o">==</span> <span class="n">link_type</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
        <span class="p">):</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">create_link_type</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span><span class="p">,</span> <span class="n">data</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.create_link"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.create_link">[docs]</a>    <span class="k">def</span> <span class="nf">create_link</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">link_type_name</span><span class="p">,</span>
        <span class="n">input_id</span><span class="p">,</span>
        <span class="n">input_type</span><span class="p">,</span>
        <span class="n">output_id</span><span class="p">,</span>
        <span class="n">output_type</span><span class="p">,</span>
        <span class="n">link_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create link between 2 entities.</span>

<span class="sd">        Link has a type which must already exists on a project.</span>

<span class="sd">        Example output::</span>

<span class="sd">            {</span>
<span class="sd">                &quot;id&quot;: &quot;59a212c0d2e211eda0e20242ac120002&quot;</span>
<span class="sd">            }</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where the link is created.</span>
<span class="sd">            link_type_name (str): Type of link.</span>
<span class="sd">            input_id (str): Input entity id.</span>
<span class="sd">            input_type (str): Entity type of input entity.</span>
<span class="sd">            output_id (str): Output entity id.</span>
<span class="sd">            output_type (str): Entity type of output entity.</span>
<span class="sd">            link_name (Optional[str]): Name of link.</span>
<span class="sd">                Available from server version &#39;1.0.0-rc.6&#39;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, str]: Information about link.</span>

<span class="sd">        Raises:</span>
<span class="sd">            HTTPRequestError: Server error happened.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">full_link_type_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_full_link_type_name</span><span class="p">(</span>
            <span class="n">link_type_name</span><span class="p">,</span> <span class="n">input_type</span><span class="p">,</span> <span class="n">output_type</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;input&quot;</span><span class="p">:</span> <span class="n">input_id</span><span class="p">,</span>
            <span class="s2">&quot;output&quot;</span><span class="p">:</span> <span class="n">output_id</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_tuple</span>
        <span class="n">rel_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;rc\.[0-5]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">((</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rel_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">rel</span><span class="p">))</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;link&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_link_type_name</span>
            <span class="k">if</span> <span class="n">link_name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">UnsupportedServerVersion</span><span class="p">((</span>
                    <span class="s2">&quot;Link name is not supported&quot;</span>
                    <span class="s2">&quot; for version of AYON server </span><span class="si">{}</span><span class="s2">&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server_version</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;linkType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">full_link_type_name</span>

        <span class="k">if</span> <span class="n">link_name</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_name</span>

        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/links&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="ServerAPI.delete_link"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.delete_link">[docs]</a>    <span class="k">def</span> <span class="nf">delete_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">,</span> <span class="n">link_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove link by id.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where link exists.</span>
<span class="sd">            link_id (str): Id of link.</span>

<span class="sd">        Raises:</span>
<span class="sd">            HTTPRequestError: Server error happened.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/links/</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">,</span> <span class="n">link_id</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_prepare_link_filters</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="p">,</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span><span class="p">,</span> <span class="n">link_names</span><span class="p">,</span> <span class="n">link_name_regex</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add links filters for GraphQl queries.</span>

<span class="sd">        Args:</span>
<span class="sd">            filters (dict[str, Any]): Object where filters will be added.</span>
<span class="sd">            link_types (Union[Iterable[str], None]): Link types filters.</span>
<span class="sd">            link_direction (Union[Literal[&quot;in&quot;, &quot;out&quot;], None]): Direction of</span>
<span class="sd">                link &quot;in&quot;, &quot;out&quot; or &#39;None&#39; for both.</span>
<span class="sd">            link_names (Union[Iterable[str], None]): Link name filters.</span>
<span class="sd">            link_name_regex (Union[str, None]): Regex filter for link name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: Links are valid, and query from server can happen.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">link_types</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">link_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">link_types</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">link_types</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;linkTypes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">link_types</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">link_names</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">link_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">link_names</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">link_names</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;linkNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">link_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">link_direction</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">link_direction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;in&quot;</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;linkDirection&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_direction</span>

        <span class="k">if</span> <span class="n">link_name_regex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">filters</span><span class="p">[</span><span class="s2">&quot;linkNameRegex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">link_name_regex</span>
        <span class="k">return</span> <span class="kc">True</span>

<div class="viewcode-block" id="ServerAPI.get_entities_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_entities_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_entities_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">entity_type</span><span class="p">,</span>
        <span class="n">entity_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_names</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_name_regex</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to get links from server for entity types.</span>

<span class="sd">        Example output::</span>
<span class="sd">            {</span>
<span class="sd">                &quot;59a212c0d2e211eda0e20242ac120001&quot;: [</span>
<span class="sd">                    {</span>
<span class="sd">                        &quot;id&quot;: &quot;59a212c0d2e211eda0e20242ac120002&quot;,</span>
<span class="sd">                        &quot;linkType&quot;: &quot;reference&quot;,</span>
<span class="sd">                        &quot;description&quot;: &quot;reference link between folders&quot;,</span>
<span class="sd">                        &quot;projectName&quot;: &quot;my_project&quot;,</span>
<span class="sd">                        &quot;author&quot;: &quot;frantadmin&quot;,</span>
<span class="sd">                        &quot;entityId&quot;: &quot;b1df109676db11ed8e8c6c9466b19aa8&quot;,</span>
<span class="sd">                        &quot;entityType&quot;: &quot;folder&quot;,</span>
<span class="sd">                        &quot;direction&quot;: &quot;out&quot;</span>
<span class="sd">                    },</span>
<span class="sd">                    ...</span>
<span class="sd">                ],</span>
<span class="sd">                ...</span>
<span class="sd">            }</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            entity_type (Literal[&quot;folder&quot;, &quot;task&quot;, &quot;product&quot;,</span>
<span class="sd">                &quot;version&quot;, &quot;representations&quot;]): Entity type.</span>
<span class="sd">            entity_ids (Optional[Iterable[str]]): Ids of entities for which</span>
<span class="sd">                links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>
<span class="sd">            link_names (Optional[Iterable[str]]): Link name filters.</span>
<span class="sd">            link_name_regex (Optional[str]): Regex filter for link name.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[dict[str, Any]]]: Link info by entity ids.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;folder&quot;</span><span class="p">:</span>
            <span class="n">query_func</span> <span class="o">=</span> <span class="n">folders_graphql_query</span>
            <span class="n">id_filter_key</span> <span class="o">=</span> <span class="s2">&quot;folderIds&quot;</span>
            <span class="n">project_sub_key</span> <span class="o">=</span> <span class="s2">&quot;folders&quot;</span>
        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;task&quot;</span><span class="p">:</span>
            <span class="n">query_func</span> <span class="o">=</span> <span class="n">tasks_graphql_query</span>
            <span class="n">id_filter_key</span> <span class="o">=</span> <span class="s2">&quot;taskIds&quot;</span>
            <span class="n">project_sub_key</span> <span class="o">=</span> <span class="s2">&quot;tasks&quot;</span>
        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;product&quot;</span><span class="p">:</span>
            <span class="n">query_func</span> <span class="o">=</span> <span class="n">products_graphql_query</span>
            <span class="n">id_filter_key</span> <span class="o">=</span> <span class="s2">&quot;productIds&quot;</span>
            <span class="n">project_sub_key</span> <span class="o">=</span> <span class="s2">&quot;products&quot;</span>
        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;version&quot;</span><span class="p">:</span>
            <span class="n">query_func</span> <span class="o">=</span> <span class="n">versions_graphql_query</span>
            <span class="n">id_filter_key</span> <span class="o">=</span> <span class="s2">&quot;versionIds&quot;</span>
            <span class="n">project_sub_key</span> <span class="o">=</span> <span class="s2">&quot;versions&quot;</span>
        <span class="k">elif</span> <span class="n">entity_type</span> <span class="o">==</span> <span class="s2">&quot;representation&quot;</span><span class="p">:</span>
            <span class="n">query_func</span> <span class="o">=</span> <span class="n">representations_graphql_query</span>
            <span class="n">id_filter_key</span> <span class="o">=</span> <span class="s2">&quot;representationIds&quot;</span>
            <span class="n">project_sub_key</span> <span class="o">=</span> <span class="s2">&quot;representations&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unknown type </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2">. Expected </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">entity_type</span><span class="p">,</span>
                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                    <span class="p">(</span><span class="s2">&quot;folder&quot;</span><span class="p">,</span> <span class="s2">&quot;task&quot;</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="s2">&quot;representation&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">))</span>

        <span class="n">output</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;projectName&quot;</span><span class="p">:</span> <span class="n">project_name</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="n">entity_ids</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entity_ids</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">entity_ids</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">entity_ids</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">output</span>
            <span class="n">filters</span><span class="p">[</span><span class="n">id_filter_key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">entity_ids</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_link_filters</span><span class="p">(</span>
            <span class="n">filters</span><span class="p">,</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span><span class="p">,</span> <span class="n">link_names</span><span class="p">,</span> <span class="n">link_name_regex</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="n">output</span>

        <span class="n">link_fields</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;links&quot;</span><span class="p">}</span>
        <span class="c1"># Backwards compatibility for server version 1.0.0-rc.5 and lower</span>
        <span class="c1"># ---------</span>
        <span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server_version_tuple</span>
        <span class="n">rel_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;rc\.[0-5]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="p">((</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rel_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">rel</span><span class="p">))</span>
            <span class="ow">or</span> <span class="p">(</span><span class="n">major</span><span class="p">,</span> <span class="n">minor</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span> <span class="o">&lt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">DEFAULT_LINK_FIELDS</span><span class="p">)</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span>
            <span class="n">link_fields</span><span class="o">.</span><span class="n">discard</span><span class="p">(</span><span class="s2">&quot;links&quot;</span><span class="p">)</span>
            <span class="n">link_fields</span> <span class="o">|=</span> <span class="p">{</span>
                <span class="s2">&quot;links.</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span>
            <span class="p">}</span>
        <span class="c1"># ---------</span>

        <span class="n">query</span> <span class="o">=</span> <span class="n">query_func</span><span class="p">(</span><span class="n">link_fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span> <span class="ow">in</span> <span class="n">filters</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">query</span><span class="o">.</span><span class="n">set_variable_value</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">filter_value</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">parsed_data</span> <span class="ow">in</span> <span class="n">query</span><span class="o">.</span><span class="n">continuous_query</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">entity</span> <span class="ow">in</span> <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;project&quot;</span><span class="p">][</span><span class="n">project_sub_key</span><span class="p">]:</span>
                <span class="n">entity_id</span> <span class="o">=</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="n">output</span><span class="p">[</span><span class="n">entity_id</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">entity</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">output</span></div>

<div class="viewcode-block" id="ServerAPI.get_folders_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folders_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_folders_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query folders links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            folder_ids (Optional[Iterable[str]]): Ids of folders for which</span>
<span class="sd">                links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[dict[str, Any]]]: Link info by folder ids.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entities_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;folder&quot;</span><span class="p">,</span> <span class="n">folder_ids</span><span class="p">,</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_folder_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_folder_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_folder_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">folder_id</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query folder links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            folder_id (str): Folder id for which links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Link info of folder.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_folders_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="p">[</span><span class="n">folder_id</span><span class="p">],</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)[</span><span class="n">folder_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_tasks_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_tasks_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_tasks_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">task_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query tasks links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            task_ids (Optional[Iterable[str]]): Ids of tasks for which</span>
<span class="sd">                links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[dict[str, Any]]]: Link info by task ids.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entities_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;task&quot;</span><span class="p">,</span> <span class="n">task_ids</span><span class="p">,</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_task_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_task_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_task_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">task_id</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query task links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            task_id (str): Task id for which links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Link info of task.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_tasks_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="p">[</span><span class="n">task_id</span><span class="p">],</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)[</span><span class="n">task_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_products_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_products_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_products_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query products links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            product_ids (Optional[Iterable[str]]): Ids of products for which</span>
<span class="sd">                links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[dict[str, Any]]]: Link info by product ids.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entities_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="n">product_ids</span><span class="p">,</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_product_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_product_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_product_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">product_id</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query product links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            product_id (str): Product id for which links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Link info of product.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_products_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="p">[</span><span class="n">product_id</span><span class="p">],</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)[</span><span class="n">product_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_versions_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_versions_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_versions_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query versions links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            version_ids (Optional[Iterable[str]]): Ids of versions for which</span>
<span class="sd">                links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[dict[str, Any]]]: Link info by version ids.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entities_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="s2">&quot;version&quot;</span><span class="p">,</span> <span class="n">version_ids</span><span class="p">,</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_version_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_version_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_version_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">version_id</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query version links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            version_id (str): Version id for which links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Link info of version.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_versions_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="p">[</span><span class="n">version_id</span><span class="p">],</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)[</span><span class="n">version_id</span><span class="p">]</span></div>

<div class="viewcode-block" id="ServerAPI.get_representations_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representations_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_representations_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query representations links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            representation_ids (Optional[Iterable[str]]): Ids of</span>
<span class="sd">                representations for which links should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            dict[str, list[dict[str, Any]]]: Link info by representation ids.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_entities_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span>
            <span class="s2">&quot;representation&quot;</span><span class="p">,</span>
            <span class="n">representation_ids</span><span class="p">,</span>
            <span class="n">link_types</span><span class="p">,</span>
            <span class="n">link_direction</span>
        <span class="p">)</span></div>

<div class="viewcode-block" id="ServerAPI.get_representation_links"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.get_representation_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_representation_links</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">representation_id</span><span class="p">,</span>
        <span class="n">link_types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">link_direction</span><span class="o">=</span><span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Query representation links from server.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): Project where links are.</span>
<span class="sd">            representation_id (str): Representation id for which links</span>
<span class="sd">                should be received.</span>
<span class="sd">            link_types (Optional[Iterable[str]]): Link type filters.</span>
<span class="sd">            link_direction (Optional[Literal[&quot;in&quot;, &quot;out&quot;]]): Link direction</span>
<span class="sd">                filter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Link info of representation.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_representations_links</span><span class="p">(</span>
            <span class="n">project_name</span><span class="p">,</span> <span class="p">[</span><span class="n">representation_id</span><span class="p">],</span> <span class="n">link_types</span><span class="p">,</span> <span class="n">link_direction</span>
        <span class="p">)[</span><span class="n">representation_id</span><span class="p">]</span></div>

    <span class="c1"># --- Batch operations processing ---</span>
<div class="viewcode-block" id="ServerAPI.send_batch_operations"><a class="viewcode-back" href="../../ayon_api.server_api.html#ayon_api.ServerAPI.send_batch_operations">[docs]</a>    <span class="k">def</span> <span class="nf">send_batch_operations</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">project_name</span><span class="p">,</span>
        <span class="n">operations</span><span class="p">,</span>
        <span class="n">can_fail</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">raise_on_fail</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Post multiple CRUD operations to server.</span>

<span class="sd">        When multiple changes should be made on server side this is the best</span>
<span class="sd">        way to go. It is possible to pass multiple operations to process on a</span>
<span class="sd">        server side and do the changes in a transaction.</span>

<span class="sd">        Args:</span>
<span class="sd">            project_name (str): On which project should be operations</span>
<span class="sd">                processed.</span>
<span class="sd">            operations (list[dict[str, Any]]): Operations to be processed.</span>
<span class="sd">            can_fail (Optional[bool]): Server will try to process all</span>
<span class="sd">                operations even if one of them fails.</span>
<span class="sd">            raise_on_fail (Optional[bool]): Raise exception if an operation</span>
<span class="sd">                fails. You can handle failed operations on your own</span>
<span class="sd">                when set to &#39;False&#39;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Operations can&#39;t be converted to json string.</span>
<span class="sd">            FailedOperations: When output does not contain server operations</span>
<span class="sd">                or &#39;raise_on_fail&#39; is enabled and any operation fails.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list[dict[str, Any]]: Operations result with process details.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">operations</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">body_by_id</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">operations_body</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">operation</span> <span class="ow">in</span> <span class="n">operations</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">operation</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">op_id</span> <span class="o">=</span> <span class="n">operation</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">op_id</span><span class="p">:</span>
                <span class="n">op_id</span> <span class="o">=</span> <span class="n">create_entity_id</span><span class="p">()</span>
                <span class="n">operation</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">op_id</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">operation</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">entity_data_json_default</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t json parse body: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                        <span class="n">operation</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">failed_json_default</span>
                    <span class="p">)</span>
                <span class="p">))</span>

            <span class="n">body_by_id</span><span class="p">[</span><span class="n">op_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">body</span>
            <span class="n">operations_body</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">operations_body</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
            <span class="s2">&quot;projects/</span><span class="si">{}</span><span class="s2">/operations&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">project_name</span><span class="p">),</span>
            <span class="n">operations</span><span class="o">=</span><span class="n">operations_body</span><span class="p">,</span>
            <span class="n">canFail</span><span class="o">=</span><span class="n">can_fail</span>
        <span class="p">)</span>

        <span class="n">op_results</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;operations&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">op_results</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">FailedOperations</span><span class="p">(</span>
                <span class="s2">&quot;Operation failed. Content: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">raise_on_fail</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">op_results</span>

        <span class="k">for</span> <span class="n">op_result</span> <span class="ow">in</span> <span class="n">op_results</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">op_result</span><span class="p">[</span><span class="s2">&quot;success&quot;</span><span class="p">]:</span>
                <span class="n">operation_id</span> <span class="o">=</span> <span class="n">op_result</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
                <span class="k">raise</span> <span class="n">FailedOperations</span><span class="p">((</span>
                    <span class="s2">&quot;Operation </span><span class="se">\&quot;</span><span class="si">{}</span><span class="se">\&quot;</span><span class="s2"> failed with data:</span><span class="se">\n</span><span class="si">{}</span><span class="se">\n</span><span class="s2">Detail: </span><span class="si">{}</span><span class="s2">.&quot;</span>
                <span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">operation_id</span><span class="p">,</span>
                    <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body_by_id</span><span class="p">[</span><span class="n">operation_id</span><span class="p">],</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                    <span class="n">op_result</span><span class="p">[</span><span class="s2">&quot;detail&quot;</span><span class="p">],</span>
                <span class="p">))</span>
        <span class="k">return</span> <span class="n">op_results</span></div>

    <span class="k">def</span> <span class="nf">_convert_entity_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">entity</span> <span class="ow">or</span> <span class="s2">&quot;data&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">entity</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">entity_data</span> <span class="o">=</span> <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entity_data</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">entity_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">entity_data</span><span class="p">)</span>

        <span class="n">entity</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">entity_data</span></div>
</pre></div>

					 </div>
					 
					</div>
					<footer>
  

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2024, ynput.io <info@ynput.io>
	  <br>
      
      
      
      Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
      
      <a href="https://github.com/revitron/revitron-sphinx-theme">theme</a>
      
      provided by <a href="https://github.com/revitron">Revitron</a>.

    </p>
  </div> 

</footer>

				</div>
			</div>

		</section>

	</div>
	

	<script type="text/javascript">
			jQuery(function () {
					SphinxRtdTheme.Navigation.enable(true);
			});
	</script>

	
	
		
	 

 
</body>	
</html>